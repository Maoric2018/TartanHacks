<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>NEON PHASES</title><style>*{margin:0;padding:0}body{background:#000;overflow:hidden}canvas{display:block;touch-action:none}</style></head><body><canvas id="c"></canvas><script>"use strict";var e,l;e="center",l="middle",(()=>{function t(e,l){return e+Math.random()*(l-e)}function a(e,l){return e+Math.random()*(l-e+1)|0}function r(){return Math.random()*Math.PI*2}function i(e){return e[Math.random()*e.length|0]}var o=Math.PI,n=2*o,{cos:s,sin:f,sqrt:c,abs:d,min:y,max:g,atan2:h,floor:v}=Math;function p(e,l,t){return e<l?l:e>t?t:e}function x(e,l,t){return e+(l-e)*t}function m(e,l,t,a){return c((e-t)**2+(l-a)**2)}function u(e,l,t,a,r,i){let o=r-t,n=i-a,s=o*o+n*n;if(s<=1e-6)return m(e,l,t,a);let f=p(((e-t)*o+(l-a)*n)/s,0,1);return m(e,l,t+o*f,a+n*f)}function T(e){return"string"==typeof e&&"#0ff"===e.toLowerCase()?"#0cf":e||"#f44"}var b,w,S,k,A,P=document.getElementById("c"),_=P.getContext("2d"),C={x:0,y:0};function R(){A=devicePixelRatio||1,b=innerWidth,w=innerHeight,P.width=b*A,P.height=w*A,P.style.width=b+"px",P.style.height=w+"px",_.setTransform(A,0,0,A,0,0),S=b/2,k=w/2}addEventListener("resize",R),R();var F=S,L=k,I=null,D=0,M={id:-1,x:0,y:0,bx:76,by:76,r:42},E=-1;function W(){M.bx=M.r+22,M.by=w-M.r-20}function B(e,l){for(let t=0;t<e.length;t++)if(e[t].identifier===l)return e[t];return null}function H(e){let l=e.clientX-M.bx,t=e.clientY-M.by,a=g(1,c(l*l+t*t)),r=y(M.r,a);M.x=l/a*r,M.y=t/a*r}function z(){M.id=-1,M.x=M.y=0}W(),addEventListener("resize",W);var U=e=>{e.preventDefault();for(let l=0;l<e.changedTouches.length;l++){let t=e.changedTouches[l];t.identifier===M.id&&z(),t.identifier===E&&(E=-1,D=0)}};function V(){return{x:F-S+C.x,y:L-k+C.y}}addEventListener("touchstart",e=>{e.preventDefault();for(let l=0;l<e.changedTouches.length;l++){let t=e.changedTouches[l],a=t.clientX,r=t.clientY;F=a,L=r,"playing"===O&&M.id<0&&a<S&&m(a,r,M.bx,M.by)<1.9*M.r?(M.id=t.identifier,H(t)):E<0&&(E=t.identifier,D=1,I={x:a,y:r})}},{passive:0}),addEventListener("touchmove",e=>{e.preventDefault();let l=B(e.touches,M.id);l&&H(l);let t=B(e.touches,E);t&&(F=t.clientX,L=t.clientY)},{passive:0}),addEventListener("touchend",U,{passive:0}),addEventListener("touchcancel",U,{passive:0});var O="title",N={time:0,difficulty:.4,wave:0,waveKills:0,waveQuota:0,waveState:"spawning",xp:0,level:1,xpToNext:160,levelUpQueue:0,totalKills:0,frozen:0,freezeTimer:0,bannerTimer:0,bannerText:"",bannerColor:"#fff",weapons:[],passives:{},killFlash:0,waveBannerTimer:0,waveBannerText:"",gameOverFade:0},G={speed:[["moveSpeed","mul",[1,1.15,1.3,1.4]],["dodgeChance","set",[0,0,0,.08]]],regen:[["regenInterval","set",[999,14,8,8]]],cooldown:[["cdReduction","set",[0,.12,.2,.25]]],damage:[["dmgMult","mul",[1,1.3,1.5]]]};function q(e,l,t){void 0!==t&&("mul"===l?K[e]*=t:"mul1"===l?K[e]*=1+t:"add"===l?K[e]+=t:K[e]="add_cap"===l?y(.5,K[e]+t):t)}var K={moveSpeed:240,critChance:0,critMult:2,xpMult:1,cdReduction:0,regenTimer:0,regenInterval:999,dodgeChance:0,dmgMult:1};function Q(){K.moveSpeed=240,K.critChance=0,K.critMult=2,K.xpMult=1,K.cdReduction=0,K.regenInterval=999,K.dodgeChance=0,K.dmgMult=1;let e=N.passives;for(let l in G){let t=0|e[l];if(!t)continue;let a=G[l];for(let e=0;e<a.length;e++){let l=a[e],r=l[2];q(l[0],l[1],r[y(t,r.length-1)])}}let l=0|e._speedLoop,t=0|e._damageLoop;l&&(K.moveSpeed*=1+.15*l),t&&(K.dmgMult*=1+.3*t)}var X=0,Y=0,Z=0,$=0,j=1;function J(e){Z=g(Z,e)}function ee(e,l){$=e,j=l}function le(e,l,t,a,r){r=r||3,_.save();for(let i=r;i>0;i--)_.beginPath(),_.arc(e,l,t+2.5*i,0,n),_.strokeStyle=a,_.lineWidth=2*i,_.globalAlpha=.07,_.stroke();_.beginPath(),_.arc(e,l,t,0,n),_.strokeStyle=a,_.lineWidth=1.5,_.globalAlpha=1,_.stroke(),_.restore()}function te(e,l,t,a){_.save(),_.beginPath(),_.arc(e,l,t+4,0,n),_.fillStyle=a,_.globalAlpha=.12,_.fill(),_.beginPath(),_.arc(e,l,t,0,n),_.fillStyle=a,_.globalAlpha=.9,_.fill(),_.restore()}function ae(e,l,t,a){function r(){_.beginPath(),_.moveTo(e[0].x,e[0].y);for(let l=1;l<e.length;l++)_.lineTo(e[l].x,e[l].y);t&&_.closePath()}t=0!=t,a=a||3,_.save();for(let e=a;e>0;e--)r(),_.strokeStyle=l,_.lineWidth=2.5*e,_.globalAlpha=.07,_.stroke();r(),_.strokeStyle=l,_.lineWidth=1.5,_.globalAlpha=1,_.stroke(),_.restore()}function re(e,l,t,a){let r=[];for(let i=0;i<3;i++){let c=a+n/3*i-o/2;r.push({x:e+s(c)*t,y:l+f(c)*t})}return r}function ie(e,l,t,a,r,i,o){_.save(),_.font="bold "+a+"px monospace",_.textAlign=i||"left",_.textBaseline=o||"top",_.shadowColor=r,_.shadowBlur=10,_.fillStyle=r,_.globalAlpha=.5,_.fillText(e,l,t),_.shadowBlur=0,_.globalAlpha=1,_.fillText(e,l,t),_.restore()}function oe(l,t,a,r,i,o,n,s){_.save(),_.font="bold "+i+"px monospace",_.textAlign=e,_.textBaseline="top",_.fillStyle=o;let f=(l||"").split(/\s+/).filter(Boolean),c=[],d="";for(let e=0;e<f.length;e++){let l=d?d+" "+f[e]:f[e];_.measureText(l).width>r&&d?(c.push(d),d=f[e]):d=l}d&&c.push(d);let y=c.slice(0,s);c.length>s&&y.length&&(y[y.length-1]=y[y.length-1].replace(/\.*$/,"")+"...");for(let e=0;e<y.length;e++)_.fillText(y[e],t,a+e*n);_.restore()}function ne(e,l,t,a,r,i){_.beginPath(),_.arc(e,l,t,0,n),_.strokeStyle=a,_.lineWidth=r||1,void 0!==i&&(_.globalAlpha=i),_.stroke()}function se(e,l,t,a,r,i,o,n){_.save(),void 0!==n&&(_.globalAlpha=n),r&&(_.fillStyle=r,_.fillRect(e,l,t,a)),i&&(_.strokeStyle=i,_.lineWidth=o||1,_.strokeRect(e,l,t,a)),_.restore()}function fe(e,l){let t=[];for(let a=0;a<e;a++){let e=l();e.active=0,t.push(e)}return t.spawn=e=>{for(let l=0;l<t.length;l++)if(!t[l].active)return t[l].active=1,e(t[l]),t[l];let l=0,a=1/0;for(let e=0;e<t.length;e++)t[e].spawnTime<a&&(a=t[e].spawnTime,l=e);return t[l].active=1,e(t[l]),t[l]},t.each=e=>{for(let l=0;l<t.length;l++)t[l].active&&e(t[l])},t.count=()=>{let e=0;for(let l=0;l<t.length;l++)t[l].active&&e++;return e},t.clear=()=>{for(let e=0;e<t.length;e++)t[e].active=0},t}function ce(){return{active:0,x:0,y:0,vx:0,vy:0,r:4,life:0,maxLife:3,type:"normal",color:"#f44",spawnTime:0,damage:1,curve:0,pulseAmp:0,pulseFreq:0,split:0,baseSpeed:0,src:null,loopAmp:0,loopFreq:0,loopBaseAng:0}}var de=fe(900,ce),ye=fe(150,ce),ge=fe(500,()=>({active:0,x:0,y:0,vx:0,vy:0,life:0,maxLife:.4,color:"#fff",r:2,spawnTime:0})),he=fe(50,()=>({active:0,x:0,y:0,vx:0,vy:0,r:14,hp:2,maxHp:2,shape:"circle",color:"#f44",moveType:"drifter",firePattern:"single",fireTimer:0,fireCD:2,tier:"small",angle:0,hitFlash:0,spiralAngle:0,moveParams:{},fireParams:{},spawnTime:0,cc:{stunT:0,silenceT:0,rootT:0,slowAmt:0,slowT:0,fearT:0,markT:0,markAmp:0,kbVx:0,kbVy:0,disorientT:0,bleedDmg:0,bleedT:0}})),ve=[];function pe(e,l,t,a,r,i,o){ge.spawn(n=>{n.x=e,n.y=l,n.vx=t,n.vy=a,n.color=r,n.life=i||.4,n.maxLife=i||.4,n.r=o||2,n.spawnTime=N.time})}function xe(e,l,t,a,r){for(let i=0;i<a;i++){let a=Math.random()*n,i=r*(.3+.7*Math.random());pe(e,l,s(a)*i,f(a)*i,t,.2+.3*Math.random(),1+2*Math.random())}}function me(e){ge.each(l=>{l.x+=l.vx*e,l.y+=l.vy*e,l.vx*=.97,l.vy*=.97,l.life-=e,l.life<=0&&(l.active=0)})}function ue(){ge.each(e=>{let l=p(e.life/e.maxLife,0,1);_.save(),_.globalAlpha=.8*l,_.beginPath(),_.arc(e.x,e.y,e.r*l,0,n),_.fillStyle=e.color,_.fill(),_.restore()})}var Te=[];function be(e,l,t,a,r,i,o,n){let s=r*(n?1+.35*i:.8+.4*i),f=g(n?4:3,r*(n?.45:.3)*(n?.85+.25*i:.8+.3*i)),c=g(n?2.5:2,r*(n?.2:.12));_.save(),_.lineCap="round";let d=_.createLinearGradient(e,l,t,a);d.addColorStop(0,"rgba(255,255,255,0)"),d.addColorStop(.08,"rgba(255,216,74,"+(.12+.14*i)+")"),d.addColorStop(1,n?"rgba(255,120,120,"+(.1+.22*i)+")":"rgba(255,216,74,"+(.08+.2*i)+")"),_.beginPath(),_.moveTo(e,l),_.lineTo(t,a),_.strokeStyle=d,_.lineWidth=s,_.globalAlpha=1,_.shadowColor=o,_.shadowBlur=n?18:20,_.stroke();let y=_.createLinearGradient(e,l,t,a);y.addColorStop(0,"rgba(255,255,255,0)"),y.addColorStop(n?.1:.08,"rgba(255,255,255,"+(n?.15+.2*i:.16+.2*i)+")"),y.addColorStop(1,n?"rgba(255,180,180,"+(.2+.38*i)+")":"rgba(255,216,74,"+(.2+.4*i)+")"),_.beginPath(),_.moveTo(e,l),_.lineTo(t,a),_.strokeStyle=y,_.lineWidth=f,_.shadowBlur=n?10:12,_.stroke();let h=_.createLinearGradient(e,l,t,a);h.addColorStop(0,"rgba(255,255,255,0)"),h.addColorStop(n?.12:.1,"rgba(255,255,255,"+(.25+.25*i)+")"),h.addColorStop(1,"rgba(255,255,255,"+(n?.3+.4*i:.35+.45*i)+")"),_.beginPath(),_.moveTo(e,l),_.lineTo(t,a),_.strokeStyle=h,_.lineWidth=c,_.shadowBlur=n?6:8,_.stroke(),_.restore()}function we(e,l,t,a,i,o,n,c){if(Te.length>=18)return;let d=a||0,y=i||1,h=o||1,v=n||1,m=-f(t),T=s(t),S=_e.x+16*s(t)+m*d,k=_e.y+16*f(t)+T*d,A=1.9*g(b,w)*v,P=x(4,26,l)*h,_=x(1.2,11,l)*y,C=p(0|e.lv.a,0,2);A*=1+.08*C,P*=1+.08*C,_*=1+.07*C;let R=S+s(t)*A,F=k+f(t)*A;he.each(l=>{if(l.active&&u(l.x,l.y,S,k,R,F)<=.5*P+l.r&&(yl(l,_),"bow"===e.id)){let t=p(0|e.lv.c,0,2);t>0&&(l.cc.bleedDmg=g(l.cc.bleedDmg,[0,1.2,2.2][t]),l.cc.bleedT=g(l.cc.bleedT,[0,1.5,2.5][t]))}}),de.each(e=>{e.active&&u(e.x,e.y,S,k,R,F)<=.55*P+e.r&&(e.active=0,xe(e.x,e.y,"#ff0",2,70))});for(let e=0;e<6;e++){let l=.15+.15*e;xe(x(S,R,l),x(k,F,l),"#ff0",2,60)}Te.push({x1:S,y1:k,x2:R,y2:F,width:P,length:A,life:.12+.1*l,maxLife:.12+.1*l,color:c||"#ff0",phase:r(),hot:0})}var Se=["#f44","#f84","#fd4","#f6f","#9f6","#f95"],ke={t:0,enemies:[],bullets:[]};function Ae(e){(e=e||{}).x=t(0,b),e.y=t(0,w);let l=r(),a=t(35,95);return e.vx=s(l)*a,e.vy=f(l)*a,e.r=t(8,16),e.shape=i(["circle","triangle"]),e.color=i(Se),e.fire=t(.2,1.1),e}function Pe(e){let l=h(k-e.y,S-e.x)+t(-.9,.9),a=t(120,220);ke.bullets.push({x:e.x,y:e.y,vx:s(l)*a,vy:f(l)*a,life:t(1.2,2.6),r:2.4,color:e.color})}var _e={x:0,y:0,r:12,hp:30,maxHp:30,invuln:0,angle:0,hitFlash:0,alive:1,swordIFrame:0},Ce={drifter(e,l){if(e.x+=e.vx*l,e.y+=e.vy*l,m(e.x,e.y,_e.x,_e.y)>500){let t=h(_e.y-e.y,_e.x-e.x);e.vx+=40*s(t)*l,e.vy+=40*f(t)*l}let t=c(e.vx**2+e.vy**2);t>100&&(e.vx*=100/t,e.vy*=100/t)},chaser(e,l){let t=h(_e.y-e.y,_e.x-e.x),a=e.moveParams.speed||120;e.vx=x(e.vx,s(t)*a,2*l),e.vy=x(e.vy,f(t)*a,2*l),e.x+=e.vx*l,e.y+=e.vy*l},orbiter(e,l){let t=e.moveParams.radius||150;e.moveParams.angle=(e.moveParams.angle||0)+(e.moveParams.speed||1.5)*l,e.x=x(e.x,_e.x+s(e.moveParams.angle)*t,3*l),e.y=x(e.y,_e.y+f(e.moveParams.angle)*t,3*l)},dasher(e,l){let t=e.moveParams;if(t.state||(t.state="wait"),"wait"===t.state){t.waitTime=(t.waitTime||0)+l;let a=h(_e.y-e.y,_e.x-e.x);if(e.x+=20*s(a)*l,e.y+=20*f(a)*l,t.waitTime>1.5){let l=h(_e.y-e.y,_e.x-e.x),a=p(m(e.x,e.y,_e.x,_e.y)+36,120,260);t.state="telegraph",t.dashTx=e.x+s(l)*a,t.dashTy=e.y+f(l)*a,t.teleT=1,t.teleMax=1,e._dashTele={t:1,maxT:1,tx:t.dashTx,ty:t.dashTy}}}else if("telegraph"===t.state)t.teleT-=l,e._dashInvuln=g(e._dashInvuln,.1),e._dashTele&&(e._dashTele.t=t.teleT),t.teleT<=0&&(t.state="dashing",t.dashT=.32,t.dashMax=.32,t.sx=e.x,t.sy=e.y,t.ex=t.dashTx,t.ey=t.dashTy,e._dashTele=null);else{t.dashT-=l;let a=p(1-t.dashT/t.dashMax,0,1),r=1-(1-a)*(1-a);e.x=x(t.sx,t.ex,r),e.y=x(t.sy,t.ey,r),e._dashInvuln=g(e._dashInvuln,.3),t.dashT<=0&&(e.x=t.ex,e.y=t.ey,t.state="wait",t.waitTime=0)}},sentry(e,l){let t=h(_e.y-e.y,_e.x-e.x);e.x+=15*s(t)*l,e.y+=15*f(t)*l,e.angle+=1.5*l},weaver(e,l){let t=e.moveParams;t.t=(t.t||0)+l;let a=h(_e.y-e.y,_e.x-e.x),r=t.speed||100,i=t.freq||2,n=a+o/2,c=80*f(t.t*i);e.x+=(s(a)*r+s(n)*c*i)*l,e.y+=(f(a)*r+f(n)*c*i)*l},stationary(e,l){},converge(e,l){let t=h(_e.y-e.y,_e.x-e.x),a=e.moveParams.speed||150;e.x+=s(t)*a*l,e.y+=f(t)*a*l}},Re={single(e){let l=h(_e.y-e.y,_e.x-e.x),t=170+6*N.difficulty;Le(e.x,e.y,s(l)*t,f(l)*t,4,e.color,"normal",3)},triple(e){let l=h(_e.y-e.y,_e.x-e.x),t=160+5*N.difficulty;for(let a=-1;a<=1;a++)Le(e.x,e.y,s(l+.2*a)*t,f(l+.2*a)*t,3.5,e.color,"normal",2.5)},radial(e){let l=e.fireParams.count||8,t=130+4*N.difficulty,a=e.fireParams.offset||0;for(let r=0;r<l;r++){let i=n/l*r+a;Le(e.x,e.y,s(i)*t,f(i)*t,3.5,e.color,"normal",3)}e.fireParams.offset=(a+.15)%n},spiral(e){let l=150+4*N.difficulty;e.spiralAngle=(e.spiralAngle||0)+.4,Le(e.x,e.y,s(e.spiralAngle)*l,f(e.spiralAngle)*l,4,e.color,"curve",3.5,{curve:.4})},ringpop(e){for(let l=0;l<10;l++){let t=n/10*l;Le(e.x,e.y,200*s(t),200*f(t),3,e.color,"pulse",3,{pulseAmp:.7,pulseFreq:3})}},wave(e){let l=h(_e.y-e.y,_e.x-e.x),t=150+4*N.difficulty,a=l+o/2;for(let r=0;r<5;r++){let i=15*(r-2);Le(e.x+s(a)*i,e.y+f(a)*i,s(l)*t,f(l)*t,3,e.color,"normal",3)}}};function Fe(){return 1+(N.wave>16)+(N.wave>36)}function Le(e,l,t,a,r,i,o,n,s){de.spawn(f=>{f.x=e,f.y=l,f.vx=t,f.vy=a,f.r=r||4,f.color=T(i||"#f44"),f.type=o||"normal",f.life=n||3,f.maxLife=n||3,f.spawnTime=N.time,f.damage=Fe(),f.curve=s&&s.curve||0,f.pulseAmp=s&&s.pulseAmp||0,f.pulseFreq=s&&s.pulseFreq||0,f.split=s&&s.split||0,f.baseSpeed=c(t*t+a*a),f.loopAmp=s&&s.loopAmp||0,f.loopFreq=s&&s.loopFreq||0,f.loopBaseAng=s&&void 0!==s.loopBaseAng?s.loopBaseAng:h(a,t)})}var Ie=["#f44","#f84","#ff4","#4f4","#4ff","#f4f","#84f"],De=["circle","square","triangle"],Me=["drifter","chaser","orbiter","dasher","sentry","weaver"],Ee=["single","triple","radial","spiral","ringpop","wave"];function We(e,l,t){N.frozen&&!t||e.each(e=>{if("curve"===e.type&&e.curve){let t=c(e.vx**2+e.vy**2),a=h(e.vy,e.vx)+e.curve*l;e.vx=s(a)*t,e.vy=f(a)*t}if("loop"===e.type&&e.loopAmp){let l=(N.time-e.spawnTime)*(e.loopFreq||2.6),t=e.loopBaseAng,a=g(80,e.baseSpeed),r=f(l*n)*(e.loopAmp||120),i=s(t),o=f(t),c=-o,d=i;e.vx=i*a+c*r,e.vy=o*a+d*r}if("pulse"===e.type&&e.pulseAmp){let l=1-e.life/e.maxLife,t=e.baseSpeed*(1+f(l*e.pulseFreq*n)*e.pulseAmp),a=h(e.vy,e.vx);e.vx=s(a)*t,e.vy=f(a)*t}if(e.x+=e.vx*l,e.y+=e.vy*l,e.life-=l,m(e.x,e.y,_e.x,_e.y)>1400&&(e.active=0),e.life<=0&&(e.active=0,e.split&&!t))for(let l=0;l<3;l++){let l=Math.random()*n;Le(e.x,e.y,100*s(l),100*f(l),2.5,e.color,"normal",1.5)}})}function Be(e){e.each(e=>{let l=p(e.life/e.maxLife,0,1);_.save(),_.globalAlpha=l;let t="rocket"===e.src||"rocket_mini"===e.src?"rocket_mini"===e.src?"#fa0":"#f80":e.color;te(e.x,e.y,e.r,t),_.restore()})}var He=(e,l)=>{for(let t in l)e[t]=l[t]},ze={dagger:e=>He(e,{state:"idle",dx:0,dy:0,tx:0,ty:0,speed:800,dmg:4,idleTimer:0,spinTimer:0,spinR:25}),sword:e=>He(e,{swingCD:0,lungeTimer:0,lungeDir:0,lungeDist:120,lungeStartX:0,lungeStartY:0,lungeProg:0}),bow:e=>He(e,{charging:0,chargeTime:0,maxCharge:1.5,shotCD:0}),chain:e=>He(e,{timer:.1,range:200,chains:4,stunDur:.3,dmg:5,_arcTimer:0,_targets:null}),rocket:e=>He(e,{timer:.1,blastR:90,kbForce:250,lastFired:0})};function Ue(e){let l={id:e,lv:{a:0,b:0,c:0,d:0}},t=ze[e];return t&&t(l),l}var Ve={};for(let e of[["dagger","MAGIC DAGGER","#0ff","starter","Throw dagger, tap to retarget.","",[["a","PIERCING THROW",3,["+50% speed","90% + homing","120% + homing"]],["b","SPECTRAL COPY",3,["1 ghost 50% dmg","2 ghosts 60%","3 ghosts 75%"]],["d","DAGGER STORM",2,["0.8s +75% radius","1.2s +150% radius"]]]],["sword","PLASMA SWORD","#f0f","starter","Lunge slash with i-frames; cuts enemies and bullets.","",[["a","LUNGE REACH",3,["+33% range","+67%","+108%"]],["b","WIDE CLEAVE",3,["+25% size","+50%","+88%"]],["c","EDGE CHARGE",2,["+15% length +2 dmg","+30% length +4 dmg"]]]],["bow","VOLT BOW","#ff0","starter","Hold to charge, release piercing beam.","",[["a","PRISM SPLIT",2,["1 side pair","2 side pairs"]],["b","QUICK DRAW",3,["1.0s charge","0.8s","0.6s"]],["c","PLASMA BURN",2,["Applies burn","Stronger burn"]]]],["chain","CHAIN LIGHTNING","#a0f","cc","Zaps bullets, chains targets, leaves stun fields.","BULLET CLEAR",[["a","EXTRA CHAINS",2,["+3 chains","+6 chains"]],["b","MULTI STRIKE",2,["2 bolts at once","3 bolts"]],["c","STATIC FIELD",2,["3s stun zone","5s wider zone"]]]],["rocket","ROCKET LAUNCHER","#f80","cc","Homing rockets explode for knockback and bullet clear.","KNOCKBACK",[["a","CONCUSSIVE BLAST",3,["+60 kb","+120 kb","+200 kb"]],["b","CLUSTER BOMB",2,["5 homing minis","7"]],["c","BLAST RADIUS",2,["+44%","+78%"]]]]]){let l=[];for(let t=0;t<e[6].length;t++){let a=e[6][t];l.push({id:a[0],name:a[1],maxLv:a[2],desc:a[3]})}let t={name:e[1],color:e[2],type:e[3],desc:e[4],upgrades:l};e[5]&&(t.cc=e[5]),Ve[e[0]]=t}var Oe=["dagger","sword","bow"],Ne=["chain","rocket"];function Ge(){let e=null;for(let l=0;l<N.weapons.length;l++){let t=N.weapons[l];"starter"===Ve[t.id].type&&(e||(e=t))}return e}function qe(e,l){if("flying"===e.state){let t=[1,1.5,1.9,2.2][e.lv.a],a=h(e.ty-e.dy,e.tx-e.dx),r=e.speed*t*l;m(e.dx,e.dy,e.tx,e.ty)<r+5?(e.dx=e.tx,e.dy=e.ty,e.lv.d>0?(e.state="spinning",e.spinTimer=[0,.8,1.2][e.lv.d],e.spinR=[0,35,50][e.lv.d]):(e.state="waiting",e.idleTimer=0)):(e.dx+=s(a)*r,e.dy+=f(a)*r),Ke(e,e.dmg)}else if("spinning"===e.state)e.spinTimer-=l,e.angle=(e.angle||0)+15*l,((e,l)=>{he.each(t=>{t.active&&m(e.dx,e.dy,t.x,t.y)<e.spinR+t.r&&yl(t,[0,3,4][e.lv.d]*l*10)})})(e,l),e.spinTimer<=0&&(e.state="waiting",e.idleTimer=0);else if("waiting"===e.state)e.idleTimer+=l,e.idleTimer>2&&(e.state="returning");else if("returning"===e.state){let t=h(_e.y-e.dy,_e.x-e.dx),a=1.2*e.speed*l;e.dx+=s(t)*a,e.dy+=f(t)*a,Ke(e,e.dmg),m(e.dx,e.dy,_e.x,_e.y)<20&&(e.state="idle")}else e.dx=_e.x,e.dy=_e.y;if(e.lv.b>0){let l=[0,1,2,3][e.lv.b];e._ghosts||(e._ghosts=[]),e._posHistory||(e._posHistory=[]),e._posHistory.push({x:e.dx,y:e.dy}),e._posHistory.length>30&&e._posHistory.shift(),e._ghosts=[];for(let t=0;t<l;t++){let l=g(0,e._posHistory.length-1-6*(t+1));e._ghosts.push({x:e._posHistory[l].x,y:e._posHistory[l].y})}}}function Ke(e,l){if(he.each(t=>{t.active&&m(e.dx,e.dy,t.x,t.y)<t.r+8&&yl(t,l)}),e.lv.b>0&&e._ghosts){let t=l*[0,.5,.6,.75][e.lv.b];for(let l of e._ghosts)he.each(e=>{e.active&&m(l.x,l.y,e.x,e.y)<e.r+8&&yl(e,t)})}}function Qe(e){let l=e.dx||_e.x,t=e.dy||_e.y;if("idle"===e.state){let e=_e.angle,l=_e.x+18*s(e),t=_e.y+18*f(e);ae([{x:l+8*s(e),y:t+8*f(e)},{x:l+5*s(e+2.3),y:t+5*f(e+2.3)},{x:l+5*s(e-2.3),y:t+5*f(e-2.3)}],"#0ff",1,3)}else{let a="spinning"===e.state?e.angle||0:h(e.dy-("returning"===e.state?_e.y:e.ty),e.dx-("returning"===e.state?_e.x:e.tx))+o;if(ae([{x:l+10*s(a),y:t+10*f(a)},{x:l+6*s(a+2.3),y:t+6*f(a+2.3)},{x:l+6*s(a-2.3),y:t+6*f(a-2.3)}],"#0ff",1,4),"spinning"===e.state&&((e,l,t,a,r,i)=>{_.save();for(let a=3;a>0;a--)_.beginPath(),_.arc(e,l,t,0,r),_.strokeStyle=i,_.lineWidth=1+2*a,_.globalAlpha=.06,_.stroke();_.beginPath(),_.arc(e,l,t,0,r),_.strokeStyle=i,_.lineWidth=1,_.globalAlpha=1,_.stroke(),_.restore()})(l,t,e.spinR,0,n,"#0ff"),e.lv.b>0&&e._ghosts&&"idle"!==e.state)for(let l=0;l<e._ghosts.length;l++){let t=e._ghosts[l],a="spinning"===e.state?e.angle||0:h(e.dy-t.y,e.dx-t.x);_.save(),_.globalAlpha=.35-.08*l,ae([{x:t.x+10*s(a),y:t.y+10*f(a)},{x:t.x+6*s(a+2.3),y:t.y+6*f(a+2.3)},{x:t.x+6*s(a-2.3),y:t.y+6*f(a-2.3)}],"#0ff",1,3),_.restore()}}}function Xe(e,l){if(e.swingCD=g(0,e.swingCD-l),e.lungeTimer>0){e.lungeTimer-=l;let t=.18;e.lungeProg=p(1-e.lungeTimer/t,0,1);let a=e.lungeDist,r=[35,50,60,75][e.lv.b],i=e.lungeStartX+s(e.lungeDir)*a*e.lungeProg,o=e.lungeStartY+f(e.lungeDir)*a*e.lungeProg;_e.x=i,_e.y=o,_e.invuln=g(_e.invuln,.25),_e.swordIFrame=g(_e.swordIFrame,.25);let n=8+[0,2,4][e.lv.c],c=70*(1+[0,.15,.3][e.lv.c]);he.each(l=>{if(!l.active)return;let t=l.x-i,a=l.y-o,y=s(e.lungeDir),g=f(e.lungeDir),h=t*y+a*g;h<-15-l.r||h>c+l.r||d(t*-g+a*y)<r+l.r&&(!l._swordHitT||N.time-l._swordHitT>.15)&&(l._swordHitT=N.time,yl(l,n,0,0),J(2))}),de.each(l=>{if(!l.active)return;let t=l.x-i,a=l.y-o,n=s(e.lungeDir),y=f(e.lungeDir),g=t*n+a*y;g<-15-l.r||g>c+l.r||d(t*-y+a*n)<r+l.r&&(l.active=0,xe(l.x,l.y,"#f0f",3,80))}),e.lungeTimer<=0&&(e.lungeTimer=0,e.lungeProg=0,xe(_e.x,_e.y,"#f0f",8,120),J(4))}}function Ye(e){let l=60*(1+[0,.15,.3][e.lv.c]),t=e.lungeTimer>0?e.lungeDir:_e.angle,a=t+o/2;if(e.lungeTimer>0){let{lungeProg:a,lungeDist:r}=e,i=[35,50,60,75][e.lv.b],n=e.lungeStartX,c=e.lungeStartY,d=.5*(n+(n+s(t)*r*a)),y=.5*(c+(c+f(t)*r*a)),h=g(10,r*a);_.save(),_.translate(d,y),_.rotate(t),_.fillStyle="rgba(255,120,255,.14)",_.fillRect(.5*-h,.45*-i,h,.9*i),_.strokeStyle="rgba(255,170,255,.22)",_.lineWidth=1,_.strokeRect(.5*-h,.45*-i,h,.9*i),_.restore();let v=t+(-o/2+o*a),p=v+o/2,x=_e.x+10*s(v),m=_e.y+10*f(v),u=_e.x+s(v)*(10+l),T=_e.y+f(v)*(10+l);ae([{x:x+4*s(p),y:m+4*f(p)},{x:x-4*s(p),y:m-4*f(p)},{x:u-1.5*s(p),y:T-1.5*f(p)},{x:u+6*s(v),y:T+6*f(v)},{x:u+1.5*s(p),y:T+1.5*f(p)}],"#f0f",1,5)}else{let e=_e.x+14*s(t),r=_e.y+14*f(t),i=_e.x+s(t)*(14+.7*l),o=_e.y+f(t)*(14+.7*l);ae([{x:e+2.5*s(a),y:r+2.5*f(a)},{x:e-2.5*s(a),y:r-2.5*f(a)},{x:i-1*s(a),y:o-1*f(a)},{x:i+4*s(t),y:o+4*f(t)},{x:i+1*s(a),y:o+1*f(a)}],"#f0f",1,2)}}function Ze(e,l){e.shotCD=g(0,e.shotCD-l);let t=[1.5,1,.8,.6][e.lv.b];e.maxCharge=t,e.charging&&(e.chargeTime=y(e.chargeTime+l,t))}function $e(e){if(e.charging){let l=p(e.chargeTime/e.maxCharge,0,1),t=18+10*l,a=_e.angle,r=_e.x+s(a)*(t+2),i=_e.y+f(a)*(t+2),n=a+o/2;_.save();let c=r+s(a)*(5+3*l),d=i+f(a)*(5+3*l),y=r+s(n)*(2+1.5*l),g=i+f(n)*(2+1.5*l),h=r-s(n)*(2+1.5*l),v=i-f(n)*(2+1.5*l);_.beginPath(),_.moveTo(c,d),_.lineTo(y,g),_.lineTo(h,v),_.closePath(),_.fillStyle="#ff0",_.globalAlpha=.35+.4*l,_.shadowColor="#ff0",_.shadowBlur=8+10*l,_.fill(),ne(_e.x,_e.y,t,"#ffd84a",1.2+1.2*l,.3+.5*l),ne(_e.x,_e.y,.55*t,"#fff",.9+.9*l,.25+.45*l),_.restore()}}function je(e,l,t,a){let r=null,i=void 0===t?1/0:t;return he.each(t=>{if(!t.active)return;if(a&&(a.has?a.has(t):a(t)))return;let o=m(e,l,t.x,t.y);o<i&&(i=o,r=t)}),r}function Je(e,l,t,a,r){let i=null,o=void 0===t?1/0:t;return de.each(t=>{if(!t.active)return;if(a&&(a.has?a.has(t):a(t)))return;if(r&&(r.has?r.has(t):r(t)))return;let n=m(e,l,t.x,t.y);n<o&&(o=n,i=t)}),i}function el(e,l){if((e=>{let l=window._staticFields;for(let t=l.length-1;t>=0;t--){let a=l[t];a.life-=e,a.x+=a.vx*e,a.y+=a.vy*e,a.vx*=.95,a.vy*=.95,a.vx+=40*(Math.random()-.5)*e,a.vy+=40*(Math.random()-.5)*e,a.life<=0?l.splice(t,1):(a._checkT=(a._checkT||0)-e,a._checkT>0||(a._checkT=.2,he.each(e=>{if(e.active&&m(a.x,a.y,e.x,e.y)<e.r+8){if(N.time-(e._lastStaticStun||0)<3)return;e.cc.stunT=g(e.cc.stunT,a.stunDur),e._lastStaticStun=N.time}})))}})(l),e.timer-=l*(1-K.cdReduction),e.timer<=0){let l=e.range,t=e.chains+[0,3,3][e.lv.a],a=[1,2,3][e.lv.b]||1,r=e.lv.c;if(!Je(_e.x,_e.y,l))return;e.timer=.8,e._zigzags=[],e._targets=[];let i=new Set;for(let o=0;o<a;o++){let c=new Set,d=[],y=_e.x,g=_e.y;if(o>0){let e=n/a*o;y=_e.x+15*s(e),g=_e.y+15*f(e)}for(let e=0;e<t;e++){let t=Je(y,g,l+(e>0?100:0),c,i);if(!t)break;if(c.add(t),i.add(t),d.push({x:t.x,y:t.y}),xe(t.x,t.y,"#a0f",3,80),t.active=0,r>0){let e=[0,3,5][r],l=[0,25,40][r];tl(t.x,t.y,e,l)}y=t.x,g=t.y}let h=o>0?_e.x+15*s(n/a*o):_e.x,v=o>0?_e.y+15*f(n/a*o):_e.y;for(let l of d){let t=al(h,v,l.x,l.y,8);e._zigzags.push(t),e._targets.push(l),h=l.x,v=l.y}}e._arcTimer=.45}e._arcTimer>0&&(e._arcTimer-=l)}window._staticFields||(window._staticFields=[]);var ll=200;function tl(e,l,t,a){if(window._staticFields.length>=ll)return;let r=3+Math.floor(3*Math.random());for(let i=0;i<r&&!(window._staticFields.length>=ll);i++){let r=Math.random()*n,i=Math.random()*a;window._staticFields.push({x:e+s(r)*i,y:l+f(r)*i,life:t,maxLife:t,r:a,stunDur:.15,vx:20*(Math.random()-.5),vy:20*(Math.random()-.5),size:2+3*Math.random()})}}function al(e,l,t,a,r){let i=[{x:e,y:l}],o=t-e,n=a-l,s=c(o*o+n*n),f=-n/s,d=o/s;for(let t=1;t<r;t++){let a=t/r,c=e+o*a,y=l+n*a,g=(Math.random()-.5)*s*.18;i.push({x:c+f*g,y:y+d*g})}return i.push({x:t,y:a}),i}function rl(e){if(e._arcTimer>0&&e._zigzags){let l=p(e._arcTimer/.45,0,1),t=(e,l,t,a,r)=>{_.beginPath(),_.moveTo(e[0].x,e[0].y);for(let l=1;l<e.length;l++)_.lineTo(e[l].x,e[l].y);_.strokeStyle=l,_.lineWidth=t,_.globalAlpha=a,_.shadowColor=l,_.shadowBlur=r,_.stroke()};_.save();for(let a of e._zigzags){t(a,"#a0f",6,.25*l,15),t(a,"#c6f",3,.6*l,8),t(a,"#eaf",1.5,l,4);let e=a[a.length-1];_.beginPath(),_.arc(e.x,e.y,4*l,0,n),_.fillStyle="#fff",_.globalAlpha=.8*l,_.shadowBlur=10,_.fill()}_.restore()}}function il(e,l){if(e.timer-=l*(1-K.cdReduction),e.timer<=0){e.timer=2.2;let l=je(_e.x,_e.y,9999),t=l?h(l.y-_e.y,l.x-_e.x):_e.angle,a=350;ye.spawn(e=>{e.x=_e.x+16*s(t),e.y=_e.y+16*f(t),e.vx=s(t)*a,e.vy=f(t)*a,e.r=6,e.life=5,e.maxLife=5,e.type="normal",e.color="#f80",e.spawnTime=N.time,e.damage=0,e.split=0,e.baseSpeed=a,e.curve=0,e.pulseAmp=0,e.src="rocket",e._homing=1,e._homingDelay=0}),e.lastFired=N.time}ye.each(e=>{if(!e.active||"rocket"!==e.src&&"rocket_mini"!==e.src||!e._homing)return;if(e._homingDelay>0)return void(e._homingDelay-=l);let t=je(e.x,e.y,800);if(t){let a="rocket_mini"===e.src?4:3.5,r=((e,l,t,a,r,i,d,y)=>{let g=h(a-i,t-r),v=h(l,e),x=p((e=>{for(;e>o;)e-=n;for(;e<-o;)e+=n;return e})(g-v),-d*y,d*y),m=v+x,u=c(e*e+l*l);return{vx:s(m)*u,vy:f(m)*u}})(e.vx,e.vy,t.x,t.y,e.x,e.y,a,l);e.vx=r.vx,e.vy=r.vy}})}function ol(e){}var nl=[["regen","REGEN","#4f4",3,["Heal 1/14s","1/8s","1/8s + clutch heal"]],["speed","SPEED","#4f4",3,["+15% speed","+30%","+40% + 8% dodge"]],["cooldown","COOLDOWN","#48f",3,["-12% CDs","-20%","-25% + faster"]],["damage","POWER SURGE","#f44",2,["+30% damage","+50% damage"]]],sl={};for(let e=0;e<nl.length;e++){let l=nl[e];sl[l[0]]={name:l[1],color:l[2],maxLv:l[3],desc:l[4]}}var fl=nl.map(e=>e[0]),cl=0;function dl(){N.wave++,N.waveKills=0,N.waveQuota=y(16,4+2*N.wave),N.difficulty=.4+.25*N.wave+N.wave*N.wave*.008,N.waveState="spawning",N.waveBannerTimer=2,N.waveBannerText="WAVE "+N.wave}function yl(e,l,t,a){if(!e.active)return;if(e._dashInvuln>0)return;let r=l;e.cc.markAmp>0&&(r*=1+e.cc.markAmp);let i=a||0;!i&&K.critChance>0&&Math.random()<K.critChance&&(i=1,r*=K.critMult),r*=K.dmgMult,e.cc.markT>0&&(r*=1+e.cc.markAmp),e.hp-=r,e.hitFlash=1,((e,l,t,a)=>{ve.length>200||ve.push({x:e+20*(Math.random()-.5),y:l,vy:-60-30*Math.random(),text:a?t+"!":""+t,color:a?"#ff0":"#fff",life:.6,maxLife:.6,scale:a?1.4:1})})(e.x,e.y,0|r,i),xe(e.x,e.y,e.color,3,80),e.hp<=0&&gl(e)}function gl(e){if(!e.active)return;e.active=0;let l=("elite"===e.tier?55:15)*K.xpMult;for(N.xp+=l;N.xp>=N.xpToNext&&N.xpToNext>0;)N.xp-=N.xpToNext,N.level++,N.xpToNext=v(.64*(100+100*N.level)),N.levelUpQueue++;if(N.totalKills++,N.waveKills++,"elite"===e.tier&&(N.killFlash=.05),"circle"===e.shape)for(let l=0;l<12;l++){let t=n/12*l;pe(e.x,e.y,200*s(t),200*f(t),e.color,.3,2)}else if("square"===e.shape)for(let l=0;l<8;l++){let t=o/4+n/8*l;pe(e.x+s(t)*e.r,e.y+f(t)*e.r,150*s(t),150*f(t),e.color,.3,3)}else for(let l=0;l<3;l++){let a=n/3*l;for(let l=0;l<4;l++)pe(e.x,e.y,s(a+t(-.3,.3))*(100+50*l),f(a+t(-.3,.3))*(100+50*l),e.color,.3,2)}xe(e.x,e.y,e.color,15,180),J("elite"===e.tier?8:3),ee(.06,.5)}function hl(e){_e.invuln>0||!_e.alive||(_e.hp-=e||1,_e.invuln=.8,_e.hitFlash=.3,J(10),xe(_e.x,_e.y,"#0ff",15,200),_e.hp<=0&&(_e.alive=0,xe(_e.x,_e.y,"#0ff",40,300),xe(_e.x,_e.y,"#fff",20,250),J(15),D=0,I=null,N.gameOverFade=0,O="dying"))}var vl=[];function pl(){let e=[];for(let l of N.weapons){let t=Ve[l.id];if(t)for(let a of t.upgrades)l.lv[a.id]<a.maxLv&&e.push({type:"weaponUpg",weaponId:l.id,upgId:a.id,def:a,wdef:t,curLv:l.lv[a.id]})}if(N.weapons.filter(e=>"cc"===Ve[e.id].type).length<2){let l=N.weapons.map(e=>e.id);for(let t of Ne)l.includes(t)||e.push({type:"newWeapon",weaponId:t,wdef:Ve[t]})}let l=0;for(let e=0;e<fl.length;e++)(0|N.passives[fl[e]])>0&&l++;for(let t of fl){let a=N.passives[t]||0,r=sl[t];r&&(a>0&&a<r.maxLv?e.push({type:"passiveUpg",passiveId:t,def:r,curLv:a}):0===a&&l<3&&e.push({type:"newPassive",passiveId:t,def:r}))}for(let l=e.length-1;l>0;l--){let t=a(0,l);[e[l],e[t]]=[e[t],e[l]]}if((vl=e.slice(0,6)).length<6)for(;vl.length<6;){let e=1&vl.length?"speed":"damage";vl.push({type:"loopPassive",passiveId:e,def:sl[e]})}}function xl(e){let l=vl[e];if(l){if("weaponUpg"===l.type){let e=N.weapons.find(e=>e.id===l.weaponId);e&&e.lv[l.upgId]++}else if("newWeapon"===l.type)N.weapons.push(Ue(l.weaponId));else if("newPassive"===l.type)N.passives[l.passiveId]=1;else if("passiveUpg"===l.type)N.passives[l.passiveId]++;else if("loopPassive"===l.type){let e="speed"===l.passiveId?"_speedLoop":"_damageLoop";N.passives[e]=1+(0|N.passives[e])}Q(),N.levelUpQueue--,N.levelUpQueue>0?(pl(),O="levelUp",N.refreshAvailable=1):O="playing"}}function ml(){let e=y(6,vl.length),l=b>w?3:2,t=y(168,(b-26-10*(l-1))/l),a=y(130,(w-170)/3),r=1+((e-1)/l|0);return{n:e,cols:l,cw:t,ch:a,g:10,sx:(b-(t*l+10*(l-1)))/2,sy:g(58,(w-(a*r+10*(r-1)))/2+6)}}function ul(){_.save(),_.fillStyle="#000",_.globalAlpha=.04;for(let e=0;e<w;e+=4)_.fillRect(0,e,b,1);_.restore()}var Tl=0;function bl(){let e=Oe.length,l=b>w?3:1,t=y(190,1===l?b-26:(b-34-12*(l-1))/l),a=y(192,1===l?(w-140-10*(e-1))/e:200);return{n:e,cols:l,cw:t,ch:a,g:10,sx:(b-(t*l+10*(l-1)))/2,sy:1===l?g(56,(w-(a*e+10*(e-1)))/2):k-70}}function wl(e){e<0||e>=Oe.length||(N.weapons=[Ue(Oe[e])],O="playing",dl())}function Sl(e,l){N.gameOverFade=y(1,(N.gameOverFade||0)+2.8*e),l&&(me(e),ue()),_.fillStyle="rgba(0,0,0,"+N.gameOverFade+")",_.fillRect(0,0,b,w),ul(),N.gameOverFade>=1&&(O="gameover")}function kl(){R(),_e.x=0,_e.y=0,_e.hp=30,_e.maxHp=30,_e.invuln=0,_e.hitFlash=0,_e.alive=1,_e.angle=0,_e.swordIFrame=0,Q(),de.clear(),ye.clear(),ge.clear(),he.clear(),ve.length=0,C.x=0,C.y=0,N.time=0,N.difficulty=.4,N.wave=0,N.waveKills=0,N.waveQuota=0,N.waveState="clear",N.xp=0,N.level=1,N.xpToNext=v(128),N.levelUpQueue=0,N.totalKills=0,N.frozen=0,N.freezeTimer=0,N.killFlash=0,N.bannerTimer=0,N.waveBannerTimer=0,N.weapons=[],N.passives={},N._rocketRings=[],N._upgradeTransition=1,N.refreshAvailable=0,N.gameOverFade=0,window._staticFields=[],Te.length=0,cl=1,$=0,O="weaponSelect"}var Al=performance.now();requestAnimationFrame(function u(A){requestAnimationFrame(u);let P=p((A-Al)/1e3,0,.05);if(Al=A,"title"===O)return I&&(kl(),I=null),void(a=>{Tl+=a,(e=>{(e=>{if(!ke.enemies.length)for(let e=0;e<10;e++)ke.enemies.push(Ae({}));ke.t+=e;for(let l of ke.enemies)l.fire-=e,l.x+=l.vx*e,l.y+=l.vy*e,(l.x<-20||l.x>b+20||l.y<-20||l.y>w+20)&&Ae(l),l.fire<=0&&(Pe(l),l.fire=t(.25,1.2));for(let l=ke.bullets.length-1;l>=0;l--){let t=ke.bullets[l];t.x+=t.vx*e,t.y+=t.vy*e,t.life-=e,(t.life<=0||t.x<-30||t.y<-30||t.x>b+30||t.y>w+30)&&ke.bullets.splice(l,1)}})(e||0),_.fillStyle="#02060b",_.fillRect(0,0,b,w);let l=100,a=50,r=30*ke.t%l,i=16*ke.t%l,o=46*ke.t%a,n=26*ke.t%a;_.save(),_.strokeStyle="#2a5f82",_.lineWidth=.9,_.globalAlpha=.5,_.beginPath();for(let e=-r;e<=b+l;e+=l)_.moveTo(e,0),_.lineTo(e,w);for(let e=-i;e<=w+l;e+=l)_.moveTo(0,e),_.lineTo(b,e);_.stroke(),_.strokeStyle="#18344a",_.lineWidth=.6,_.globalAlpha=.35,_.beginPath();for(let e=-o;e<=b+a;e+=a)_.moveTo(e,0),_.lineTo(e,w);for(let e=-n;e<=w+a;e+=a)_.moveTo(0,e),_.lineTo(b,e);_.stroke(),_.fillStyle="#58b7ff",_.globalAlpha=.14;for(let e=-o;e<=b+a;e+=a)for(let l=-n;l<=w+a;l+=a)_.fillRect(e-1,l-1,2,2);_.restore();for(let e of ke.bullets)_.save(),_.globalAlpha=.45*p(e.life/2,0,1),te(e.x,e.y,e.r,e.color),_.restore();for(let e of ke.enemies)_.save(),_.globalAlpha=.55,"circle"===e.shape?le(e.x,e.y,e.r,e.color,3):ae(re(e.x,e.y,e.r,1.2*ke.t),e.color,1,3),_.restore();_.fillStyle="rgba(0,0,0,0.28)",_.fillRect(0,0,b,w)})(a),_.save(),_.globalAlpha=.7+.3*f(3*Tl),ie("NEON PHASES",S,k-80,42,"#0ff",e,l),_.restore(),ul()})(P);if("weaponSelect"!==O)if("dying"!==O){if("gameover"===O)return I&&(kl(),I=null),_.fillStyle="#000",_.fillRect(0,0,b,w),_.save(),_.fillStyle="rgba(0,0,0,.6)",_.fillRect(0,0,b,w),_.restore(),ie("GAME OVER",S,k-110,36,"#f44",e,l),ie("K"+N.totalKills,S,k-52,17,"#fff",e,l),void ul();if("levelUp"===O){void 0===N._upgradeTransition&&(N._upgradeTransition=1),N._upgradeTransition=y(1,N._upgradeTransition+4*P);let t=N._upgradeTransition,a=t<1?1-Math.pow(1-t,3):1;if(_.fillStyle="rgba(0,0,0,"+.65*a+")",_.fillRect(0,0,b,w),I&&t>=.9){let e=ml(),l=e.n,t=e.cw,a=e.ch,r=e.g,i=e.sx,o=e.sy,n=e.cols;for(let e=0;e<l;e++){let l=i+e%n*(t+r),s=o+(e/n|0)*(a+r);if(I.x>=l&&I.x<=l+t&&I.y>=s&&I.y<=s+a){xl(e);break}}I=null}else I&&(I=null);return(t=>{t=t||1;let a=ml(),r=a.n,i=a.cw,o=a.ch,n=a.g,s=a.sx,f=a.sy,c=a.cols;_.save(),_.globalAlpha=t,ie("LEVEL UP",S,f-28,22,"#ff0",e,l),_.restore();for(let e=0;e<r;e++){let l=vl[e],t=s+e%c*(i+n),a=f+(e/c|0)*(o+n),r="#0ff",d="",y="";"weaponUpg"===l.type?(r=l.wdef.color,d=l.wdef.name+": "+l.def.name,y=l.def.desc[l.curLv]||""):"newWeapon"===l.type?(r=l.wdef.color,d="NEW "+l.wdef.name,y=l.wdef.cc?"CC: "+l.wdef.cc:l.wdef.desc):"newPassive"===l.type?(r=l.def.color,d="NEW "+l.def.name,y=l.def.desc[0]):"passiveUpg"===l.type?(r=l.def.color,d=l.def.name,y=l.def.desc[l.curLv]||""):"loopPassive"===l.type&&(r=l.def.color,d=l.def.name,y=l.def.desc[0]),se(t,a,i,o,"rgba(8,16,24,.9)",r,1.2,.78),oe(d,t+i/2,a+10,i-12,9,r,10,2),oe(y,t+i/2,a+42,i-12,8,"#9aa",9,3)}})(a),void ul()}if(I&&"playing"===O&&(((e,l)=>{let t=Ge();t&&("dagger"===t.id?((e,l,t)=>{"idle"===e.state||"waiting"===e.state||"spinning"===e.state?(e.state="flying",e.tx=l,e.ty=t,"idle"===e.state&&(e.dx=_e.x,e.dy=_e.y)):"flying"===e.state?(e.tx=l,e.ty=t):"returning"===e.state&&(e.state="flying",e.tx=l,e.ty=t)})(t,e,l):"sword"===t.id?((e,l,t)=>{let a=.4*(1-K.cdReduction);e.swingCD>0||e.lungeTimer>0||(e.swingCD=a,e.lungeDir=m(l,t,_e.x,_e.y)>2?h(t-_e.y,l-_e.x):_e.angle,e.lungeDist=[120,160,200,250][e.lv.a]*(1+[0,.15,.3][e.lv.c]),e.lungeStartX=_e.x,e.lungeStartY=_e.y,e.lungeTimer=.18,e.lungeProg=0,xe(_e.x+15*s(e.lungeDir),_e.y+15*f(e.lungeDir),"#f0f",6,100))})(t,e,l):"bow"===t.id&&(e=>{e.shotCD<=0&&(e.charging=1)})(t))})(I.x-S+C.x,I.y-k+C.y),I=null),D||(()=>{let e=Ge();e&&"bow"===e.id&&(e=>{if(!e.charging)return;if(e.charging=0,e.shotCD>0)return void(e.chargeTime=0);let{chargeTime:l,maxCharge:t}=e,a=p(l/t,0,1),r=_e.angle,i=10+18*a;for(let l=0;l<1;l++){let t=(l-0)*i;we(e,a,r,t,1,1,1,"#ff0");let o=p(0|e.lv.a,0,2);for(let l=1;l<=o;l++){let i=.07*l;we(e,a,r+i,t,.5,.7,.85,"#ffd84a"),we(e,a,r-i,t,.5,.7,.85,"#ffd84a")}}e.chargeTime=0,e.shotCD=.22,J(2+4*a),ee(.04,.7+.3*a),xe(_e.x+22*s(r),_e.y+22*f(r),"#fff",8,140)})(e)})(),$>0&&($-=P,P*=j),N.time+=P,N.killFlash=g(0,N.killFlash-P),N.levelUpQueue>0&&"playing"===O)return pl(),O="levelUp",N._upgradeTransition=0,void(N.refreshAvailable=1);if(C.x=x(C.x,_e.x,8*P),C.y=x(C.y,_e.y,8*P),_.fillStyle="rgba(0,0,0,0.18)",_.fillRect(0,0,b,w),Z>.2?(X=(Math.random()-.5)*Z*2,Y=(Math.random()-.5)*Z*2,Z*=.87):X=Y=Z=0,_.save(),_.translate(-C.x+S+X,-C.y+k+Y),(()=>{let e=C.x-S-100,l=C.y-k-100,t=C.x+S+100,a=C.y+k+100,r=100*v(e/100),i=100*v(l/100),o=50*v(e/50),n=50*v(l/50);_.save(),_.strokeStyle="#2a5f82",_.lineWidth=.9,_.globalAlpha=.62,_.beginPath();for(let e=r;e<=t;e+=100)_.moveTo(e,l),_.lineTo(e,a);for(let l=i;l<=a;l+=100)_.moveTo(e,l),_.lineTo(t,l);_.stroke(),_.strokeStyle="#18344a",_.lineWidth=.6,_.globalAlpha=.38,_.beginPath();for(let e=o;e<=t;e+=50)_.moveTo(e,l),_.lineTo(e,a);for(let l=n;l<=a;l+=50)_.moveTo(e,l),_.lineTo(t,l);_.stroke(),_.fillStyle="#58b7ff",_.globalAlpha=.22;for(let e=o;e<=t;e+=50)for(let l=n;l<=a;l+=50)_.fillRect(e-1.5,l-1.5,3,3);_.restore()})(),(e=>{if(!_e.alive)return;let l=N.weapons.find(e=>"sword"===e.id);if(l&&l.lungeTimer>0){_e.invuln=g(0,_e.invuln-e),_e.hitFlash=g(0,_e.hitFlash-5*e),_e.swordIFrame=g(0,_e.swordIFrame-e);let l=V(),t=l.x-_e.x,a=l.y-_e.y;return t*t+a*a>4&&(_e.angle=h(a,t)),void(N.passives.regen&&(K.regenTimer-=e,K.regenTimer<=0&&(K.regenTimer=K.regenInterval,_e.hp<_e.maxHp&&_e.hp++)))}let t=(()=>{let e=M.id>=0?M.x/M.r:0,l=M.id>=0?M.y/M.r:0,t=c(e*e+l*l);return t>0?{x:e/t,y:l/t}:{x:0,y:0}})(),a=t.x,r=t.y;_e.x+=a*K.moveSpeed*1*e,_e.y+=r*K.moveSpeed*1*e;let i=V(),o=i.x-_e.x,n=i.y-_e.y;o*o+n*n>4&&(_e.angle=h(n,o)),_e.invuln=g(0,_e.invuln-e),_e.hitFlash=g(0,_e.hitFlash-5*e),_e.swordIFrame=g(0,_e.swordIFrame-e),K.regenTimer=(K.regenTimer||0)+e,K.regenTimer>=K.regenInterval&&_e.hp<_e.maxHp&&(K.regenTimer=0,_e.hp=y(_e.hp+1,_e.maxHp))})(P),(e=>{for(let l of N.weapons)"dagger"===l.id?qe(l,e):"sword"===l.id?Xe(l,e):"bow"===l.id?Ze(l,e):"chain"===l.id?el(l,e):"rocket"===l.id&&il(l,e)})(P),(e=>{N.frozen||he.each(l=>{let t=l.cc;if(t.bleedT>0&&(t.bleedT-=e,l.hp-=t.bleedDmg*e,l.hp<=0&&gl(l)),t.stunT>0)return t.stunT-=e,void(l.hitFlash=.2);if(t.silenceT>0&&(t.silenceT-=e),t.rootT>0&&(t.rootT-=e),t.slowT>0?t.slowT-=e:t.slowAmt=0,t.fearT>0){t.fearT-=e;let a=h(l.y-_e.y,l.x-_e.x),r=1.5*(l.moveParams.speed||100);l.x+=s(a)*r*e,l.y+=f(a)*r*e}else if(t.disorientT>0)t.disorientT-=e,l.x+=200*(Math.random()-.5)*e,l.y+=200*(Math.random()-.5)*e;else if(t.kbVx||t.kbVy)l.x+=t.kbVx*e,l.y+=t.kbVy*e,t.kbVx*=.9,t.kbVy*=.9,d(t.kbVx)<5&&(t.kbVx=0),d(t.kbVy)<5&&(t.kbVy=0);else if(t.rootT<=0){let a=t.slowT>0?1-t.slowAmt:1,r=l.moveParams.speed;r&&(l.moveParams.speed=r*a),Ce[l.moveType]&&Ce[l.moveType](l,e),r&&(l.moveParams.speed=r)}if(t.markT>0?t.markT-=e:t.markAmp=0,t.silenceT<=0){let a=t.slowT>0?1-.5*t.slowAmt:1;l.fireTimer-=e*a,l.fireTimer<=0&&_e.alive&&(l.fireTimer+=l.fireCD,Re[l.firePattern]&&Re[l.firePattern](l))}l.angle+=e*("sentry"===l.moveType?1.5:.5),l.hitFlash=g(0,l.hitFlash-5*e),l._dashInvuln>0&&(l._dashInvuln=g(0,l._dashInvuln-e)),m(l.x,l.y,_e.x,_e.y)>1400&&(l.active=0)})})(P),We(de,P,0),We(ye,P,1),me(P),(e=>{for(let l=ve.length-1;l>=0;l--){let t=ve[l];t.y+=t.vy*e,t.vy+=100*e,t.life-=e,t.life<=0&&ve.splice(l,1)}})(P),(e=>{for(let l=Te.length-1;l>=0;l--)Te[l].life-=e,Te[l].life<=0&&Te.splice(l,1)})(P),_e.alive&&(ye.each(e=>{e.active&&he.each(l=>{if(l.active&&m(e.x,e.y,l.x,l.y)<e.r+l.r){if("rocket"===e.src)return e.active=0,void((e,l)=>{let t=N.weapons.find(e=>"rocket"===e.id);if(!t)return;let a=t.blastR+[0,30,50][t.lv.c],r=t.kbForce+[0,40,80,120][t.lv.a],i=[.5,.8,1.2,1.5][t.lv.a]||.5;if(xe(e,l,"#f80",25,250),xe(e,l,"#ff4",15,180),J(8),N._rocketRings||(N._rocketRings=[]),N._rocketRings.push({x:e,y:l,r:a,life:.3,maxLife:.3}),de.each(t=>{t.active&&m(e,l,t.x,t.y)<a&&(t.active=0,xe(t.x,t.y,"#f80",2,60))}),he.each(t=>{if(t.active&&m(e,l,t.x,t.y)<a+t.r){yl(t,1);let a=h(t.y-l,t.x-e);t.cc.kbVx=s(a)*r,t.cc.kbVy=f(a)*r,t.cc.disorientT=i}}),t.lv.b>0){let a=[0,5,7][t.lv.b];for(let t=0;t<a;t++){let r=n/a*t;ye.spawn(t=>{t.x=e+10*s(r),t.y=l+10*f(r),t.vx=220*s(r),t.vy=220*f(r),t.r=3,t.life=2,t.maxLife=2,t.type="normal",t.color="#fa0",t.spawnTime=N.time,t.damage=1,t.split=0,t.baseSpeed=220,t.curve=0,t.pulseAmp=0,t.src="rocket_mini",t._homing=1,t._homingDelay=.35})}}})(e.x,e.y);if("rocket_mini"===e.src)return e.active=0,xe(e.x,e.y,"#fa0",8,100),J(2),void he.each(l=>{if(l.active&&m(e.x,e.y,l.x,l.y)<40+l.r){yl(l,1);let t=h(l.y-e.y,l.x-e.x);l.cc.kbVx+=80*s(t),l.cc.kbVy+=80*f(t)}});yl(l,e.damage,e.src),e.active=0}})}),_e.invuln<=0&&(de.each(e=>{if(e.active&&m(e.x,e.y,_e.x,_e.y)<e.r+_e.r){if(K.dodgeChance>0&&Math.random()<K.dodgeChance)return;e.active=0,hl(e.damage||1)}}),he.each(e=>{e.active&&m(e.x,e.y,_e.x,_e.y)<e.r+_e.r&&hl(Fe())}))),"dying"===O)return _.restore(),Sl(P,0),void(I=null);if((e=>{if("spawning"===N.waveState){if((cl-=e)<=0){let e=4+1.6*N.wave+.9*N.difficulty;he.count()<e&&(e=>{let l="elite"===(e=e||"small");he.spawn(o=>{let n=r(),c=g(S,k)+50+t(0,100);o.x=_e.x+s(n)*c,o.y=_e.y+f(n)*c,o.shape=i(De),o.color=T(i(Ie)),o.moveType=i(Me),o.firePattern=i(Ee),o.tier=e,o.r=l?22:14;let d=1+.055*N.wave+N.wave*N.wave*.0015;if(o.hp=(l?10:3)*d|0,o.maxHp=o.hp,o.fireCD=(l?t(.9,1.6):t(1.7,3.2))/(1+.04*N.difficulty),o.fireTimer=t(.5,o.fireCD),o.hitFlash=0,o.angle=r(),o.spiralAngle=r(),o.spawnTime=N.time,o._dashTele=null,o._dashInvuln=0,o.moveParams={},o.fireParams={},o.cc={stunT:0,silenceT:0,rootT:0,slowAmt:0,slowT:0,fearT:0,markT:0,markAmp:0,kbVx:0,kbVy:0,disorientT:0,bleedDmg:0,bleedT:0},"drifter"===o.moveType){let e=t(40,80),l=r();o.vx=s(l)*e,o.vy=f(l)*e}else"orbiter"===o.moveType?(o.moveParams.radius=o.moveParams.radius||t(100,200),o.moveParams.speed=o.moveParams.speed||t(1,2.5)*(Math.random()<.5?1:-1),o.moveParams.angle=o.moveParams.angle||r()):"dasher"===o.moveType?(o.moveParams.state="wait",o.moveParams.waitTime=0,o.vx=0,o.vy=0):"weaver"===o.moveType?(o.moveParams.t=0,o.moveParams.speed=o.moveParams.speed||t(60,120),o.moveParams.freq=o.moveParams.freq||t(2,5)):"chaser"===o.moveType?(o.moveParams.speed=o.moveParams.speed||t(80,140),o.vx=0,o.vy=0):"sentry"===o.moveType?(o.vx=t(-20,20),o.vy=t(-20,20)):"converge"===o.moveType&&(o.moveParams.speed=o.moveParams.speed||150);return"radial"===o.firePattern&&(o.fireParams.count=l?a(10,16):a(6,10),o.fireParams.offset=r()),o})})(Math.random()<.1+.02*N.wave?"elite":"small"),cl=g(.3,1.95-.08*N.wave-.08*N.difficulty-N.wave*N.wave*8e-4)}N.waveKills>=N.waveQuota&&(N.waveState="clear",de.clear(),xe(_e.x,_e.y,"#fff",30,250),J(10),ee(2,.3),N.bannerTimer=2,N.bannerText="WAVE "+N.wave+" CLEAR!",N.bannerColor="#0ff",setTimeout(()=>dl(),2e3))}N.frozen&&(N.freezeTimer-=e,N.freezeTimer<=0&&(N.frozen=0))})(P),Be(de),Be(ye),he.each(e=>{let l=e.hitFlash>0?"#fff":e.color,t=e.cc;t.fearT>0&&(l="#ddd");let a=e.r+(e.hitFlash>0?2:0),r="elite"===e.tier?4:3;if("circle"===e.shape?le(e.x,e.y,a,l,r):"square"===e.shape?ae(((e,l,t,a)=>{let r=[];for(let i=0;i<4;i++){let c=a+n/4*i+o/4;r.push({x:e+s(c)*t,y:l+f(c)*t})}return r})(e.x,e.y,a,e.angle),l,1,r):ae(re(e.x,e.y,a,e.angle),l,1,r),e._dashTele&&"dasher"===e.moveType&&(e=>{if(!e._dashTele)return;let l=e._dashTele,t=1-p(l.t/g(1e-4,l.maxT),0,1),a=h(l.ty-e.y,l.tx-e.x),r=e.x+s(a)*(e.r+12),i=e.y+f(a)*(e.r+12);_.save(),ne(e.x,e.y,e.r+8+2*f(18*N.time),"rgba(255,235,140,"+(.24+.42*t)+")",2.1),_.translate(r,i),_.rotate(a);let o=7+1.8*t;_.beginPath(),_.moveTo(o,0),_.lineTo(.55*-o,.55*-o),_.lineTo(.55*-o,.55*o),_.closePath(),_.fillStyle="rgba(255,245,180,"+(.35+.4*t)+")",_.fill(),_.restore()})(e),"elite"===e.tier&&e.hp<e.maxHp){let l=2*e.r;_.fillStyle="#333",_.fillRect(e.x-l/2,e.y-e.r-8,l,3),_.fillStyle=e.color,_.fillRect(e.x-l/2,e.y-e.r-8,l*(e.hp/e.maxHp),3)}if(t.markT>0&&(_.beginPath(),_.arc(e.x,e.y-e.r-10,3,0,n),_.fillStyle="#ccc",_.fill()),(t.stunT>0||t.rootT>0||t.slowT>0||t.bleedT>0)&&(_.beginPath(),_.arc(e.x,e.y,e.r+3,0,n),_.strokeStyle="rgba(255,255,255,.4)",_.lineWidth=1.2,_.stroke()),t.silenceT>0){let l=e.r+5;_.beginPath(),_.moveTo(e.x-l,e.y-l),_.lineTo(e.x+l,e.y+l),_.moveTo(e.x+l,e.y-l),_.lineTo(e.x-l,e.y+l),_.strokeStyle="#0aa",_.lineWidth=2.2,_.globalAlpha=.85,_.stroke()}}),(()=>{if(!_e.alive)return;if(_e.invuln>0&&_e.swordIFrame<=0&&(20*N.time|0)%2==0)return;let e=_e.hitFlash>0?"#fff":"#0ff";if(ae(re(_e.x,_e.y,_e.r,_e.angle+o/2),e,1,4),_.save(),_.beginPath(),_.arc(_e.x,_e.y,.4*_e.r,0,n),_.fillStyle=e,_.globalAlpha=.15,_.fill(),_.restore(),_e.swordIFrame>0){let e=p(_e.swordIFrame/.25,0,1),l=_e.r+8+2*f(18*N.time);_.save(),_.beginPath(),_.arc(_e.x,_e.y,l,0,n),_.strokeStyle="#f6f",_.lineWidth=2.2,_.globalAlpha=.2+.35*e,_.shadowColor="#f6f",_.shadowBlur=10,_.stroke(),_.beginPath(),_.arc(_e.x,_e.y,l-4,0,n),_.strokeStyle="#8ff",_.lineWidth=1.2,_.globalAlpha=.15+.25*e,_.shadowColor="#8ff",_.shadowBlur=6,_.stroke();for(let l=0;l<2;l++){let t=14*N.time+l*o,a=re(_e.x-s(_e.angle)*(8+5*l)+2*s(t),_e.y-f(_e.angle)*(8+5*l)+2*f(t),.65*_e.r,_e.angle+o/2);_.beginPath(),_.moveTo(a[0].x,a[0].y),_.lineTo(a[1].x,a[1].y),_.lineTo(a[2].x,a[2].y),_.closePath(),_.fillStyle="#f6f",_.globalAlpha=.08+.12*e,_.fill()}_.restore()}})(),(()=>{for(let e of N.weapons)"dagger"===e.id?Qe(e):"sword"===e.id?Ye(e):"bow"===e.id?$e(e):"chain"===e.id?rl(e):"rocket"===e.id&&ol()})(),(()=>{for(let e of Te){let l=p(e.life/e.maxLife,0,1),t=.9+.1*f(40*N.time+e.phase);be(e.x1,e.y1,e.x2,e.y2,e.width*t,l,e.color,0),_.save();for(let t=0;t<5;t++){let a=(t+.5)/5+.015*f(10*N.time+t+e.phase),r=x(e.x1,e.x2,p(a,0,1)),i=x(e.y1,e.y2,p(a,0,1));_.beginPath(),_.arc(r,i,2+3*l,0,n),_.fillStyle="#fff",_.globalAlpha=.1+.25*l,_.fill()}_.restore()}})(),(()=>{for(let e of window._staticFields){let l=p(e.life/e.maxLife,0,1);_.save(),_.globalAlpha=.8*l,_.beginPath(),_.arc(e.x,e.y,e.size*l,0,n),_.fillStyle="#c6f",_.fill(),_.beginPath(),_.arc(e.x,e.y,e.size*l*2,0,n),_.fillStyle="#a0f",_.globalAlpha=.15*l,_.fill(),_.restore()}})(),ue(),(()=>{for(let t of ve){let a=t.life/t.maxLife;_.save(),_.globalAlpha=a,_.font="bold "+12*t.scale+"px monospace",_.textAlign=e,_.textBaseline=l,_.fillStyle=t.color,_.shadowColor=t.color,_.shadowBlur=6,_.fillText(t.text,t.x,t.y),_.restore()}})(),N._rocketRings)for(let e=N._rocketRings.length-1;e>=0;e--){let l=N._rocketRings[e];if(l.life-=P,l.life<=0){N._rocketRings.splice(e,1);continue}let t=1-l.life/l.maxLife;_.save(),_.beginPath(),_.arc(l.x,l.y,l.r*t,0,n),_.strokeStyle="#f80",_.lineWidth=3*(1-t),_.globalAlpha=.6*(1-t),_.shadowColor="#f80",_.shadowBlur=10,_.stroke(),_.beginPath(),_.arc(l.x,l.y,l.r*t*.6,0,n),_.strokeStyle="#ff4",_.lineWidth=2*(1-t),_.globalAlpha=.4*(1-t),_.stroke(),_.restore()}_.restore(),N.killFlash>0&&(_.save(),_.fillStyle="#fff",_.globalAlpha=3*N.killFlash,_.fillRect(0,0,b,w),_.restore()),N.frozen&&(_.save(),_.fillStyle="rgba(50,100,200,0.08)",_.fillRect(0,0,b,w),_.restore()),(()=>{let e=_.createRadialGradient(S,k,.3*y(b,w),S,k,.7*y(b,w));e.addColorStop(0,"rgba(0,0,0,0)");let l=_e.hp<=1&&_e.alive;e.addColorStop(1,l?"rgba(80,0,0,0.5)":"rgba(0,0,0,0.35)"),_.save(),_.fillStyle=e,_.fillRect(0,0,b,w),_.restore()})(),(()=>{let t=y(b-16,560),a=S-t/2,r=p(_e.hp/g(1,_e.maxHp),0,1),i=p(N.xp/N.xpToNext,0,1),o=r>.5?"#0ef":r>.25?"#fd4":"#f55";se(a,10,t,54,"rgba(0,0,0,.55)","rgba(255,255,255,.15)",1);let n=a+42,s=t-54,f=(s-18)/10;for(let e=0;e<10;e++){let l=n+e*(f+2),t=p(10*r-e,0,1);_.fillStyle="rgba(18,18,18,.95)",_.fillRect(l,19,f,12),t>0&&(_.fillStyle=o,_.fillRect(l,19,f*t,12)),_.strokeStyle="rgba(255,255,255,.24)",_.strokeRect(l,19,f,12)}_.fillStyle="rgba(18,18,18,.95)",_.fillRect(n,37,s,9),_.fillStyle="#fd4",_.fillRect(n,37,s*i,9),_.strokeStyle="rgba(255,223,74,.3)",_.strokeRect(n,37,s,9),ie("HP",a+12,19,10,"#dff"),ie("XP",a+12,36,10,"#fd4");let c=N.time%60|0;ie("TIME "+(N.time/60|0)+":"+(c<10?"0":"")+c,a+12,51,9,"#8ea");let d=y(b-80,460),h=S-d/2;if("spawning"===N.waveState){let l=p(N.waveKills/N.waveQuota,0,1);se(h,72,d,7,"rgba(20,20,20,.92)","rgba(0,255,255,.32)",1),_.fillStyle="#0ff",_.fillRect(h,72,d*l,7),ie("WAVE PROGRESS",S,82,8,"#9cd",e)}let v={chain:.8,rocket:2.2},x=S-52*g(1,N.weapons.length)/2+26;for(let t=0;t<N.weapons.length;t++){let a=N.weapons[t],r=Ve[a.id],i=x+52*t,o=w-46;se(i-18,o-12,36,24,"rgba(0,0,0,.5)",r.color,1),ie(r.name.charAt(0),i,o-1,12,r.color,e,l);let n=v[a.id];if(n&&void 0!==a.timer){let e=p(1-a.timer/n,0,1);_.fillStyle="rgba(0,0,0,.55)",_.fillRect(i-18,o+14,36,3),_.fillStyle=r.color,_.fillRect(i-18,o+14,36*e,3)}}if(N.bannerTimer>0&&(N.bannerTimer-=.016666666666666666,_.save(),_.globalAlpha=y(1,2*N.bannerTimer),ie(N.bannerText,S,k-60,24,N.bannerColor,e,l),_.restore()),N.waveBannerTimer>0){N.waveBannerTimer-=.016666666666666666;let t=y(1,N.waveBannerTimer);_.save(),_.globalAlpha=t;let a=30+20*(1-t);ie(N.waveBannerText,S,k-30,a,"#fff",e,l),_.restore()}})(),(()=>{if("playing"!==O)return;let{bx:e,by:l,r:t}=M,a=e+(M.id>=0?M.x:0),r=l+(M.id>=0?M.y:0);_.save(),_.globalAlpha=.55,_.beginPath(),_.arc(e,l,t,0,n),_.strokeStyle="#8ef",_.lineWidth=2,_.stroke(),_.globalAlpha=.75,_.beginPath(),_.arc(a,r,.45*t,0,n),_.fillStyle="#9ff",_.fill(),_.restore()})(),ul(),I=null}else Sl(P,1);else{if(I){let e=bl(),l=e.n,t=e.cw,a=e.ch,r=e.g,i=e.sx,o=e.sy,n=e.cols;for(let e=0;e<l;e++){let l=i+e%n*(t+r),s=o+(e/n|0)*(a+r);if(I.x>=l&&I.x<=l+t&&I.y>=s&&I.y<=s+a){wl(e);break}}I=null}(()=>{_.fillStyle="rgba(0,0,0,.75)",_.fillRect(0,0,b,w);let t=bl(),a=t.n,r=t.cw,i=t.ch,o=t.g,n=t.sx,s=t.sy,f=t.cols;for(let t=0;t<a;t++){let a=Ve[Oe[t]],c=n+t%f*(r+o),d=s+(t/f|0)*(i+o);se(c,d,r,i,"rgba(8,16,24,0.9)",a.color,1.2,.75),ie(a.name,c+r/2,d+20,12,a.color,e,l),oe(a.desc,c+r/2,d+62,r-12,8,"#9aa",9,4)}ul()})()}})})();</script></body></html>