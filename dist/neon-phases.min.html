<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>NEON PHASES</title><style>*{margin:0;padding:0}body{background:#000;overflow:hidden}canvas{display:block;cursor:crosshair}</style></head><body><canvas id="c"></canvas><script>"use strict";
(()=>{var ZJ={playerSpeed:240,playerHP:10,playerR:12,invulnDur:0.8,trailAlpha:0.18,maxEnemies:50,maxEBullets:900,maxPBullets:150,maxParticles:500,chunkSize:500,cullDist:1400};function x(J,Z){return J+Math.random()*(Z-J)}function HJ(J,Z){return J+Math.random()*(Z-J+1)|0}function QJ(){return Math.random()*3.141592653589793*2}function qJ(J){return J[Math.random()*J.length|0]}var f=3.141592653589793,O=f*2,{cos:I,sin:R,sqrt:y,abs:PJ,min:a,max:W,atan2:B,floor:JJ}=Math;function v(J,Z,Q){return J<Z?Z:J>Q?Q:J}function l(J,Z,Q){return J+(Z-J)*Q}function S(J,Z,Q,V){return y((J-Q)**2+(Z-V)**2)}function mJ(J,Z,Q,V,q,K){let z=q-Q,j=K-V,H=z*z+j*j;if(H<=0.000001)return S(J,Z,Q,V);let F=v(((J-Q)*z+(Z-V)*j)/H,0,1),M=Q+z*F,_=V+j*F;return S(J,Z,M,_)}function yZ(J){while(J>f)J-=O;while(J<-f)J+=O;return J}var GJ=document.getElementById("c"),$=GJ.getContext("2d"),w,b,k,h,uJ,c={x:0,y:0};function IZ(){uJ=devicePixelRatio||1,w=innerWidth,b=innerHeight,GJ.width=w*uJ,GJ.height=b*uJ,GJ.style.width=w+"px",GJ.style.height=b+"px",$.setTransform(uJ,0,0,uJ,0,0),k=w/2,h=b/2}addEventListener("resize",IZ);IZ();var MZ=new Set,AJ=k,hJ=h,i=null,sJ=!1,tJ=!1;addEventListener("keyup",(J)=>MZ.delete(J.code));addEventListener("mousemove",(J)=>{AJ=J.clientX,hJ=J.clientY});addEventListener("mousedown",(J)=>{if(J.button===0)sJ=!0;if(J.button===2)tJ=!0;i={x:J.clientX,y:J.clientY,btn:J.button}});addEventListener("mouseup",(J)=>{if(J.button===0)sJ=!1;if(J.button===2)tJ=!1});addEventListener("contextmenu",(J)=>J.preventDefault());function RJ(J){return MZ.has(J)}function $0(){let J=0,Z=0;if(RJ("KeyW")||RJ("ArrowUp"))Z=-1;if(RJ("KeyS")||RJ("ArrowDown"))Z=1;if(RJ("KeyA")||RJ("ArrowLeft"))J=-1;if(RJ("KeyD")||RJ("ArrowRight"))J=1;let Q=y(J*J+Z*Z);return Q>0?{x:J/Q,y:Z/Q}:{x:0,y:0}}function NZ(){return{x:AJ-k+c.x,y:hJ-h+c.y}}var o="title",N={time:0,$w:0.8,wave:0,$aH:0,$aV:0,$aa:"spawning",$bK:-1,$D:null,xp:0,level:1,$ap:160,$aB:0,$bd:0,$aj:!1,$a6:0,$C:0,$ad:"",$ac:"#fff",$aE:!1,$s:0,$U:0,$V:0,$al:0,$H:0,decay:!1,$bt:!1,$bF:0,$bE:0,$5:!1,echo:!1,weapons:[],$Q:{},$N:0,$aG:0,$bw:"",$bf:"",$ao:0,$aI:"",$ar:0,$as:[],$aJ:!1,$aA:0},wZ=0.64,UZ={speed:[["$P","mul",[1,1.15,1.3,1.4]],["$af","set",[0,0,0,0.08]]],regen:[["$aR","set",[999,14,8,8]]],cooldown:[["$E","set",[0,0.12,0.2,0.25]]],shield:[["$aS","set",[0,12,8]]],damage:[["$ay","mul",[1,1.3,1.5]]]},Q0={$ay:"add",$P:"mul1",$aW:"add",$af:"add",$E:"add_cap"};function vZ(J,Z,Q){if(Q===void 0)return;if(Z==="mul")E[J]*=Q;else if(Z==="mul1")E[J]*=1+Q;else if(Z==="add")E[J]+=Q;else if(Z==="add_cap")E[J]=a(0.5,E[J]+Q);else E[J]=Q}var E={$P:240,$a4:0,$bl:2,$aW:1,$E:0,$7:0,$aR:999,$af:0,$ay:1,$aS:0};function oZ(){E.$P=ZJ.playerSpeed,E.$a4=0,E.$bl=2,E.$aW=1,E.$E=0,E.$aR=999,E.$af=0,E.$ay=1,E.$aS=0;let J=N.$Q;for(let Q in UZ){let V=J[Q]|0;if(!V)continue;let q=UZ[Q];for(let K=0;K<q.length;K++){let z=q[K],j=z[2];vZ(z[0],z[1],j[a(V,j.length-1)])}}let Z=N._microBuffs;if(Z)for(let Q in Z)vZ(Q,Q0[Q]||"add",Z[Q])}var FZ=0,LZ=0,WJ=0,dJ=0,nZ=1;function FJ(J){WJ=W(WJ,J)}function V0(){if(WJ>0.2)FZ=(Math.random()-0.5)*WJ*2,LZ=(Math.random()-0.5)*WJ*2,WJ*=0.87;else FZ=LZ=WJ=0}function rJ(J,Z){dJ=J,nZ=Z}function _Z(J,Z,Q,V,q){q=q||3,$.save();for(let K=q;K>0;K--)$.beginPath(),$.arc(J,Z,Q+K*2.5,0,O),$.$c=V,$.$d=K*2,$.$a=0.07,$.stroke();$.beginPath(),$.arc(J,Z,Q,0,O),$.$c=V,$.$d=1.5,$.$a=1,$.stroke(),$.restore()}function q0(J,Z,Q,V){$.save(),$.beginPath(),$.arc(J,Z,Q+4,0,O),$.$b=V,$.$a=0.12,$.fill(),$.beginPath(),$.arc(J,Z,Q,0,O),$.$b=V,$.$a=0.9,$.fill(),$.restore()}function LJ(J,Z,Q,V){Q=Q!==!1,V=V||3;function q(){$.beginPath(),$.moveTo(J[0].x,J[0].y);for(let K=1;K<J.length;K++)$.lineTo(J[K].x,J[K].y);if(Q)$.closePath()}$.save();for(let K=V;K>0;K--)q(),$.$c=Z,$.$d=K*2.5,$.$a=0.07,$.stroke();q(),$.$c=Z,$.$d=1.5,$.$a=1,$.stroke(),$.restore()}function xJ(J,Z,Q,V){let q=[];for(let K=0;K<3;K++){let z=V+O/3*K-f/2;q.push({x:J+I(z)*Q,y:Z+R(z)*Q})}return q}function lZ(J,Z,Q,V){let q=[];for(let K=0;K<4;K++){let z=V+O/4*K+f/4;q.push({x:J+I(z)*Q,y:Z+R(z)*Q})}return q}function P(J,Z,Q,V,q,K,z){$.save(),$.font="bold "+V+"px monospace",$.$bG=K||"left",$.$bH=z||"top",$.$j=q,$.$f=10,$.$b=q,$.$a=0.5,$.fillText(J,Z,Q),$.$f=0,$.$a=1,$.fillText(J,Z,Q),$.restore()}function z0(J,Z,Q,V,q,K,z){$.save();for(let j=3;j>0;j--)$.beginPath(),$.arc(J,Z,Q,V,q),$.$c=K,$.$d=(z||2)+j*2,$.$a=0.06,$.stroke();$.beginPath(),$.arc(J,Z,Q,V,q),$.$c=K,$.$d=z||2,$.$a=1,$.stroke(),$.restore()}function eJ(J,Z){let Q=[];for(let V=0;V<J;V++){let q=Z();q.active=!1,Q.push(q)}return Q.spawn=function(V){for(let z=0;z<Q.length;z++)if(!Q[z].active)return Q[z].active=!0,V(Q[z]),Q[z];let q=0,K=1/0;for(let z=0;z<Q.length;z++)if(Q[z].$q<K)K=Q[z].$q,q=z;return Q[q].active=!0,V(Q[q]),Q[q]},Q.each=function(V){for(let q=0;q<Q.length;q++)if(Q[q].active)V(Q[q])},Q.count=function(){let V=0;for(let q=0;q<Q.length;q++)if(Q[q].active)V++;return V},Q.clear=function(){for(let V=0;V<Q.length;V++)Q[V].active=!1},Q}function bZ(){return{active:!1,x:0,y:0,vx:0,vy:0,r:4,life:0,$g:3,type:"normal",color:"#f44",$q:0,damage:1,curve:0,$R:0,$aQ:0,split:!1,$am:!1,$ag:!1,$aL:0,$L:0,$5:0,src:null,$aC:0,$aN:0,$aD:0,$aw:0,$aK:0}}function K0(){return{active:!1,x:0,y:0,vx:0,vy:0,life:0,$g:0.4,color:"#fff",r:2,$q:0}}function j0(){return{active:!1,x:0,y:0,vx:0,vy:0,r:14,hp:2,$o:2,shape:"circle",color:"#f44",$m:"drifter",$ai:"single",$az:0,$M:2,tier:"small",angle:0,$k:0,$9:0,$e:{},$4:{},$q:0,cc:{$_:0,$T:0,$an:0,$8:0,$I:0,$ah:0,$O:0,$u:0,$F:0,$G:0,$ax:0,$au:0,$1:0},$i:!1,$h:null,$bu:0}}var zJ=eJ(ZJ.maxEBullets,bZ),kJ=eJ(ZJ.maxPBullets,bZ),JZ=eJ(ZJ.maxParticles,K0),G=eJ(ZJ.maxEnemies,j0),UJ=[];function BZ(J,Z,Q,V){if(UJ.length>200)return;UJ.push({x:J+(Math.random()-0.5)*20,y:Z,vy:-60-Math.random()*30,text:V?Q+"!":""+Q,color:V?"#ff0":"#fff",life:0.6,$g:0.6,scale:V?1.4:1})}function N0(J){for(let Z=UJ.length-1;Z>=0;Z--){let Q=UJ[Z];if(Q.y+=Q.vy*J,Q.vy+=100*J,Q.life-=J,Q.life<=0)UJ.splice(Z,1)}}function F0(){for(let J of UJ){let Z=J.life/J.$g;$.save(),$.$a=Z,$.font="bold "+12*J.scale+"px monospace",$.$bG="center",$.$bH="middle",$.$b=J.color,$.$j=J.color,$.$f=6,$.fillText(J.text,J.x,J.y),$.restore()}}function lJ(J,Z,Q,V,q,K,z){JZ.spawn((j)=>{j.x=J,j.y=Z,j.vx=Q,j.vy=V,j.color=q,j.life=K||0.4,j.$g=K||0.4,j.r=z||2,j.$q=N.time})}function T(J,Z,Q,V,q){for(let K=0;K<V;K++){let z=Math.random()*O,j=q*(0.3+Math.random()*0.7);lJ(J,Z,I(z)*j,R(z)*j,Q,0.2+Math.random()*0.3,1+Math.random()*2)}}function EZ(J){JZ.each((Z)=>{if(Z.x+=Z.vx*J,Z.y+=Z.vy*J,Z.vx*=0.97,Z.vy*=0.97,Z.life-=J,Z.life<=0)Z.active=!1})}function kZ(){JZ.each((J)=>{let Z=v(J.life/J.$g,0,1);$.save(),$.$a=Z*0.8,$.beginPath(),$.arc(J.x,J.y,J.r*Z,0,O),$.$b=J.color,$.fill(),$.restore()})}var SJ=[];function L0(J){for(let Z=SJ.length-1;Z>=0;Z--){let Q=SJ[Z];if(Q.life-=J,!Number.isFinite(Q.life)||!Number.isFinite(Q.$g)||Q.$g<=0||!Number.isFinite(Q.r)||Q.r<=0||!Number.isFinite(Q.dmg)||Q.dmg<=0){SJ.splice(Z,1);continue}if(!(Q.dmgCD instanceof Map))Q.dmgCD=new Map;if(Q.life<=0){SJ.splice(Z,1);continue}if(Q.$W=(Q.$W||0)-J,Q.$W>0)continue;Q.$W=0.15,G.each((V)=>{if(!V.active)return;if(S(Q.x,Q.y,V.x,V.y)<Q.r+V.r){let q=Q.dmgCD.get(V)||0;if(N.time-q>0.25)Q.dmgCD.set(V,N.time),KJ(V,Q.dmg,"trail")}})}}function H0(){for(let J of SJ){let Z=v(J.life/J.$g,0,1),Q=J.r*(0.6+Z*0.4);$.save();let V=J.x*7+J.y*13|0,q=6+(V&7);for(let K=0;K<q;K++){let z=O/q*K+R(N.time*3+K)*0.4,j=Q*(0.3+(V+K*17)%100/100*0.7),H=J.x+I(z)*j,F=J.y+R(z)*j,M=(1.5+(V+K*31)%100/100*2)*Z;$.beginPath(),$.arc(H,F,M,0,O),$.$b=J.color,$.$a=Z*(0.4+(V+K*7)%100/100*0.4),$.fill()}$.beginPath(),$.arc(J.x,J.y,Q*0.6,0,O),$.$b=J.color,$.$a=Z*0.08,$.fill(),$.restore()}}var vJ=[],R0=24;function I0(J,Z,Q,V,q,K,z){if(vJ.length>=R0)return;if(!Number.isFinite(J)||!Number.isFinite(Z)||!Number.isFinite(Q)||!Number.isFinite(V))return;let j=Number.isFinite(q)&&q>0?q:30,H=Number.isFinite(K)&&K>0?K:1,F=Number.isFinite(z)&&z>0?z:0.8;vJ.push({x1:J,y1:Z,x2:Q,y2:V,width:j,dmg:H,life:F,$g:F,tickT:0})}function M0(J){for(let Z=vJ.length-1;Z>=0;Z--){let Q=vJ[Z];if(Q.life-=J,Q.life<=0){vJ.splice(Z,1);continue}if(Q.tickT-=J,Q.tickT>0)continue;Q.tickT=0.08,G.each((V)=>{if(!V.active)return;if(mJ(V.x,V.y,Q.x1,Q.y1,Q.x2,Q.y2)<=Q.width*0.5+V.r){if(!V.$bh||N.time-V.$bh>0.18)V.$bh=N.time,KJ(V,Q.dmg,"sword_aftershock")}})}}function _0(){for(let J of vJ){let Z=v(J.life/J.$g,0,1),Q=J.x2-J.x1,V=J.y2-J.y1,q=y(Q*Q+V*V)||1,K=Q/q,z=V/q,j=-z,H=K,F=W(6,J.width*(0.7+0.25*Z)),M=(J.x1+J.x2)*0.5,_=(J.y1+J.y2)*0.5;$.save();let X=$.createLinearGradient(J.x1,J.y1,J.x2,J.y2);X.addColorStop(0,"rgba(255,120,255,0)"),X.addColorStop(0.5,"rgba(255,120,255,"+(0.12+0.18*Z)+")"),X.addColorStop(1,"rgba(255,120,255,0)"),$.beginPath(),$.moveTo(J.x1,J.y1),$.quadraticCurveTo(M+j*F*0.85,_+H*F*0.85,J.x2,J.y2),$.quadraticCurveTo(M-j*F*0.85,_-H*F*0.85,J.x1,J.y1),$.closePath(),$.$b=X,$.$a=1,$.$j="#f0f",$.$f=20,$.fill();let Y=$.createLinearGradient(J.x1,J.y1,J.x2,J.y2);Y.addColorStop(0,"rgba(255,255,255,0)"),Y.addColorStop(0.5,"rgba(255,255,255,"+(0.18+0.2*Z)+")"),Y.addColorStop(1,"rgba(255,255,255,0)"),$.beginPath(),$.moveTo(J.x1,J.y1),$.lineTo(J.x2,J.y2),$.$c=Y,$.$d=W(1.8,F*0.18),$.$aM="round",$.$f=10,$.stroke();let D=5+(N.time*15+J.x1+J.y1|0)%4;for(let U=0;U<D;U++){let m=(U+0.5)/D+R(N.time*9+U*1.7)*0.03,A=l(J.x1,J.x2,v(m,0,1)),t=l(J.y1,J.y2,v(m,0,1)),s=R(N.time*14+U*2.2)*(F*0.22),VJ=A+j*s,e=t+H*s;$.beginPath(),$.arc(VJ,e,1.2+Z*2.2,0,O),$.$b="#f8f",$.$a=0.12+0.22*Z,$.fill(),$.beginPath(),$.arc(VJ+j*1.5,e+H*1.5,0.9+Z*1.4,0,O),$.$b="#fff",$.$a=0.08+0.18*Z,$.fill()}$.restore()}}var MJ=[],Y0=36;function X0(){let J=!1;return G.each((Z)=>{if(Z.$i)J=!0}),J}function O0(J,Z){if(MJ.length>=Y0)return;let Q=160+32*(Z.lv.a||0),V=34+8*(Z.lv.b||0),q=(8+2*(Z.lv.a||0))*2,K=L.x+I(J)*26,z=L.y+R(J)*26,j=820;MJ.push({x:K,y:z,vx:I(J)*j,vy:R(J)*j,a:J,life:0.55,$g:0.55,len:Q,width:V,dmg:q,hitSet:new Set}),T(K,z,"#f6f",7,130)}function W0(J){for(let Z=MJ.length-1;Z>=0;Z--){let Q=MJ[Z];if(Q.life-=J,Q.life<=0){MJ.splice(Z,1);continue}if(Q.x+=Q.vx*J,Q.y+=Q.vy*J,S(L.x,L.y,Q.x,Q.y)>W(w,b)*1.35){MJ.splice(Z,1);continue}let V=Q.x-I(Q.a)*Q.len*0.25,q=Q.y-R(Q.a)*Q.len*0.25,K=Q.x+I(Q.a)*Q.len*0.75,z=Q.y+R(Q.a)*Q.len*0.75;G.each((j)=>{if(!j.active||!j.$i||Q.hitSet.has(j))return;if(mJ(j.x,j.y,V,q,K,z)<=j.r+Q.width*0.45)Q.hitSet.add(j),KJ(j,Q.dmg,"sword_boss_slash"),T(j.x,j.y,"#f8f",9,170)})}}function D0(){for(let J of MJ){let Z=v(J.life/J.$g,0,1),Q=I(J.a+f/2),V=R(J.a+f/2),q=J.x-I(J.a)*J.len*0.25,K=J.y-R(J.a)*J.len*0.25,z=J.x+I(J.a)*J.len*0.75,j=J.y+R(J.a)*J.len*0.75,H=J.width*(0.8+0.35*Z),F=(q+z)*0.5,M=(K+j)*0.5;$.save();let _=$.createLinearGradient(q,K,z,j);_.addColorStop(0,"rgba(255,120,255,0)"),_.addColorStop(0.45,"rgba(255,120,255,"+(0.2+0.22*Z)+")"),_.addColorStop(1,"rgba(255,255,255,"+(0.1+0.22*Z)+")"),$.beginPath(),$.moveTo(q,K),$.quadraticCurveTo(F+Q*H*0.75,M+V*H*0.75,z,j),$.quadraticCurveTo(F-Q*H*0.75,M-V*H*0.75,q,K),$.closePath(),$.$b=_,$.$a=0.95,$.$j="#f6f",$.$f=14,$.fill(),$.restore()}}var _J=[],U0=18;function KZ(J,Z,Q,V,q,K,z,j){if(_J.length>=U0)return;let H=V||0,F=q||1,M=K||1,_=z||1,X=-R(Q),Y=I(Q),D=L.x+I(Q)*16+X*H,U=L.y+R(Q)*16+Y*H,m=W(w,b)*1.9*_,A=l(4,26,Z)*M,t=l(1.2,11,Z)*F,s=v(J.lv.a|0,0,2);m*=1+s*0.08,A*=1+s*0.08,t*=1+s*0.07;let VJ=D+I(Q)*m,e=U+R(Q)*m;G.each((g)=>{if(!g.active)return;if(mJ(g.x,g.y,D,U,VJ,e)<=A*0.5+g.r){KJ(g,t,"bow_beam");let C=v(J.lv.c|0,0,2);if(C>0)g.cc.$au=W(g.cc.$au,[0,1.2,2.2][C]),g.cc.$1=W(g.cc.$1,[0,1.5,2.5][C])}}),zJ.each((g)=>{if(!g.active)return;if(mJ(g.x,g.y,D,U,VJ,e)<=A*0.55+g.r)g.active=!1,T(g.x,g.y,"#ff0",2,70)});for(let g=0;g<6;g++){let C=0.15+g*0.15;T(l(D,VJ,C),l(U,e,C),"#ff0",2,60)}_J.push({x1:D,y1:U,x2:VJ,y2:e,width:A,length:m,life:0.12+Z*0.1,$g:0.12+Z*0.1,color:j||"#ff0",phase:QJ()})}function v0(J){for(let Z=_J.length-1;Z>=0;Z--)if(_J[Z].life-=J,_J[Z].life<=0)_J.splice(Z,1)}function B0(){for(let J of _J){let Z=v(J.life/J.$g,0,1),Q=0.9+R(N.time*40+J.phase)*0.1,V=J.width*(0.8+0.4*Z)*Q,q=W(3,J.width*0.3*(0.8+0.3*Z)),K=W(2,J.width*0.12);$.save(),$.$aM="round";let z=$.createLinearGradient(J.x1,J.y1,J.x2,J.y2);z.addColorStop(0,"rgba(255,216,74,0)"),z.addColorStop(0.08,"rgba(255,216,74,"+(0.12+0.14*Z)+")"),z.addColorStop(1,"rgba(255,216,74,"+(0.08+0.2*Z)+")"),$.beginPath(),$.moveTo(J.x1,J.y1),$.lineTo(J.x2,J.y2),$.$c=z,$.$d=V,$.$a=1,$.$j=J.color,$.$f=20,$.stroke();let j=$.createLinearGradient(J.x1,J.y1,J.x2,J.y2);j.addColorStop(0,"rgba(255,255,255,0)"),j.addColorStop(0.08,"rgba(255,255,255,"+(0.16+0.2*Z)+")"),j.addColorStop(1,"rgba(255,216,74,"+(0.2+0.4*Z)+")"),$.beginPath(),$.moveTo(J.x1,J.y1),$.lineTo(J.x2,J.y2),$.$c=j,$.$d=q,$.$a=1,$.$f=12,$.stroke();let H=$.createLinearGradient(J.x1,J.y1,J.x2,J.y2);H.addColorStop(0,"rgba(255,255,255,0)"),H.addColorStop(0.1,"rgba(255,255,255,"+(0.25+0.25*Z)+")"),H.addColorStop(1,"rgba(255,255,255,"+(0.35+0.45*Z)+")"),$.beginPath(),$.moveTo(J.x1,J.y1),$.lineTo(J.x2,J.y2),$.$c=H,$.$d=K,$.$a=1,$.$f=8,$.stroke();for(let F=0;F<5;F++){let M=(F+0.5)/5+R(N.time*10+F+J.phase)*0.015,_=l(J.x1,J.x2,v(M,0,1)),X=l(J.y1,J.y2,v(M,0,1));$.beginPath(),$.arc(_,X,2+Z*3,0,O),$.$b="#fff",$.$a=0.1+0.25*Z,$.fill()}$.restore()}}var DJ=[];function E0(J){DJ.push({owner:J.owner||null,x1:J.x1||0,y1:J.y1||0,angle:J.angle||0,length:J.length||800,width:J.width||20,$a_:J.$a_||0,life:J.life||0.9,$g:J.life||0.9,color:J.color||"#f66",$bq:J.$bq||0,$br:J.$br||0,warn:J.warn||0,$bD:J.warn||0,$aU:J.$aU||"#ffcc66"})}function k0(J){N.$ar=W(0,(N.$ar||0)-J);for(let Z=DJ.length-1;Z>=0;Z--){let Q=DJ[Z];if(!Q.owner||!Q.owner.active){DJ.splice(Z,1);continue}if(Q.angle+=Q.$a_*J,Q.x1=Q.owner.x+Q.$bq,Q.y1=Q.owner.y+Q.$br,Q.warn>0){Q.warn=W(0,Q.warn-J);continue}if(Q.life-=J,Q.life<=0){DJ.splice(Z,1);continue}let V=Q.x1+I(Q.angle)*Q.length,q=Q.y1+R(Q.angle)*Q.length;if(L.alive&&L.invuln<=0&&N.$ar<=0){if(mJ(L.x,L.y,Q.x1,Q.y1,V,q)<=Q.width*0.45+L.r)N.$ar=0.12,aJ()}}}function T0(){for(let J of DJ){let Z=v(J.life/J.$g,0,1),Q=J.x1+I(J.angle)*J.length,V=J.y1+R(J.angle)*J.length;if(J.warn>0){let M=v(J.warn/W(0.0001,J.$bD),0,1),_=0.45+0.45*PJ(R(N.time*18));$.save(),$.$aM="round",$.setLineDash([12,10]),$.beginPath(),$.moveTo(J.x1,J.y1),$.lineTo(Q,V),$.$c=J.$aU,$.$d=W(2,J.width*0.22),$.$a=(0.2+0.55*(1-M))*_,$.$j=J.$aU,$.$f=10,$.stroke(),$.setLineDash([]),$.restore();continue}let q=J.width*(1+0.35*Z),K=W(4,J.width*0.45*(0.85+0.25*Z)),z=W(2.5,J.width*0.2);$.save(),$.$aM="round";let j=$.createLinearGradient(J.x1,J.y1,Q,V);j.addColorStop(0,"rgba(255,255,255,0)"),j.addColorStop(0.08,"rgba(255,216,74,"+(0.12+0.14*Z)+")"),j.addColorStop(1,"rgba(255,120,120,"+(0.1+0.22*Z)+")"),$.beginPath(),$.moveTo(J.x1,J.y1),$.lineTo(Q,V),$.$c=j,$.$d=q,$.$a=1,$.$j=J.color,$.$f=18,$.stroke();let H=$.createLinearGradient(J.x1,J.y1,Q,V);H.addColorStop(0,"rgba(255,255,255,0)"),H.addColorStop(0.1,"rgba(255,255,255,"+(0.15+0.2*Z)+")"),H.addColorStop(1,"rgba(255,180,180,"+(0.2+0.38*Z)+")"),$.beginPath(),$.moveTo(J.x1,J.y1),$.lineTo(Q,V),$.$c=H,$.$d=K,$.$f=10,$.stroke();let F=$.createLinearGradient(J.x1,J.y1,Q,V);F.addColorStop(0,"rgba(255,255,255,0)"),F.addColorStop(0.12,"rgba(255,255,255,"+(0.25+0.25*Z)+")"),F.addColorStop(1,"rgba(255,255,255,"+(0.3+0.4*Z)+")"),$.beginPath(),$.moveTo(J.x1,J.y1),$.lineTo(Q,V),$.$c=F,$.$d=z,$.$f=6,$.stroke(),$.restore()}}var NJ=ZJ.chunkSize,bJ=new Map,C0=Math.random()*4294967295>>>0;function S0(J,Z){let Q=(J*374761393+Z*668265263^C0)>>>0;return Q=Math.imul(Q^Q>>>13,1274126177),(Q^Q>>>16)>>>0}function P0(J,Z){return(J+1048576)*2097152+(Z+1048576)}function YZ(J,Z){let Q=P0(J,Z);if(bJ.has(Q))return bJ.get(Q);let V=S0(J,Z),q=()=>{return V=V*1103515245+12345&2147483647,V/2147483647},K=JJ(q()*5),z=[],j=12,H=(F)=>{for(let M=0;M<z.length;M++){let _=z[M];if(F.type==="pillar"&&_.type==="pillar"){if(S(F.x,F.y,_.x,_.y)<F.r+_.r+j)return!0}else{let X=F.type==="pillar"?{x:F.x-F.r,y:F.y-F.r,w:F.r*2,h:F.r*2}:F,Y=_.type==="pillar"?{x:_.x-_.r,y:_.y-_.r,w:_.r*2,h:_.r*2}:_;if(X.x<X.x+X.w&&Y.x<Y.x+Y.w){let D=X.x<Y.x+Y.w&&X.x+X.w>Y.x,U=X.y<Y.y+Y.h&&X.y+X.h>Y.y;if(D&&U){if(!(X.x+X.w+j<Y.x||X.x>Y.x+Y.w+j||X.y+X.h+j<Y.y||X.y>Y.y+Y.h+j))return!0}}}}return!1};for(let F=0;F<K;F++){let M=!1;for(let _=0;_<10;_++){let X=J*NJ+q()*(NJ-120)+60,Y=Z*NJ+q()*(NJ-120)+60,D=q()<0.5?{type:"pillar",x:X,y:Y,r:18+q()*32}:{type:"wall",x:X-(50+q()*110)/2,y:Y-(18+q()*45)/2,w:50+q()*110,h:18+q()*45};if(!H(D)){z.push(D),M=!0;break}}if(!M)continue}return bJ.set(Q,z),z}function A0(J,Z,Q,V){let q=J.x-Z,K=J.y-Q,z=y(q*q+K*K),j=J.r+V;if(z<j&&z>0.01)J.x=Z+q/z*j,J.y=Q+K/z*j}function h0(J,Z,Q,V,q){let K=v(J.x,Z,Z+V),z=v(J.y,Q,Q+q),j=J.x-K,H=J.y-z,F=y(j*j+H*H);if(F<J.r&&F>0.01)J.x=K+j/F*J.r,J.y=z+H/F*J.r;else if(F<=0.01&&J.x>=Z&&J.x<=Z+V&&J.y>=Q&&J.y<=Q+q){let M=[J.x-Z,Z+V-J.x,J.y-Q,Q+q-J.y],_=M.indexOf(a(...M));if(_===0)J.x=Z-J.r;else if(_===1)J.x=Z+V+J.r;else if(_===2)J.y=Q-J.r;else J.y=Q+q+J.r}}function $J(J){let Z=JJ(J.x/NJ),Q=JJ(J.y/NJ);for(let V=-1;V<=1;V++)for(let q=-1;q<=1;q++){let K=YZ(Z+V,Q+q);for(let z=0;z<K.length;z++)K[z].type==="pillar"?A0(J,K[z].x,K[z].y,K[z].r):h0(J,K[z].x,K[z].y,K[z].w,K[z].h)}}function f0(J){let Z=JJ(J.x/NJ),Q=JJ(J.y/NJ);for(let V=-1;V<=1;V++)for(let q=-1;q<=1;q++){let K=YZ(Z+V,Q+q);for(let z=0;z<K.length;z++){let j=K[z];if(j.type==="pillar"){if(S(J.x,J.y,j.x,j.y)<J.r+j.r)return j}else{let H=v(J.x,j.x,j.x+j.w),F=v(J.y,j.y,j.y+j.h);if(S(J.x,J.y,H,F)<J.r)return j}}}return null}function u0(J,Z){let Q,V;if(Z.type==="pillar"){let K=J.x-Z.x,z=J.y-Z.y,j=y(K*K+z*z)||1;Q=K/j,V=z/j,J.x=Z.x+Q*(Z.r+J.r+1),J.y=Z.y+V*(Z.r+J.r+1)}else{let K=v(J.x,Z.x,Z.x+Z.w),z=v(J.y,Z.y,Z.y+Z.h);Q=J.x-K,V=J.y-z;let j=y(Q*Q+V*V)||1;Q/=j,V/=j,J.x=K+Q*(J.r+1),J.y=z+V*(J.r+1)}let q=J.vx*Q+J.vy*V;J.vx-=2*q*Q,J.vy-=2*q*V}function G0(){let Z=c.x-k-100,Q=c.y-h-100,V=c.x+k+100,q=c.y+h+100,K=JJ(Z/100)*100,z=JJ(Q/100)*100;$.save(),$.$c="#111d28",$.$d=0.5,$.$a=0.5,$.beginPath();for(let j=K;j<=V;j+=100)$.moveTo(j,Q),$.lineTo(j,q);for(let j=z;j<=q;j+=100)$.moveTo(Z,j),$.lineTo(V,j);$.stroke(),$.restore()}function g0(){let J=JJ((c.x-k)/NJ)-1,Z=JJ((c.x+k)/NJ)+1,Q=JJ((c.y-h)/NJ)-1,V=JJ((c.y+h)/NJ)+1;for(let q=J;q<=Z;q++)for(let K=Q;K<=V;K++){let z=YZ(q,K);for(let j=0;j<z.length;j++){let H=z[j];if(H.type==="pillar")$.save(),$.beginPath(),$.arc(H.x,H.y,H.r,0,O),$.$b="#0a1520",$.$a=0.6,$.fill(),$.restore(),_Z(H.x,H.y,H.r,"#1a4a6a",2);else $.save(),$.$b="#0a1520",$.$a=0.6,$.fillRect(H.x,H.y,H.w,H.h),$.restore(),LJ([{x:H.x,y:H.y},{x:H.x+H.w,y:H.y},{x:H.x+H.w,y:H.y+H.h},{x:H.x,y:H.y+H.h}],"#1a4a6a",!0,2)}}}var L={x:0,y:0,r:ZJ.playerR,hp:ZJ.playerHP,$o:ZJ.playerHP,invuln:0,angle:0,$k:0,alive:!0,$y:0};function m0(){L.x=0,L.y=0,L.hp=ZJ.playerHP,L.$o=ZJ.playerHP,L.invuln=0,L.$k=0,L.alive=!0,L.angle=0,L.$aF=!1,L.shieldCD=0,L.$y=0}function y0(J){if(!L.alive)return;let Z=N.weapons.find((F)=>F.id==="sword");if(Z&&Z.$x>0){L.invuln=W(0,L.invuln-J),L.$k=W(0,L.$k-J*5),L.$y=W(0,L.$y-J);let F=NZ(),M=F.x-L.x,_=F.y-L.y;if(M*M+_*_>4)L.angle=B(_,M);if($J(L),N.$Q.regen){if(E.$7-=J,E.$7<=0){if(E.$7=E.$aR,L.hp<L.$o)L.hp++}}return}let Q=$0(),V=Q.x,q=Q.y;if(N.$bt)V=-V,q=-q;let K=1;if(L.x+=V*E.$P*K*J,L.y+=q*E.$P*K*J,V!==0||q!==0)L.x+=N.$U*J*0.3,L.y+=N.$V*J*0.3;$J(L);let z=NZ(),j=z.x-L.x,H=z.y-L.y;if(j*j+H*H>4)L.angle=B(H,j);if(L.invuln=W(0,L.invuln-J),L.$k=W(0,L.$k-J*5),L.$y=W(0,L.$y-J),E.$7=(E.$7||0)+J,E.$7>=E.$aR&&L.hp<L.$o)E.$7=0,L.hp=a(L.hp+1,L.$o);if(E.$aS>0&&!L.$aF){if(L.shieldCD=(L.shieldCD||0)-J,L.shieldCD<=0)L.$aF=!0,T(L.x,L.y,"#4af",6,80)}}function w0(){if(!L.alive)return;if(L.invuln>0&&L.$y<=0&&(N.time*20|0)%2===0)return;let J=L.$k>0?"#fff":"#0ff";if(LJ(xJ(L.x,L.y,L.r,L.angle+f/2),J,!0,4),$.save(),$.beginPath(),$.arc(L.x,L.y,L.r*0.4,0,O),$.$b=J,$.$a=0.15,$.fill(),$.restore(),L.$y>0){let Z=v(L.$y/0.25,0,1),Q=L.r+8+R(N.time*18)*2;$.save(),$.beginPath(),$.arc(L.x,L.y,Q,0,O),$.$c="#f6f",$.$d=2.2,$.$a=0.2+0.35*Z,$.$j="#f6f",$.$f=10,$.stroke(),$.beginPath(),$.arc(L.x,L.y,Q-4,0,O),$.$c="#8ff",$.$d=1.2,$.$a=0.15+0.25*Z,$.$j="#8ff",$.$f=6,$.stroke();for(let V=0;V<2;V++){let q=N.time*14+V*f,K=L.x-I(L.angle)*(8+V*5)+I(q)*2,z=L.y-R(L.angle)*(8+V*5)+R(q)*2,j=xJ(K,z,L.r*0.65,L.angle+f/2);$.beginPath(),$.moveTo(j[0].x,j[0].y),$.lineTo(j[1].x,j[1].y),$.lineTo(j[2].x,j[2].y),$.closePath(),$.$b="#f6f",$.$a=0.08+0.12*Z,$.fill()}$.restore()}if(L.$aF)$.save(),$.beginPath(),$.arc(L.x,L.y,L.r+6,0,O),$.$c="#4af",$.$d=2,$.$a=0.5+R(N.time*4)*0.2,$.$j="#4af",$.$f=8,$.stroke(),$.restore()}var iZ=[{name:"MIRROR",color:"#f0f",desc:"Bullets $aE off obstacles",apply(){N.$aE=!0},unapply(){N.$aE=!1},tick(){}},{name:"GRAVITY",color:"#84f",desc:"Bullets strongly curve toward you",apply(){N.$s=220},unapply(){N.$s=0},tick(){}},{name:"DRIFT",color:"#4ff",desc:"Wind pushes everything",apply(){let J=QJ();N.$U=I(J)*80,N.$V=R(J)*80},unapply(){N.$U=0,N.$V=0},tick(J){let Z=B(N.$V,N.$U)+J*0.3,Q=y(N.$U**2+N.$V**2);N.$U=I(Z)*Q,N.$V=R(Z)*Q}},{name:"PULSE",color:"#ff0",desc:"Periodic bullet speed bursts",apply(){N.$al=0,N.$H=0},unapply(){N.$H=0,N.$al=0},tick(J){if(N.$al+=J,N.$al>3)N.$al=0,N.$H=200,FJ(5);if(N.$H>0)N.$H=W(0,N.$H-400*J)}},{name:"DECAY",color:"#4f4",desc:"Bullets slow down and pop",apply(){N.decay=!0},unapply(){N.decay=!1},tick(){}},{name:"ECHO",color:"#0af",desc:"Bullets spawn ghost copies",apply(){N.echo=!0},unapply(){N.echo=!1},tick(){}}],n=null,HZ=-1;function o0(){let J,Z=0;do J=HJ(0,iZ.length-1),Z++;while(J===HZ&&Z<10);return HZ=J,J}function n0(J){if(n)n.unapply();N.$bK=J,n=iZ[J],n.apply()}var TZ={drifter(J,Z){if(J.x+=J.vx*Z,J.y+=J.vy*Z,S(J.x,J.y,L.x,L.y)>500){let q=B(L.y-J.y,L.x-J.x);J.vx+=I(q)*40*Z,J.vy+=R(q)*40*Z}let V=y(J.vx**2+J.vy**2);if(V>100)J.vx*=100/V,J.vy*=100/V;$J(J)},chaser(J,Z){let Q=B(L.y-J.y,L.x-J.x),V=J.$e.speed||120;J.vx=l(J.vx,I(Q)*V,2*Z),J.vy=l(J.vy,R(Q)*V,2*Z),J.x+=J.vx*Z,J.y+=J.vy*Z,$J(J)},orbiter(J,Z){let Q=J.$e.radius||150;J.$e.angle=(J.$e.angle||0)+(J.$e.speed||1.5)*Z,J.x=l(J.x,L.x+I(J.$e.angle)*Q,3*Z),J.y=l(J.y,L.y+R(J.$e.angle)*Q,3*Z),$J(J)},dasher(J,Z){let Q=J.$e;if(!Q.state)Q.state="wait";if(Q.state==="wait"){Q.waitTime=(Q.waitTime||0)+Z;let V=B(L.y-J.y,L.x-J.x);if(J.x+=I(V)*20*Z,J.y+=R(V)*20*Z,Q.waitTime>1.5){let q=B(L.y-J.y,L.x-J.x),K=v(S(J.x,J.y,L.x,L.y)+36,120,260);Q.state="telegraph",Q.dashTx=J.x+I(q)*K,Q.dashTy=J.y+R(q)*K,Q.teleT=1,Q.teleMax=1,J.$z={t:1,maxT:1,tx:Q.dashTx,ty:Q.dashTy}}}else if(Q.state==="telegraph"){if(Q.teleT-=Z,J.$l=W(J.$l,0.1),J.$z)J.$z.t=Q.teleT;if(Q.teleT<=0)Q.state="dashing",Q.dashT=0.32,Q.dashMax=0.32,Q.sx=J.x,Q.sy=J.y,Q.ex=Q.dashTx,Q.ey=Q.dashTy,J.$z=null}else{Q.dashT-=Z;let V=v(1-Q.dashT/Q.dashMax,0,1),q=1-(1-V)*(1-V);if(J.x=l(Q.sx,Q.ex,q),J.y=l(Q.sy,Q.ey,q),J.$l=W(J.$l,0.3),Q.dashT<=0)J.x=Q.ex,J.y=Q.ey,Q.state="wait",Q.waitTime=0}$J(J)},sentry(J,Z){let Q=B(L.y-J.y,L.x-J.x);J.x+=I(Q)*15*Z,J.y+=R(Q)*15*Z,J.angle+=1.5*Z,$J(J)},weaver(J,Z){let Q=J.$e;Q.t=(Q.t||0)+Z;let V=B(L.y-J.y,L.x-J.x),q=Q.speed||100,K=Q.freq||2,z=V+f/2,j=R(Q.t*K)*80;J.x+=(I(V)*q+I(z)*j*K)*Z,J.y+=(R(V)*q+R(z)*j*K)*Z,$J(J)},stationary(J,Z){$J(J)},bossChase(J,Z){let Q=B(L.y-J.y,L.x-J.x);J.x+=I(Q)*60*Z,J.y+=R(Q)*60*Z,$J(J)},converge(J,Z){let Q=B(L.y-J.y,L.x-J.x),V=J.$e.speed||150;J.x+=I(Q)*V*Z,J.y+=R(Q)*V*Z,$J(J)}},cJ={single(J){let Z=B(L.y-J.y,L.x-J.x),Q=180+N.$w*10;IJ(J.x,J.y,I(Z)*Q,R(Z)*Q,4,J.color,"normal",3)},triple(J){let Z=B(L.y-J.y,L.x-J.x),Q=170+N.$w*8;for(let V=-1;V<=1;V++)IJ(J.x,J.y,I(Z+V*0.2)*Q,R(Z+V*0.2)*Q,3.5,J.color,"normal",2.5)},radial(J){let Z=J.$4.count||8,Q=140+N.$w*5,V=J.$4.offset||0;for(let q=0;q<Z;q++){let K=O/Z*q+V;IJ(J.x,J.y,I(K)*Q,R(K)*Q,3.5,J.color,"normal",3)}J.$4.offset=(V+0.15)%O},spiral(J){let Z=160+N.$w*6;J.$9=(J.$9||0)+0.4,IJ(J.x,J.y,I(J.$9)*Z,R(J.$9)*Z,4,J.color,"curve",3.5,{curve:0.4})},ringpop(J){for(let V=0;V<10;V++){let q=O/10*V;IJ(J.x,J.y,I(q)*200,R(q)*200,3,J.color,"pulse",3,{$R:0.7,$aQ:3})}},wave(J){let Z=B(L.y-J.y,L.x-J.x),Q=160+N.$w*5,V=Z+f/2;for(let q=0;q<5;q++){let K=(q-2)*15;IJ(J.x+I(V)*K,J.y+R(V)*K,I(Z)*Q,R(Z)*Q,3,J.color,"normal",3)}},bossRadial(J){let V=J.$9||0;for(let q=0;q<16;q++){let K=O/16*q+V;BJ(J.x,J.y,I(K)*150,R(K)*150,5,J.color,"normal",4)}J.$9=(V+0.2)%O},bossWall(J){let Z=B(L.y-J.y,L.x-J.x),Q=Z+f/2;for(let z=0;z<13;z++){let j=(z-6)*30,H=J.x+I(Q)*j,F=J.y+R(Q)*j;BJ(H,F,I(Z)*220,R(Z)*220,4.2,J.color,"normal",3.2)}}};function l0(){let J=qJ(["normal","$s","speed_shift","wind_shift","homing"]);if(J==="$s")return{$n:"$s",$av:360+Math.random()*220};if(J==="speed_shift")return{$n:"speed_shift",$av:1.25+Math.random()*0.95,$a1:6+Math.random()*4,$a2:QJ()};if(J==="wind_shift"){let Z=QJ(),Q=260+Math.random()*170;return{$n:"wind_shift",$2:I(Z)*Q,$3:R(Z)*Q,$a3:0.8+Math.random()*1.1}}if(J==="homing")return{$n:"homing",$aw:2.4+Math.random()*1.8,$aK:150+Math.random()*90};return{$n:"normal"}}function IJ(J,Z,Q,V,q,K,z,j,H){zJ.spawn((F)=>{F.x=J,F.y=Z,F.vx=Q,F.vy=V,F.r=q||4,F.color=K||"#f44",F.type=z||"normal",F.life=j||3,F.$g=j||3,F.$q=N.time,F.$am=!1,F.$ag=!1,F.$aL=0,F.damage=1,F.curve=H&&H.curve||0,F.$R=H&&H.$R||0,F.$aQ=H&&H.$aQ||0,F.split=H&&H.split||!1,F.$L=y(Q*Q+V*V),F.$aC=H&&H.$aC||0,F.$aN=H&&H.$aN||0,F.$aD=H&&H.$aD!==void 0?H.$aD:B(V,Q),F.$n=H&&H.$n||"normal",F.$av=H&&H.$av||0,F.$a1=H&&H.$a1||0,F.$a2=H&&H.$a2||0,F.$2=H&&H.$2||0,F.$3=H&&H.$3||0,F.$a3=H&&H.$a3||0,F.$aw=H&&H.$aw||0,F.$aK=H&&H.$aK||0})}function BJ(J,Z,Q,V,q,K,z,j,H){let F=l0();if(H)for(let M in H)F[M]=H[M];IJ(J,Z,Q,V,q,K,z,j,F)}var b0=["#f44","#f84","#ff4","#4f4","#4ff","#f4f","#84f"],i0=["circle","square","triangle"],p0=["drifter","chaser","orbiter","dasher","sentry","weaver"],d0=["single","triple","radial","spiral","ringpop","wave"];function pZ(J,Z){J=J||"small";let Q=J==="elite";G.spawn((V)=>{let q=QJ(),K=W(k,h)+50+x(0,100);V.x=Z&&Z.x!==void 0?Z.x:L.x+I(q)*K,V.y=Z&&Z.y!==void 0?Z.y:L.y+R(q)*K,V.shape=Z&&Z.shape||qJ(i0),V.color=Z&&Z.color||qJ(b0),V.$m=Z&&Z.$m||qJ(p0),V.$ai=Z&&Z.$ai||qJ(d0),V.tier=J,V.r=Q?22:14;let z=1+N.wave*0.11+N.wave*N.wave*0.003;if(V.hp=(Q?10:3)*z|0,V.$o=V.hp,V.$M=(Q?x(0.8,1.5):x(1.5,3))/(1+N.$w*0.08),Z&&Z.fireMult)V.$M/=Z.fireMult;if(V.$az=x(0.5,V.$M),V.$k=0,V.angle=QJ(),V.$9=QJ(),V.$q=N.time,V.$z=null,V.$l=0,V.$e=Z&&Z.$e||{},V.$4={},V.$i=!1,V.$h=null,V.$bu=0,V.cc={$_:0,$T:0,$an:0,$8:0,$I:0,$ah:0,$O:0,$u:0,$F:0,$G:0,$ax:0,$au:0,$1:0},V.$m==="drifter"){let j=x(40,80),H=QJ();V.vx=I(H)*j,V.vy=R(H)*j}else if(V.$m==="orbiter")V.$e.radius=V.$e.radius||x(100,200),V.$e.speed=V.$e.speed||x(1,2.5)*(Math.random()<0.5?1:-1),V.$e.angle=V.$e.angle||QJ();else if(V.$m==="dasher")V.$e.state="wait",V.$e.waitTime=0,V.vx=0,V.vy=0;else if(V.$m==="weaver")V.$e.t=0,V.$e.speed=V.$e.speed||x(60,120),V.$e.freq=V.$e.freq||x(2,5);else if(V.$m==="chaser")V.$e.speed=V.$e.speed||x(80,140),V.vx=0,V.vy=0;else if(V.$m==="sentry")V.vx=x(-20,20),V.vy=x(-20,20);else if(V.$m==="converge")V.$e.speed=V.$e.speed||150;if(V.$ai==="radial")V.$4.count=Q?HJ(10,16):HJ(6,10),V.$4.offset=QJ();if(Z&&Z.hpMult)V.hp=V.hp*Z.hpMult|0,V.$o=V.hp;if(Z&&Z.spdMult)V.$e.speed=(V.$e.speed||100)*Z.spdMult;return V})}function r0(J){if(N.$aj)return;G.each((Z)=>{let Q=Z.cc;if(Q.$1>0){if(Q.$1-=J,Z.hp-=Q.$au*J,Z.hp<=0)tZ(Z)}if(Q.$_>0){Q.$_-=J,Z.$k=0.2;return}if(Q.$T>0)Q.$T-=J;if(Q.$an>0)Q.$an-=J;if(Q.$I>0)Q.$I-=J;else Q.$8=0;if(Q.$ah>0){Q.$ah-=J;let V=B(Z.y-L.y,Z.x-L.x),q=(Z.$e.speed||100)*1.5;Z.x+=I(V)*q*J,Z.y+=R(V)*q*J,$J(Z)}else if(Q.$ax>0)Q.$ax-=J,Z.x+=(Math.random()-0.5)*200*J,Z.y+=(Math.random()-0.5)*200*J,$J(Z);else if(Q.$F||Q.$G){if(Z.x+=Q.$F*J,Z.y+=Q.$G*J,Q.$F*=0.9,Q.$G*=0.9,PJ(Q.$F)<5)Q.$F=0;if(PJ(Q.$G)<5)Q.$G=0;$J(Z)}else if(Q.$an<=0){let V=Q.$I>0?1-Q.$8:1,q=Z.$e.speed;if(q)Z.$e.speed=q*V;if(Z.$i&&Z.$h)Z.$h.update(Z,J);else if(TZ[Z.$m])TZ[Z.$m](Z,J);if(q)Z.$e.speed=q}if(Q.$O>0)Q.$O-=J;else Q.$u=0;if(Q.$T<=0){let V=Q.$I>0?1-Q.$8*0.5:1;if(Z.$az-=J*V,Z.$az<=0&&L.alive){if(Z.$az+=Z.$M,Z.$i&&Z.$h)Z.$h.fire(Z);else if(cJ[Z.$ai])cJ[Z.$ai](Z)}}if(Z.angle+=J*(Z.$m==="sentry"?1.5:0.5),Z.$k=W(0,Z.$k-J*5),Z.$l>0)Z.$l=W(0,Z.$l-J);if(S(Z.x,Z.y,L.x,L.y)>ZJ.cullDist&&!Z.$i)Z.active=!1})}function x0(J){let Z=N.time,Q=J.r,V=J.color||"#f6c";$.save(),$.translate(J.x,J.y),$.rotate(J.angle*0.6);let q=J.$bA||"circle";if(q==="square")LJ(lZ(0,0,Q,0),V,!0,6);else if(q==="triangle")LJ(xJ(0,0,Q,0),V,!0,6);else _Z(0,0,Q,V,6);let K=J.$by|0;if(K===0)for(let z=0;z<4;z++){let j=Z*1.7+O/4*z;$.beginPath(),$.arc(I(j)*Q*0.8,R(j)*Q*0.8,2.5,0,O),$.$b="#fff",$.$a=0.55,$.fill()}else if(K===1){$.rotate(Z*1.4),$.beginPath();for(let z=0;z<8;z++){let j=O/8*z,H=z%2===0?Q+8:Q*0.6,F=I(j)*H,M=R(j)*H;if(z===0)$.moveTo(F,M);else $.lineTo(F,M)}$.closePath(),$.$c=V,$.$d=1.8,$.$a=0.5,$.stroke()}else for(let z=0;z<3;z++){let j=Z*1.1+z*2.1,H=Q*0.55+z*6;$.beginPath(),$.arc(I(j)*H,R(j)*H,3,0,O),$.$b=V,$.$a=0.4,$.fill()}if($.beginPath(),$.arc(0,0,Q*0.24+R(Z*5)*1.2,0,O),$.$b="#fff",$.$a=0.7,$.fill(),J.$l>0){let z=v(J.$l/0.3,0,1);$.beginPath(),$.arc(0,0,Q+8+R(Z*16)*2,0,O),$.$c="#ffd0ff",$.$d=2.4,$.$a=0.28+0.35*z,$.$j="#f6f",$.$f=12,$.stroke(),$.beginPath(),$.arc(0,0,Q+3,0,O),$.$c="#fff",$.$d=1.2,$.$a=0.18+0.25*z,$.$f=7,$.stroke()}if($.restore(),J.$h&&J.$h.$p&&J.$h.$p.some((z)=>z.hp>0))for(let z of J.$h.$p){if(z.hp<=0)continue;let j=J.x+I(z.angle)*(J.r+22),H=J.y+R(z.angle)*(J.r+22),F=z.angle+f/2,M=10,_=[];for(let X=0;X<6;X++){let Y=F+O/6*X;_.push({x:j+I(Y)*M,y:H+R(Y)*M})}$.save(),$.beginPath(),$.moveTo(_[0].x,_[0].y);for(let X=1;X<_.length;X++)$.lineTo(_[X].x,_[X].y);$.closePath(),$.$b="rgba(235,245,255,.22)",$.$c=V,$.$d=2,$.$j=V,$.$f=10,$.fill(),$.stroke(),$.beginPath(),$.arc(j,H,M+5,z.angle-0.65,z.angle+0.65),$.$c="rgba(255,255,255,.45)",$.$d=2.2,$.$f=6,$.stroke(),$.beginPath(),$.arc(j,H,3.2,0,O),$.$b="#fff",$.$a=0.9,$.fill(),$.restore()}}function nJ(J,Z,Q,V){let q=N.time+V,K=v(Q,0,1),j=72*(0.84+R(q*5)*0.2);$.save(),$.translate(J,Z),$.beginPath(),$.arc(0,0,j+18,0,O),$.$c="rgba(120,70,220,"+0.3*K+")",$.$d=10,$.$j="#8a5dff",$.$f=20,$.stroke(),$.save(),$.rotate(q*1.2);let H=10;$.beginPath();for(let M=0;M<H;M++){let _=O/H*M,X=(M%2===0?j+8:j-2)+R(q*7+M)*2,Y=I(_)*X,D=R(_)*X;if(M===0)$.moveTo(Y,D);else $.lineTo(Y,D)}$.closePath(),$.$c="rgba(198,150,255,"+0.62*K+")",$.$d=3.6,$.$f=12,$.stroke(),$.restore();for(let M=0;M<3;M++){let _=j*(0.72-M*0.18);$.beginPath(),$.arc(0,0,_+R(q*6+M*1.8)*2.5,0,O),$.$c=M===0?"rgba(230,215,255,"+0.7*K+")":"rgba(176,128,255,"+0.52*K+")",$.$d=2.4-M*0.35,$.$f=10-M*2,$.stroke()}let F=14;for(let M=0;M<F;M++){let _=q*1.4+O/F*M,X=j*0.38+R(q*8+M)*3,Y=j+10+R(q*5+M*1.7)*4,D=I(_)*X,U=R(_)*X,m=I(_)*Y,A=R(_)*Y;$.beginPath(),$.moveTo(D,U),$.lineTo(m,A),$.$c="rgba(215,182,255,"+0.42*K+")",$.$d=1.6,$.$f=8,$.stroke()}$.restore()}function c0(J){if(!J.$z)return;let Z=J.$z,Q=1-v(Z.t/W(0.0001,Z.maxT),0,1),V=Z.tx,q=Z.ty,K=B(q-J.y,V-J.x),z=J.x+I(K)*(J.r+12),j=J.y+R(K)*(J.r+12);$.save(),$.beginPath(),$.arc(J.x,J.y,J.r+9+R(N.time*18)*2,0,O),$.$c="rgba(255,235,140,"+(0.24+0.42*Q)+")",$.$d=2.3,$.$j="#ffea8a",$.$f=10,$.stroke(),$.translate(z,j),$.rotate(K);let H=7+Q*1.8;$.beginPath(),$.moveTo(H,0),$.lineTo(-H*0.55,-H*0.55),$.lineTo(-H*0.55,H*0.55),$.closePath(),$.$b="rgba(255,245,180,"+(0.35+0.4*Q)+")",$.$j="#fff0a0",$.$f=8,$.fill(),$.restore()}function a0(){G.each((J)=>{let Z=J.cc,Q=J.$k>0?"#fff":J.color;if(Z.$ah>0)Q="#ddd";let V=J.r+(J.$k>0?2:0);if(J.$i)x0(J);else{let q=J.$i?6:J.tier==="elite"?5:3;if(J.shape==="circle")_Z(J.x,J.y,V,Q,q);else if(J.shape==="square")LJ(lZ(J.x,J.y,V,J.angle),Q,!0,q);else LJ(xJ(J.x,J.y,V,J.angle),Q,!0,q)}if(J.$z&&(J.$m==="dasher"||J.$i))c0(J);if(J.tier==="elite"&&J.hp<J.$o&&!J.$i){let q=J.r*2;$.save(),$.$b="#333",$.$a=0.7,$.fillRect(J.x-q/2,J.y-J.r-8,q,3),$.$b=J.color,$.$a=0.9,$.fillRect(J.x-q/2,J.y-J.r-8,q*(J.hp/J.$o),3),$.restore()}if(Z.$_>0)$.save(),$.$a=0.6+Math.random()*0.4,$.beginPath(),$.arc(J.x+(Math.random()-0.5)*4,J.y+(Math.random()-0.5)*4,J.r+3,0,O),$.$c="#fff",$.$d=2,$.stroke(),$.restore();if(Z.$T>0){$.save(),$.$a=0.6,$.$c="#0aa",$.$d=2;let q=J.r*0.4;$.beginPath(),$.moveTo(J.x-q,J.y-q),$.lineTo(J.x+q,J.y+q),$.moveTo(J.x+q,J.y-q),$.lineTo(J.x-q,J.y+q),$.stroke(),$.restore()}if(Z.$an>0){$.save(),$.$c="#4f4",$.$d=2,$.$a=0.6;for(let q=0;q<3;q++)$.beginPath(),$.arc(J.x,J.y+J.r*0.3,J.r*0.6+q*4,0,O),$.stroke();$.restore()}if(Z.$I>0){$.save(),$.$c="#f4f",$.$d=1.5,$.$a=0.5,$.beginPath();let q=N.time*3;for(let K=0;K<3;K++){let z=q+O/3*K;$.moveTo(J.x+I(z)*J.r,J.y+R(z)*J.r),$.lineTo(J.x+I(z+0.5)*(J.r+8),J.y+R(z+0.5)*(J.r+8))}$.stroke(),$.restore()}if(Z.$O>0){$.save(),$.$b="#ccc",$.$a=0.8;let q=5;$.beginPath(),$.moveTo(J.x,J.y-J.r-10-q),$.lineTo(J.x+q,J.y-J.r-10),$.lineTo(J.x,J.y-J.r-10+q),$.lineTo(J.x-q,J.y-J.r-10),$.closePath(),$.fill(),$.restore()}if(Z.$ah>0)$.save(),P("!",J.x,J.y-J.r-14,12,"#ff0","center","middle"),$.restore();if(Z.$1>0){$.save(),$.$b="#f00",$.$a=0.5;for(let q=0;q<3;q++){let K=N.time*5+O/3*q;$.beginPath(),$.arc(J.x+I(K)*J.r*0.6,J.y+R(K)*J.r*0.6,2,0,O),$.fill()}$.restore()}})}function CZ(J,Z,Q){if(N.$aj&&!Q)return;J.each((V)=>{if(V.type==="curve"&&V.curve){let K=y(V.vx**2+V.vy**2),z=B(V.vy,V.vx)+V.curve*Z;V.vx=I(z)*K,V.vy=R(z)*K}if(V.type==="loop"&&V.$aC){let K=(N.time-V.$q)*(V.$aN||2.6),z=V.$aD,j=W(80,V.$L),H=R(K*O)*(V.$aC||120),F=I(z),M=R(z),_=-M,X=F;V.vx=F*j+_*H,V.vy=M*j+X*H}if(V.type==="pulse"&&V.$R){let K=1-V.life/V.$g,z=V.$L*(1+R(K*V.$aQ*O)*V.$R),j=B(V.vy,V.vx);V.vx=I(j)*z,V.vy=R(j)*z}if(!Q){if(V.$n==="$s"){let K=L.x-V.x,z=L.y-V.y,j=W(45,y(K*K+z*z)),H=V.$av||420;V.vx+=K/j*H*Z,V.vy+=z/j*H*Z}else if(V.$n==="speed_shift"){let K=V.$av||1.6,z=V.$a1||7,j=V.$a2||0,H=V.$L*(1+R((N.time+V.$q)*z+j)*K*0.45),F=B(V.vy,V.vx);V.vx=I(F)*W(80,H),V.vy=R(F)*W(80,H)}else if(V.$n==="wind_shift"){let K=V.$a3||0;if(K){let z=B(V.$3,V.$2)+Z*K,j=y(V.$2*V.$2+V.$3*V.$3);V.$2=I(z)*j,V.$3=R(z)*j}V.vx+=V.$2*Z,V.vy+=V.$3*Z}else if(V.$n==="homing"){let K=L.x-V.x,z=L.y-V.y,j=y(K*K+z*z),H=V.$aK||180;if(j>H){let F=B(z,K),M=B(V.vy,V.vx),_=v(yZ(F-M),-(V.$aw||3)*Z,(V.$aw||3)*Z),X=M+_,Y=W(90,y(V.vx*V.vx+V.vy*V.vy));V.vx=I(X)*Y,V.vy=R(X)*Y}}if(N.$s){let K=L.x-V.x,z=L.y-V.y,j=W(50,y(K*K+z*z));V.vx+=K/j*N.$s*Z,V.vy+=z/j*N.$s*Z}if(N.decay){let K=V.$L*W(0.2,1-(1-V.life/V.$g)*0.8),z=B(V.vy,V.vx);V.vx=I(z)*K,V.vy=R(z)*K}if(N.$H){let K=y(V.vx**2+V.vy**2)+N.$H*Z,z=B(V.vy,V.vx);V.vx=I(z)*K,V.vy=R(z)*K}if(N.echo&&!V.$ag){if(V.$aL+=Z,V.$aL>0.15)V.$ag=!0,zJ.spawn((K)=>{K.x=V.x,K.y=V.y,K.vx=V.vx*0.7,K.vy=V.vy*0.7,K.r=V.r*0.7,K.color=V.color,K.type="normal",K.life=V.life*0.5,K.$g=K.life,K.$q=N.time,K.$am=!1,K.$ag=!0,K.$aL=0,K.curve=0,K.$R=0,K.split=!1,K.damage=1,K.$L=y(K.vx**2+K.vy**2)})}V.vx+=N.$U*Z*0.5,V.vy+=N.$V*Z*0.5}V.x+=V.vx*Z,V.y+=V.vy*Z,V.life-=Z;let q=f0(V);if(q)if(N.$aE&&!V.$am&&!Q)u0(V,q),V.$am=!0;else V.active=!1,T(V.x,V.y,V.color,3,60);if(S(V.x,V.y,L.x,L.y)>ZJ.cullDist)V.active=!1;if(V.life<=0){if(V.active=!1,V.split&&!Q)for(let K=0;K<3;K++){let z=Math.random()*O;IJ(V.x,V.y,I(z)*100,R(z)*100,2.5,V.color,"normal",1.5)}if(N.decay&&!Q)T(V.x,V.y,V.color,4,60)}})}function SZ(J){J.each((Z)=>{let Q=v(Z.life/Z.$g,0,1);if($.save(),$.$a=Q,Z.src==="rocket"||Z.src==="rocket_mini"){let V=Z.src==="rocket_mini"?0.6:1,q=B(Z.vy,Z.vx),K=q+f/2,z={x:Z.x+I(q)*10*V,y:Z.y+R(q)*10*V},j={x:Z.x-I(q)*6*V+I(K)*4*V,y:Z.y-R(q)*6*V+R(K)*4*V},H={x:Z.x-I(q)*6*V-I(K)*4*V,y:Z.y-R(q)*6*V-R(K)*4*V};$.beginPath(),$.moveTo(z.x,z.y),$.lineTo(j.x,j.y),$.lineTo(H.x,H.y),$.closePath(),$.$b=Z.src==="rocket_mini"?"#fa0":"#f80",$.fill(),$.$c="#fa0",$.$d=1,$.stroke();let F=Z.x-I(q)*8*V,M=Z.y-R(q)*8*V;$.beginPath(),$.arc(F,M,(3+Math.random()*2)*V,0,O),$.$b="#ff4",$.$a=Q*0.7,$.fill(),$.beginPath(),$.arc(F-I(q)*3*V,M-R(q)*3*V,(2+Math.random()*2)*V,0,O),$.$b="#f80",$.$a=Q*0.4,$.fill()}else q0(Z.x,Z.y,Z.r,Z.color);if(Z.$n&&Z.$n!=="normal")$.beginPath(),$.arc(Z.x,Z.y,Z.r+2.2,0,O),$.$c=Z.$n==="$s"?"#f8f":Z.$n==="speed_shift"?"#ff8":"#8ff",$.$d=1.2,$.$a=0.45*Q,$.stroke();$.restore()})}var OJ=(J,Z)=>{for(let Q in Z)J[Q]=Z[Q]},s0={dagger:(J)=>OJ(J,{state:"idle",dx:0,dy:0,tx:0,ty:0,speed:800,dmg:4,idleTimer:0,$bb:0,$ba:25}),sword:(J)=>OJ(J,{$aT:0,$x:0,$t:0,$a7:120,$aO:0,$aP:0,$ak:0}),bow:(J)=>OJ(J,{charging:!1,$ae:0,$a8:1.5,shotCD:0}),chain:(J)=>OJ(J,{timer:0.1,range:200,chains:4,$bv:0.3,dmg:5,$aq:0,$bj:null}),rocket:(J)=>OJ(J,{timer:0.1,$bx:90,$bC:250,lastFired:0}),drone:(J)=>OJ(J,{timer:0.1,$A:[],$bB:1,$a5:150,silenceDur:1.5}),shuriken:(J)=>OJ(J,{timer:0.1,count:1,$bp:3,$u:0.3,bounces:2,$v:[]})};function dZ(J){let Z={id:J,lv:{a:0,b:0,c:0,d:0}},Q=s0[J];if(Q)Q(Z);return Z}var t0=[["dagger","MAGIC DAGGER","#0ff","starter","Click to throw. Click again to redirect.","",[["a","PIERCING THROW",3,["+50% speed","90% + homing","120% + homing"]],["b","SPECTRAL COPY",3,["1 ghost 50% dmg","2 ghosts 60%","3 ghosts 75%"]],["d","DAGGER STORM",2,["0.8s spin 35px","1.2s 50px"]]]],["sword","PLASMA SWORD","#f0f","starter","Click to lunge-slash forward, cleaving enemies and bullets. i-frames during dash.","",[["a","LUNGE REACH",3,["160px lunge","200px","250px"]],["b","WIDE CLEAVE",3,["50px wide","60px","75px"]],["c","AFTERSHOCK",2,["Trail 2dmg 1.8s","3dmg 2.5s"]]]],["bow","VOLT BOW","#ff0","starter","Hold to charge, release a piercing beam.","",[["a","PRISM SPLIT",2,["1 side pair","2 side pairs"]],["b","QUICK DRAW",3,["1.0s charge","0.8s","0.6s"]],["c","PLASMA BURN",2,["Applies burn","Stronger burn"]]]],["chain","CHAIN LIGHTNING","#a0f","cc","Arcs lightning to destroy enemy bullets.","BULLET CLEAR",[["a","EXTRA CHAINS",2,["+3 chains (7)","+3 (10)"]],["b","MULTI STRIKE",2,["2 bolts at once","3 bolts"]],["c","STATIC FIELD",2,["3s lingering stun zone","5s zone + wider"]]]],["rocket","ROCKET LAUNCHER","#f80","cc","Homing rockets knock enemies back, clear bullets.","KNOCKBACK",[["a","CONCUSSIVE BLAST",3,["+60 knockback","+120 kb","+200 kb"]],["b","CLUSTER BOMB",2,["5 homing mini-rockets","7"]],["c","BLAST RADIUS",2,["130px","160px"]]]],["drone","PULSE DRONE","#0aa","cc","Drone silences enemies, slows bullets.","SILENCE",[["a","EXTRA DRONE",2,["+1 drone","+1 (3 total)"]],["b","EXT SILENCE",2,["2.5s","3.5s"]],["c","DISRUPTION",2,["20% slow","40%"]],["d","OVERDRIVE",2,["0.9s cd","0.7s"]]]],["shuriken","SHURIKEN","#bbb","cc","Bouncing shurikens mark enemies for bonus damage.","MARK",[["a","EXTRA SHURIKEN",2,["+1","+1 (3 total)"]],["b","DEEP MARK",2,["45% bonus dmg","60%"]],["c","EXT MARK",2,["5s","7s"]],["d","EXTRA BOUNCES",3,["+2 bounces (4)","+2 (6)","+2 (8)"]]]]],EJ={};for(let J of t0){let Z=[];for(let V=0;V<J[6].length;V++){let q=J[6][V];Z.push({id:q[0],name:q[1],maxLv:q[2],desc:q[3]})}let Q={name:J[1],color:J[2],type:J[3],desc:J[4],$bI:Z};if(J[5])Q.cc=J[5];EJ[J[0]]=Q}var yJ=["dagger","sword","bow"];var e0=["chain","rocket","drone","shuriken"];function J1(J){for(let Z of N.weapons)if(Z.id==="dagger")$1(Z,J);else if(Z.id==="sword")z1(Z,J);else if(Z.id==="bow")N1(Z,J);else if(Z.id==="chain")R1(Z,J);else if(Z.id==="rocket")O1(Z,J);else if(Z.id==="drone")U1(Z,J);else if(Z.id==="shuriken")B1(Z,J)}function Z1(){for(let J of N.weapons)if(J.id==="dagger")V1(J);else if(J.id==="sword")j1(J);else if(J.id==="bow")H1(J);else if(J.id==="chain")X1(J);else if(J.id==="rocket")W1(J);else if(J.id==="drone")v1(J);else if(J.id==="shuriken")E1(J)}function rZ(J){let Z=null,Q=null;for(let V=0;V<N.weapons.length;V++){let q=N.weapons[V];if(EJ[q.id].type!=="starter")continue;if(!Z){Z=q;continue}Q=q;break}if(J===0)return Z;if(J===2)return Q;return null}function $1(J,Z){if(J.state==="flying"){let Q=[1,1.5,1.9,2.2][J.lv.a],V=B(J.ty-J.dy,J.tx-J.dx),q=J.speed*Q*Z;if(S(J.dx,J.dy,J.tx,J.ty)<q+5)if(J.dx=J.tx,J.dy=J.ty,J.lv.d>0)J.state="spinning",J.$bb=[0,0.8,1.2][J.lv.d],J.$ba=[0,35,50][J.lv.d];else J.state="waiting",J.idleTimer=0;else J.dx+=I(V)*q,J.dy+=R(V)*q;PZ(J,J.dmg)}else if(J.state==="spinning"){if(J.$bb-=Z,J.angle=(J.angle||0)+Z*15,Q1(J,Z),J.$bb<=0)J.state="waiting",J.idleTimer=0}else if(J.state==="waiting"){if(J.idleTimer+=Z,J.idleTimer>2)J.state="returning"}else if(J.state==="returning"){let Q=B(L.y-J.dy,L.x-J.dx),V=J.speed*1.2*Z;if(J.dx+=I(Q)*V,J.dy+=R(Q)*V,PZ(J,J.dmg),S(J.dx,J.dy,L.x,L.y)<20)J.state="idle"}else J.dx=L.x,J.dy=L.y;if(J.lv.b>0){let Q=[0,1,2,3][J.lv.b];if(!J.$J)J.$J=[];if(!J.$X)J.$X=[];if(J.$X.push({x:J.dx,y:J.dy}),J.$X.length>30)J.$X.shift();J.$J=[];for(let V=0;V<Q;V++){let q=W(0,J.$X.length-1-(V+1)*6);J.$J.push({x:J.$X[q].x,y:J.$X[q].y})}}}function PZ(J,Z){if(G.each((Q)=>{if(!Q.active)return;if(S(J.dx,J.dy,Q.x,Q.y)<Q.r+8)KJ(Q,Z,"dagger")}),J.lv.b>0&&J.$J){let Q=Z*[0,0.5,0.6,0.75][J.lv.b];for(let V of J.$J)G.each((q)=>{if(!q.active)return;if(S(V.x,V.y,q.x,q.y)<q.r+8)KJ(q,Q,"dagger_ghost")})}}function Q1(J,Z){G.each((Q)=>{if(!Q.active)return;if(S(J.dx,J.dy,Q.x,Q.y)<J.$ba+Q.r)KJ(Q,[0,3,4][J.lv.d]*Z*10,"dagger")})}function V1(J){let Z=J.dx||L.x,Q=J.dy||L.y;if(J.state==="idle"){let V=L.angle,q=L.x+I(V)*18,K=L.y+R(V)*18;LJ([{x:q+I(V)*8,y:K+R(V)*8},{x:q+I(V+2.3)*5,y:K+R(V+2.3)*5},{x:q+I(V-2.3)*5,y:K+R(V-2.3)*5}],"#0ff",!0,3)}else{let V=J.state==="spinning"?J.angle||0:B(J.dy-(J.state==="returning"?L.y:J.ty),J.dx-(J.state==="returning"?L.x:J.tx))+f;if(LJ([{x:Z+I(V)*10,y:Q+R(V)*10},{x:Z+I(V+2.3)*6,y:Q+R(V+2.3)*6},{x:Z+I(V-2.3)*6,y:Q+R(V-2.3)*6}],"#0ff",!0,4),J.state==="spinning")z0(Z,Q,J.$ba,0,O,"#0ff",1);if(J.lv.b>0&&J.$J&&J.state!=="idle")for(let q=0;q<J.$J.length;q++){let K=J.$J[q],z=J.state==="spinning"?J.angle||0:B(J.dy-K.y,J.dx-K.x);$.save(),$.$a=0.35-q*0.08,LJ([{x:K.x+I(z)*10,y:K.y+R(z)*10},{x:K.x+I(z+2.3)*6,y:K.y+R(z+2.3)*6},{x:K.x+I(z-2.3)*6,y:K.y+R(z-2.3)*6}],"#0ff",!0,3),$.restore()}}}function q1(J,Z,Q){if(J.state==="idle"||J.state==="waiting"||J.state==="spinning"){if(J.state="flying",J.tx=Z,J.ty=Q,J.state==="idle")J.dx=L.x,J.dy=L.y}else if(J.state==="flying")J.tx=Z,J.ty=Q;else if(J.state==="returning")J.state="flying",J.tx=Z,J.ty=Q}function z1(J,Z){if(J.$aT=W(0,J.$aT-Z),J.$x>0){J.$x-=Z;let Q=0.18;J.$ak=v(1-J.$x/Q,0,1);let V=J.$a7,q=[35,50,60,75][J.lv.b],K=J.$aO+I(J.$t)*V*J.$ak,z=J.$aP+R(J.$t)*V*J.$ak;L.x=K,L.y=z,L.invuln=W(L.invuln,0.25),L.$y=W(L.$y,0.25);let j=8,H=70;if(G.each((F)=>{if(!F.active)return;let M=F.x-K,_=F.y-z,X=I(J.$t),Y=R(J.$t),D=M*X+_*Y;if(D<-15-F.r||D>H+F.r)return;if(PJ(M*-Y+_*X)<q+F.r){if(!F.$bi||N.time-F.$bi>0.15)F.$bi=N.time,KJ(F,j,"sword",!1),FJ(2)}}),zJ.each((F)=>{if(!F.active)return;let M=F.x-K,_=F.y-z,X=I(J.$t),Y=R(J.$t),D=M*X+_*Y;if(D<-15-F.r||D>H+F.r)return;if(PJ(M*-Y+_*X)<q+F.r)F.active=!1,T(F.x,F.y,"#f0f",3,80)}),J.lv.c>0)J.$ab={x:K,y:z,w:q};if(J.$x<=0){J.$x=0,J.$ak=0;let F=v(J.lv.c|0,0,2);if(F>0&&J.$ab){let M=[0,2,3][F],_=[0,1.8,2.5][F],X=J.$aO,Y=J.$aP,D=J.$ab.x,U=J.$ab.y;I0(X,Y,D,U,J.$ab.w*1.1,M,_)}J.$ab=null,T(L.x,L.y,"#f0f",8,120),FJ(4)}}}function K1(J,Z,Q){let V=0.4*(1-E.$E);if(J.$aT>0||J.$x>0)return;if(J.$aT=V,J.$t=L.angle,J.$a7=[120,160,200,250][J.lv.a],J.$aO=L.x,J.$aP=L.y,J.$x=0.18,J.$ak=0,J.$ab=null,X0())O0(J.$t,J);T(L.x+I(J.$t)*15,L.y+R(J.$t)*15,"#f0f",6,100)}function j1(J){let V=J.$x>0?J.$t:L.angle,q=V+f/2;if(J.$x>0){let{$ak:K,$a7:z}=J,j=[35,50,60,75][J.lv.b];$.save();let{$aO:H,$aP:F}=J,M=H+I(V)*z*K,_=F+R(V)*z*K,X=j*0.65,Y=j*1.05,D=W(8,j*0.2),U=$.createLinearGradient(H,F,M,_);U.addColorStop(0,"rgba(255,120,255,0)"),U.addColorStop(0.35,"rgba(255,120,255,.08)"),U.addColorStop(1,"rgba(255,180,255,.18)"),$.beginPath(),$.moveTo(H+I(q)*X,F+R(q)*X),$.quadraticCurveTo((H+M)*0.5+I(q)*D,(F+_)*0.5+R(q)*D,M+I(q)*Y,_+R(q)*Y),$.lineTo(M-I(q)*Y,_-R(q)*Y),$.quadraticCurveTo((H+M)*0.5-I(q)*D,(F+_)*0.5-R(q)*D,H-I(q)*X,F-R(q)*X),$.closePath(),$.$b=U,$.$a=1,$.fill(),$.$c="rgba(255,120,255,.24)",$.$d=1.2,$.stroke(),$.restore(),$.save();for(let u=0;u<5;u++){let d=u/5,r=l(H,M,d),p=l(F,_,d),jJ=(u%2===0?1:-1)*j*0.5;$.beginPath(),$.moveTo(r+I(q)*jJ,p+R(q)*jJ),$.lineTo(r+I(q)*jJ-I(V)*15,p+R(q)*jJ-R(V)*15),$.$c="#f0f",$.$d=1.5,$.$a=0.25*(1-d),$.stroke()}$.restore();let m=V+(-f/2+f*K),A=m+f/2,t=L.x+I(m)*10,s=L.y+R(m)*10,VJ=L.x+I(m)*70,e=L.y+R(m)*70,g=[{x:t+I(A)*4,y:s+R(A)*4},{x:t-I(A)*4,y:s-R(A)*4},{x:VJ-I(A)*1.5,y:e-R(A)*1.5},{x:VJ+I(m)*6,y:e+R(m)*6},{x:VJ+I(A)*1.5,y:e+R(A)*1.5}];LJ(g,"#f0f",!0,5),$.save(),$.$aM="round";let C=7;for(let u=1;u<=C;u++){let d=W(0,K-u*0.05),r=V+(-f/2+f*d),p=1-u/C,jJ=R(N.time*20+u*0.9)*2.2*p,fJ=I(r+f/2),$Z=R(r+f/2),QZ=L.x+I(r)*10+fJ*jJ,VZ=L.y+R(r)*10+$Z*jJ,qZ=L.x+I(r)*70+fJ*jJ*1.4,zZ=L.y+R(r)*70+$Z*jJ*1.4,J0=(QZ+qZ)*0.5+fJ*(6+2*p),Z0=(VZ+zZ)*0.5+$Z*(6+2*p),oJ=$.createLinearGradient(QZ,VZ,qZ,zZ);oJ.addColorStop(0,"rgba(255,120,255,0)"),oJ.addColorStop(0.35,"rgba(255,120,255,"+(0.08+0.15*p)+")"),oJ.addColorStop(1,"rgba(255,255,255,"+(0.05+0.15*p)+")"),$.$c=oJ,$.$d=2.2+3.4*p,$.beginPath(),$.moveTo(QZ,VZ),$.quadraticCurveTo(J0,Z0,qZ,zZ),$.stroke()}$.restore()}else{let K=L.x+I(V)*14,z=L.y+R(V)*14,j=L.x+I(V)*56,H=L.y+R(V)*56,F=[{x:K+I(q)*2.5,y:z+R(q)*2.5},{x:K-I(q)*2.5,y:z-R(q)*2.5},{x:j-I(q)*1,y:H-R(q)*1},{x:j+I(V)*4,y:H+R(V)*4},{x:j+I(q)*1,y:H+R(q)*1}];LJ(F,"#f0f",!0,2)}}function N1(J,Z){J.shotCD=W(0,J.shotCD-Z);let Q=[1.5,1,0.8,0.6][J.lv.b];if(J.$a8=Q,J.charging)J.$ae=a(J.$ae+Z,Q)}function F1(J){if(J.shotCD<=0)J.charging=!0}function L1(J){if(!J.charging)return;if(J.charging=!1,J.shotCD>0){J.$ae=0;return}let{$ae:Z,$a8:Q}=J,V=v(Z/Q,0,1),q=L.angle,K=1,z=10+V*18;for(let j=0;j<K;j++){let H=(j-(K-1)/2)*z;KZ(J,V,q,H,1,1,1,"#ff0");let F=v(J.lv.a|0,0,2);for(let M=1;M<=F;M++){let _=0.07*M;KZ(J,V,q+_,H,0.5,0.7,0.85,"#ffd84a"),KZ(J,V,q-_,H,0.5,0.7,0.85,"#ffd84a")}}J.$ae=0,J.shotCD=0.22,FJ(2+V*4),rJ(0.04,0.7+V*0.3),T(L.x+I(q)*22,L.y+R(q)*22,"#fff",8,140)}function H1(J){if(J.charging){let Z=v(J.$ae/J.$a8,0,1),Q=18+Z*10,V=L.angle,q=L.x+I(V)*(Q+2),K=L.y+R(V)*(Q+2),z=V+f/2;$.save();let j=q+I(V)*(5+Z*3),H=K+R(V)*(5+Z*3),F=q+I(z)*(2+Z*1.5),M=K+R(z)*(2+Z*1.5),_=q-I(z)*(2+Z*1.5),X=K-R(z)*(2+Z*1.5);$.beginPath(),$.moveTo(j,H),$.lineTo(F,M),$.lineTo(_,X),$.closePath(),$.$b="#ff0",$.$a=0.35+0.4*Z,$.$j="#ff0",$.$f=8+10*Z,$.fill(),$.beginPath(),$.arc(L.x,L.y,Q,0,O),$.$c="#ffd84a",$.$d=1.2+Z*1.2,$.$a=0.3+Z*0.5,$.stroke(),$.beginPath(),$.arc(L.x,L.y,Q*0.55,0,O),$.$c="#fff",$.$d=0.9+Z*0.9,$.$a=0.25+Z*0.45,$.stroke(),$.restore()}}function YJ(J,Z,Q,V){let q=null,K=Q===void 0?1/0:Q;return G.each((z)=>{if(!z.active)return;if(V&&(V.has?V.has(z):V(z)))return;let j=S(J,Z,z.x,z.y);if(j<K)K=j,q=z}),q}function AZ(J,Z,Q,V,q){let K=null,z=Q===void 0?1/0:Q;return zJ.each((j)=>{if(!j.active)return;if(V&&(V.has?V.has(j):V(j)))return;if(q&&(q.has?q.has(j):q(j)))return;let H=S(J,Z,j.x,j.y);if(H<z)z=H,K=j}),K}function xZ(J,Z,Q,V,q,K,z,j){let H=B(V-K,Q-q),F=B(Z,J),M=v(yZ(H-F),-z*j,z*j),_=F+M,X=y(J*J+Z*Z);return{vx:I(_)*X,vy:R(_)*X}}function R1(J,Z){if(M1(Z),J.timer-=Z*(1-E.$E),J.timer<=0){let Q=J.range,V=J.chains+[0,3,3][J.lv.a],q=[1,2,3][J.lv.b]||1,K=J.lv.c;if(!AZ(L.x,L.y,Q))return;J.timer=0.8,J.$a0=[],J.$bj=[];let z=new Set;for(let j=0;j<q;j++){let H=new Set,F=[],M=L.x,_=L.y;if(j>0){let D=O/q*j;M=L.x+I(D)*15,_=L.y+R(D)*15}for(let D=0;D<V;D++){let U=AZ(M,_,Q+(D>0?100:0),H,z);if(!U)break;if(H.add(U),z.add(U),F.push({x:U.x,y:U.y}),T(U.x,U.y,"#a0f",3,80),U.active=!1,K>0){let m=[0,3,5][K],A=[0,25,40][K];I1(U.x,U.y,m,A)}M=U.x,_=U.y}let X=j>0?L.x+I(O/q*j)*15:L.x,Y=j>0?L.y+R(O/q*j)*15:L.y;for(let D of F){let U=Y1(X,Y,D.x,D.y,8);J.$a0.push(U),J.$bj.push(D),X=D.x,Y=D.y}}J.$aq=0.45}if(J.$aq>0)J.$aq-=Z}if(!window.$Z)window.$Z=[];var hZ=200;function I1(J,Z,Q,V){if(window.$Z.length>=hZ)return;let q=3+Math.floor(Math.random()*3);for(let K=0;K<q;K++){if(window.$Z.length>=hZ)break;let z=Math.random()*O,j=Math.random()*V;window.$Z.push({x:J+I(z)*j,y:Z+R(z)*j,life:Q,$g:Q,r:V,$bv:0.15,vx:(Math.random()-0.5)*20,vy:(Math.random()-0.5)*20,size:2+Math.random()*3})}}function M1(J){let Z=window.$Z;for(let Q=Z.length-1;Q>=0;Q--){let V=Z[Q];if(V.life-=J,V.x+=V.vx*J,V.y+=V.vy*J,V.vx*=0.95,V.vy*=0.95,V.vx+=(Math.random()-0.5)*40*J,V.vy+=(Math.random()-0.5)*40*J,V.life<=0){Z.splice(Q,1);continue}if(V.$W=(V.$W||0)-J,V.$W>0)continue;V.$W=0.2,G.each((q)=>{if(!q.active)return;if(S(V.x,V.y,q.x,q.y)<q.r+8){if(N.time-(q._lastStaticStun||0)<3)return;let K=q.$i?0.2:1;q.cc.$_=W(q.cc.$_,V.$bv*K),q._lastStaticStun=N.time}})}}function _1(){for(let J of window.$Z){let Z=v(J.life/J.$g,0,1);$.save(),$.$a=Z*0.8,$.beginPath(),$.arc(J.x,J.y,J.size*Z,0,O),$.$b="#c6f",$.fill(),$.beginPath(),$.arc(J.x,J.y,J.size*Z*2,0,O),$.$b="#a0f",$.$a=Z*0.15,$.fill(),$.restore()}}function Y1(J,Z,Q,V,q){let K=[{x:J,y:Z}],z=Q-J,j=V-Z,H=y(z*z+j*j),F=-j/H,M=z/H;for(let _=1;_<q;_++){let X=_/q,Y=J+z*X,D=Z+j*X,U=(Math.random()-0.5)*H*0.18;K.push({x:Y+F*U,y:D+M*U})}return K.push({x:Q,y:V}),K}function X1(J){if(J.$aq>0&&J.$a0){let Z=v(J.$aq/0.45,0,1),Q=(V,q,K,z,j)=>{$.beginPath(),$.moveTo(V[0].x,V[0].y);for(let H=1;H<V.length;H++)$.lineTo(V[H].x,V[H].y);$.$c=q,$.$d=K,$.$a=z,$.$j=q,$.$f=j,$.stroke()};$.save();for(let V of J.$a0){Q(V,"#a0f",6,Z*0.25,15),Q(V,"#c6f",3,Z*0.6,8),Q(V,"#eaf",1.5,Z,4);let q=V[V.length-1];$.beginPath(),$.arc(q.x,q.y,4*Z,0,O),$.$b="#fff",$.$a=Z*0.8,$.$f=10,$.fill()}$.restore()}}function O1(J,Z){if(J.timer-=Z*(1-E.$E),J.timer<=0){J.timer=2.2;let Q=YJ(L.x,L.y,9999),V=Q?B(Q.y-L.y,Q.x-L.x):L.angle,q=350;kJ.spawn((K)=>{K.x=L.x+I(V)*16,K.y=L.y+R(V)*16,K.vx=I(V)*q,K.vy=R(V)*q,K.r=6,K.life=5,K.$g=5,K.type="normal",K.color="#f80",K.$q=N.time,K.damage=0,K.$5=0,K.$am=!1,K.split=!1,K.$ag=!1,K.$L=q,K.curve=0,K.$R=0,K.src="rocket",K._homing=!0,K.$aX=0}),J.lastFired=N.time}kJ.each((Q)=>{if(!Q.active||Q.src!=="rocket"&&Q.src!=="rocket_mini"||!Q._homing)return;if(Q.$aX>0){Q.$aX-=Z;return}let V=YJ(Q.x,Q.y,800);if(V){let q=Q.src==="rocket_mini"?4:3.5,K=xZ(Q.vx,Q.vy,V.x,V.y,Q.x,Q.y,q,Z);Q.vx=K.vx,Q.vy=K.vy}})}function W1(J){}function D1(J,Z){let Q=N.weapons.find((z)=>z.id==="rocket");if(!Q)return;let V=Q.$bx+[0,30,50][Q.lv.c],q=Q.$bC+[0,40,80,120][Q.lv.a],K=[0.5,0.8,1.2,1.5][Q.lv.a]||0.5;if(T(J,Z,"#f80",25,250),T(J,Z,"#ff4",15,180),FJ(8),!N.$Y)N.$Y=[];if(N.$Y.push({x:J,y:Z,r:V,life:0.3,$g:0.3}),zJ.each((z)=>{if(!z.active)return;if(S(J,Z,z.x,z.y)<V)z.active=!1,T(z.x,z.y,"#f80",2,60)}),G.each((z)=>{if(!z.active)return;if(S(J,Z,z.x,z.y)<V+z.r){KJ(z,1,"rocket");let H=z.$i?0.4:1,F=B(z.y-Z,z.x-J);z.cc.$F=I(F)*q*H,z.cc.$G=R(F)*q*H,z.cc.$ax=K*H}}),Q.lv.b>0){let z=[0,5,7][Q.lv.b];for(let j=0;j<z;j++){let H=O/z*j;kJ.spawn((F)=>{F.x=J+I(H)*10,F.y=Z+R(H)*10,F.vx=I(H)*220,F.vy=R(H)*220,F.r=3,F.life=2,F.$g=2,F.type="normal",F.color="#fa0",F.$q=N.time,F.damage=1,F.$5=0,F.$am=!1,F.split=!1,F.$ag=!1,F.$L=220,F.curve=0,F.$R=0,F.src="rocket_mini",F._homing=!0,F.$aX=0.35})}}}function U1(J,Z){let Q=J.$bB+[0,1,2][J.lv.a],V=J.$a5,q=[1.5,2.5,3.5][J.lv.b],K=[0,0.2,0.4][J.lv.c]||0,z=[1.5,0.9,0.7][J.lv.d]||1.5;while(J.$A.length<Q)J.$A.push({angle:O/Q*J.$A.length,$bs:60+J.$A.length*15,$S:0,x:L.x,y:L.y});let j=250;for(let H=0;H<J.$A.length;H++){let F=J.$A[H];if(!F.x)F.x=L.x;if(!F.y)F.y=L.y;F.$S=W(0,F.$S-Z);let M=YJ(F.x,F.y,400),_=80;if(M){let Y=B(M.y-F.y,M.x-F.x);F.x+=I(Y)*_*Z,F.y+=R(Y)*_*Z}else{F.angle+=Z*(2.5-H*0.3);let Y=L.x+I(F.angle)*F.$bs,D=L.y+R(F.angle)*F.$bs;F.x=l(F.x,Y,4*Z),F.y=l(F.y,D,4*Z)}let X=S(F.x,F.y,L.x,L.y);if(X>j){let Y=B(L.y-F.y,L.x-F.x);F.x+=I(Y)*(X-j)*3*Z,F.y+=R(Y)*(X-j)*3*Z}if(zJ.each((Y)=>{if(!Y.active)return;if(S(F.x,F.y,Y.x,Y.y)<V){let U=y(Y.vx*Y.vx+Y.vy*Y.vy);if(U>50){let m=B(Y.vy,Y.vx),A=U*(1-0.4*Z*3);Y.vx=I(m)*A,Y.vy=R(m)*A}}}),F._fireT=(F._fireT||0)-Z*(1-E.$E),F._fireT<=0){F._fireT=z;let Y=YJ(F.x,F.y,V+80);if(Y&&S(F.x,F.y,Y.x,Y.y)<V+Y.r){let D=Y.$i?0.3:1;if(!Y.$i)Y.cc.$T=W(Y.cc.$T,q*D);if(K>0)Y.cc.$8=W(Y.cc.$8,K),Y.cc.$I=W(Y.cc.$I,q*D);KJ(Y,1,"drone"),F.$S=0.3,T(F.x,F.y,"#0aa",5,80)}}}J.timer=J.$A[0]?J.$A[0]._fireT:0}function v1(J){for(let Z of J.$A){$.save();let Q=Z.$S>0?1+Z.$S*2:1;if($.beginPath(),$.arc(Z.x,Z.y,6*Q,0,O),$.$b="#0aa",$.$a=0.6,$.fill(),$.$c="#0ff",$.$d=1.5,$.$a=0.8,$.stroke(),$.beginPath(),$.arc(Z.x,Z.y,3*Q,0,O),$.$b="#fff",$.$a=0.5,$.fill(),$.beginPath(),$.arc(Z.x,Z.y,J.$a5,0,O),$.$c="#0aa",$.$d=0.5,$.$a=0.1,$.stroke(),Z.$S>0){let V=J.$a5*(1-Z.$S/0.3);$.beginPath(),$.arc(Z.x,Z.y,V,0,O),$.$c="#0ff",$.$d=2,$.$a=Z.$S/0.3*0.4,$.stroke()}$.restore()}}function B1(J,Z){let Q=J.count+[0,1,2][J.lv.a],V=[0.3,0.45,0.6][J.lv.b],q=[3,5,7][J.lv.c],K=J.bounces+[0,2,2,2][J.lv.d];if(J.timer-=Z*(1-E.$E),J.timer<=0){J.timer=1.2;let z=new Set;for(let j=0;j<J.$v.length;j++)if(J.$v[j].target)z.add(J.$v[j].target);for(let j=0;j<Q;j++){let H=YJ(L.x,L.y,1/0,z);if(!H)H=YJ(L.x,L.y,1/0);if(!H)break;let F=B(H.y-L.y,H.x-L.x);J.$v.push({x:L.x,y:L.y,vx:I(F)*1400,vy:R(F)*1400,target:H,life:4,$u:V,$bp:q,angle:0,bouncesLeft:K,hitSet:new Set}),z.add(H)}}for(let z=J.$v.length-1;z>=0;z--){let j=J.$v[z];if(j.life-=Z,j.angle+=Z*12,j.life<=0){J.$v.splice(z,1);continue}if(j.target&&j.target.active){let H=xZ(j.vx,j.vy,j.target.x,j.target.y,j.x,j.y,12,Z);j.vx=H.vx,j.vy=H.vy}else{let H=YJ(j.x,j.y,1/0,j.hitSet);if(H)j.target=H}j.x+=j.vx*Z,j.y+=j.vy*Z,G.each((H)=>{if(!H.active||j.hitSet.has(H))return;if(S(j.x,j.y,H.x,H.y)<H.r+6){j.hitSet.add(H);let F=H.$i?0.4:1;if(H.cc.$O=W(H.cc.$O,j.$bp*F),H.cc.$u=W(H.cc.$u,j.$u),KJ(H,1,"shuriken"),T(j.x,j.y,"#bbb",5,80),j.bouncesLeft>0){j.bouncesLeft--;let M=YJ(j.x,j.y,1/0,j.hitSet);if(M){j.target=M;let _=B(M.y-j.y,M.x-j.x),X=y(j.vx*j.vx+j.vy*j.vy);j.vx=I(_)*X,j.vy=R(_)*X,j.life=W(j.life,2)}else J.$v.splice(z,1)}else J.$v.splice(z,1)}})}}function E1(J){for(let Z of J.$v){$.save(),$.translate(Z.x,Z.y),$.rotate(Z.angle),$.beginPath();for(let Q=0;Q<4;Q++){let V=O/4*Q;$.moveTo(0,0),$.lineTo(I(V)*8,R(V)*8),$.lineTo(I(V+0.4)*4,R(V+0.4)*4)}$.$c="#bbb",$.$d=2,$.$a=0.8,$.stroke(),$.beginPath(),$.arc(0,0,2,0,O),$.$b="#fff",$.fill(),$.restore()}}var RZ=[["regen","REGENERATION","#4f4",3,["Heal 1HP/14s","1HP/8s","1HP/8s + emergency heal"]],["speed","SPEED BOOST","#4f4",3,["+15% speed","+30%","+40% + 8% dodge"]],["cooldown","COOLDOWN REDUCTION","#48f",3,["-12% all CDs","-20%","-25% + faster weapons"]],["shield","ENERGY SHIELD","#4af",2,["Shield recharges 12s","8s recharge"]],["damage","POWER SURGE","#f44",2,["+30% damage","+50% damage"]]],cZ={};for(let J=0;J<RZ.length;J++){let Z=RZ[J];cZ[Z[0]]={name:Z[1],color:Z[2],maxLv:Z[3],desc:Z[4]}}var k1=RZ.map((J)=>J[0]),T1=k1,C1=["#f66","#f8c","#c8f","#8cf","#a0f","#ff8"],S1=["circle","square","triangle"],XZ=1,WZ=2,TJ=4,wJ=8,ZZ=16,fZ=TJ|wJ,P1=[XZ,WZ,TJ,wJ,ZZ],A1=[XZ,wJ,ZZ,WZ],h1=0,f1=1,u1=2,G1=3,aZ=4,g1=5,m1=[h1,f1,u1,G1,aZ,g1],y1=["Void","Astral","Iron","Crimson","Aether","Obsidian","Radiant","Grim"],uZ=["Warden","Revenant","Harbinger","Sentinel","Seraph","Tyrant","Overseer","Monarch"],w1=["Prime","Ascendant","Omega","the Hollow","the Unbound","of Ruin","of Echoes","Mk-II"],o1=[function(J){cJ.bossRadial(J)},function(J){cJ.bossWall(J)},function(J){for(let Z=0;Z<5;Z++){let Q=J.angle+O/5*Z;BJ(J.x,J.y,I(Q)*205,R(Q)*205,4,J.color,"loop",3.4,{$aC:160,$aN:1.15,$aD:Q})}},function(J){let Z=B(L.y-J.y,L.x-J.x);for(let Q=-3;Q<=3;Q++)BJ(J.x,J.y,I(Z+Q*0.11)*220,R(Z+Q*0.11)*220,4,J.color,"normal",2.6)},function(J,Z){Z.$bm+=0.36;let Q=Z.$r?5:3;for(let V=0;V<Q;V++){let q=Z.$bm+O/Q*V;E0({owner:J,angle:q,length:W(w,b)*1.9,width:Z.$r?28:22,life:Z.$r?2.1:1.8,color:J.color,$a_:Z.$r?0.75:0.45,warn:Z.$r?1.15:1,$aU:"#ff9f66"})}},function(J,Z){if(Z.$at)return;let Q=B(L.y-J.y,L.x-J.x),V=v(S(J.x,J.y,L.x,L.y)+52+(Z.$r?20:0),180,360);Z.$at={phase:"tele",t:1,maxT:1,sx:J.x,sy:J.y,ex:J.x+I(Q)*V,ey:J.y+R(Q)*V,a:Q,burst:!1},T(J.x,J.y,J.color,8,130)}];function n1(){return{$_:0,$T:0,$an:0,$8:0,$I:0,$ah:0,$O:0,$u:0,$F:0,$G:0,$ax:0,$au:0,$1:0}}function l1(J,Z){let Q=J.slice();for(let V=Q.length-1;V>0;V--){let q=HJ(0,V);[Q[V],Q[q]]=[Q[q],Q[V]]}return Q.slice(0,Z)}function b1(J){for(let Z=J.length-1;Z>0;Z--){let Q=HJ(0,Z);[J[Z],J[Q]]=[J[Q],J[Z]]}return J}function i1(){if(!N.$as||N.$as.length<1)N.$as=b1(A1.slice());return N.$as.pop()}function p1(J){if(J&TJ)return"Twin "+qJ(uZ)+" "+qJ(["Apex","Prime","Ascendant"]);return qJ(y1)+" "+qJ(uZ)+" "+qJ(w1)}function d1(J,Z,Q){let V=QJ()+Q*f,q=W(k,h)+100;J.x=L.x+I(V)*q,J.y=L.y+R(V)*q,J.shape=Z.shape,J.color=Z.color,J.tier="boss",J.$i=!0,J.$bM="generated",J.$bA=Z.shape,J.$by=Z.accessory,J.$bz=Z.name,J.$bN=Z.mods,J.$bL=Z.attacks,J.r=Z.r,J.hp=Z.hp,J.$o=Z.hp,J.$M=Z.$M,J.$az=0.45+Q*0.2,J.$k=0,J.angle=0,J.$q=N.time,J.$e={speed:Z.$P},J.$4={count:10,offset:0},J.cc=n1(),J.$bu=0,J.$l=0,J._role=Z.mods&TJ&&Q===1?"melee":"ranged",J.$aY=Q,J.$aZ=null,J.$m="chaser",J.$ai="bossAimed"}function r1(J){return{timer:0,$bk:0,$bm:QJ(),$p:[],$r:!1,$bn:!1,$bo:0,$bO:0,$be:0,$bJ:3,$B:[],$K:null,$at:null,$bc:0,update(Z,Q){if(this.timer+=Q,Z.angle+=Q*(this.$r?1.8:1.1),this.$at){let z=this.$at;if(z.phase==="tele"){if(z.t-=Q,Z.$l=W(Z.$l,0.1),Z.$z={t:z.t,maxT:z.maxT,tx:z.ex,ty:z.ey},z.t<=0)z.phase="dash",z.t=0.32,z.maxT=0.32,z.sx=Z.x,z.sy=Z.y,Z.$z=null}else{z.t-=Q;let j=v(1-z.t/z.maxT,0,1),H=1-(1-j)*(1-j);if(Z.x=l(z.sx,z.ex,H),Z.y=l(z.sy,z.ey,H),Z.$l=W(Z.$l,0.3),(this.timer*45|0)%2===0)T(Z.x,Z.y,Z.color,2,70);if(z.t<=0){if(Z.x=z.ex,Z.y=z.ey,!z.burst){z.burst=!0,T(Z.x,Z.y,Z.color,10,160);for(let F=0;F<10;F++){let M=O/10*F+z.a*0.35;BJ(Z.x,Z.y,I(M)*230,R(M)*230,4,Z.color,"normal",0.9)}}this.$at=null}}return}let V=B(L.y-Z.y,L.x-Z.x),q=S(Z.x,Z.y,L.x,L.y),K=Z.$e.speed;if(Z._role==="melee"){let z=170+Z.$aY*20;if(q>z+25)Z.x+=I(V)*K*Q,Z.y+=R(V)*K*Q;else{let j=V+(Z.$aY===0?f/2:-f/2);Z.x+=I(j)*K*0.7*Q,Z.y+=R(j)*K*0.7*Q}}else Z.x+=I(V)*K*0.35*Q,Z.y+=R(V)*K*0.35*Q;if(J.mods&XZ&&Z.hp<Z.$o*0.6&&this.$p.length<1){for(let z=0;z<4;z++)this.$p.push({angle:O/4*z,hp:12,lastHit:N.time});N.$C=0.9,N.$ad="BOSS SHIELD NODES",N.$ac=Z.color,N.$ao=4,N.$aI="SHIELD NODES: break the glowing hex shields around the boss. Boss is invincible until all are destroyed."}for(let z of this.$p)z.angle+=Q*0.7;if(J.mods&WZ&&Z.hp<Z.$o*0.35&&!this.$r){if(this.$r=!0,Z.$M*=0.72,!Z._baseColor)Z._baseColor=Z.color;Z.color="#f33",N.$C=1.1,N.$ad="BOSS ENRAGED",N.$ac=Z.color}if(J.mods&TJ)this.$bo+=Q,this.$bn=this.$bo%3.6<2.2;if(J.mods&wJ){if(this.$K){if(this.$K.t-=Q,this.$K.t<=0){let z=this.$K;this.$K=null;let{x:j,y:H}=Z;Z.x=z.toX,Z.y=z.toY;for(let F=0;F<8;F++){let M=O/8*F;BJ(j,H,I(M)*150,R(M)*150,4,Z.color,"normal",2.8)}this.$B.push({x1:j,y1:H,x2:z.toX,y2:z.toY,life:0.25}),T(j,H,Z.color,10,120),T(z.toX,z.toY,Z.color,10,120)}}else if(this.$be+=Q,this.$be>this.$bJ){this.$be=0;let z=QJ(),j=x(120,240);this.$K={toX:L.x+I(z)*j,toY:L.y+R(z)*j,t:1,maxT:1}}}for(let z=this.$B.length-1;z>=0;z--)if(this.$B[z].life-=Q,this.$B[z].life<=0)this.$B.splice(z,1);if(J.mods&ZZ){if(this.$bc+=Q,this.$bc>(this.$r?6:8)){this.$bc=0;let z=this.$r?2:1;for(let j=0;j<z;j++){let H=QJ(),F=x(90,170);pZ("small",{x:Z.x+I(H)*F,y:Z.y+R(H)*F,$m:"converge",$e:{speed:145},hpMult:1.1,fireMult:1.2,color:Z.color})}}}},fire(Z){if(Z._role==="melee")return;let Q=J.attacks[this.$bk%J.attacks.length];this.$bk++;let V=o1[Q];if(V)V(Z,this);if(J.mods&wJ&&this.$B.length&&Q!==aZ)for(let q of this.$B)for(let K=0;K<5;K++){let z=O/5*K;BJ(q.x1,q.y1,I(z)*130,R(z)*130,3.5,Z.color,"curve",2.6,{curve:0.3})}}}}function x1(){let J=i1(),Z=a(4,1+JJ(W(0,N.wave-1)/4)),Q=1;while(Q<Z){let X=P1.filter((Y)=>!(J&Y));if(J&fZ)X=X.filter((Y)=>(Y&fZ)===0);if(!X.length)break;J|=qJ(X),Q++}let V=l1(m1,J&TJ?2:3),q=qJ(S1),K=qJ(C1),z=HJ(0,2),j=JJ((190+N.wave*85+N.wave*N.wave*22+HJ(-40,60))*0.5),H=HJ(34,48),F=x(0.9,1.45)*W(0.52,1-N.wave*0.02),M=x(70,105)+N.wave*1.3,_=p1(J);return{mods:J,attacks:V,shape:q,color:K,accessory:z,hp:j,r:H,$M:F,$P:M,name:_}}function c1(){let J=x1();if(!(J.mods&ZZ))G.each((V)=>{if(V.active&&!V.$i)V.active=!1}),zJ.clear();let Z=(J.mods&TJ)!==0,Q=[];for(let V=0;V<(Z?2:1);V++)G.spawn((q)=>{d1(q,J,V),q.$h=r1(J),Q.push(q)});if(Q.length===2)Q[0].$aZ=Q[1],Q[1].$aZ=Q[0],N._twinBoss=Q;else N._twinBoss=null;N.$D=Q[0],N.$C=2,N.$ad="BOSS: "+J.name,N.$ac=J.color}var iJ=0;function a1(J){if(N.$aa==="spawning"){if(iJ-=J,iJ<=0){let Z=6+N.wave*2.4+N.$w*1.2;if(G.count()<Z)pZ(Math.random()<0.1+N.wave*0.02?"elite":"small");iJ=W(0.16,1.65-N.wave*0.11-N.$w*0.1-N.wave*N.wave*0.0015)}if(N.$aH>=N.$aV)N.$aa="encounter",N.$aJ=!0,N.$N=W(N.$N,0.16),setTimeout(()=>{c1(),N.$aJ=!1},120)}else if(N.$aa==="encounter"){if(N.$aJ)return;let Z=!0;if(G.each((Q)=>{if(Q.$i)Z=!1}),Z)N.$aa="clear",zJ.clear(),T(L.x,L.y,"#fff",30,250),FJ(10),rJ(0.3,0.3),N.$C=2,N.$ad="WAVE "+N.wave+" CLEAR!",N.$ac="#0ff",setTimeout(()=>sZ(),2000)}if(N.$aj){if(N.$a6-=J,N.$a6<=0)N.$aj=!1}if(n)n.tick(J)}function sZ(){if(N.wave++,N.$aH=0,N.$aV=a(16,4+N.wave*2),N.$w=0.8+N.wave*0.5+N.wave*N.wave*0.02,N.$aa="spawning",n)n.unapply();n0(o0()),N.$aG=2,N.$bw="WAVE "+N.wave,N.$bf=n?n.name:"",N.$ao=3,N.$aI=n?n.desc:""}function KJ(J,Z,Q,V){if(!J.active)return;if(J.$l>0)return;let q=Z,K=Q==="shuriken";if(K)q=1;if(!K&&J.cc.$u>0)q*=1+J.cc.$u;let z=V||!1;if(!K&&!z&&E.$a4>0&&Math.random()<E.$a4)z=!0,q*=E.$bl;if(!K)q*=E.$ay;if(!K&&J.cc.$O>0)q*=1+J.cc.$u;if(J.$i&&J.$h&&J.$h.$p&&J.$h.$p.some((j)=>j.hp>0)){let j=null,H=1/0,F=0,M=0;for(let _ of J.$h.$p){if(_.hp<=0)continue;if(_.hp<H)H=_.hp,j=_}if(j){F=J.x+I(j.angle)*(J.r+24),M=J.y+R(j.angle)*(J.r+24);let _=W(1,q*0.9);if(j.hp=W(0,j.hp-_),j.lastHit=N.time,T(F,M,"#9ef",8,140),BZ(F,M,_|0,!1),!J.$h.$p.some((X)=>X.hp>0))N.$C=1.2,N.$ad="SHIELD BROKEN",N.$ac="#9ef"}return}if(J.hp-=q,J.$k=1,BZ(J.x,J.y,q|0,z),T(J.x,J.y,J.color,3,80),J.hp<=0)tZ(J)}function tZ(J){if(!J.active)return;J.active=!1;let Z=15,Q=450,q=(J.$i?Q:J.tier==="elite"?55:Z)*E.$aW;N.xp+=q;while(N.xp>=N.$ap&&N.$ap>0)N.xp-=N.$ap,N.level++,N.$ap=JJ((100+N.level*100)*wZ),N.$aB++;if(N.$bd++,N.$aH++,J.$i||J.tier==="elite")N.$N=0.05;if(J.shape==="circle")for(let K=0;K<12;K++){let z=O/12*K;lJ(J.x,J.y,I(z)*200,R(z)*200,J.color,0.3,2)}else if(J.shape==="square")for(let K=0;K<8;K++){let z=f/4+O/8*K;lJ(J.x+I(z)*J.r,J.y+R(z)*J.r,I(z)*150,R(z)*150,J.color,0.3,3)}else for(let K=0;K<3;K++){let z=O/3*K;for(let j=0;j<4;j++)lJ(J.x,J.y,I(z+x(-0.3,0.3))*(100+j*50),R(z+x(-0.3,0.3))*(100+j*50),J.color,0.3,2)}if(J.$i)if(T(J.x,J.y,"#fff",40,300),T(J.x,J.y,J.color,30,250),FJ(15),rJ(0.5,0.3),N._twinBoss&&J.$aY!==void 0){let K=J.$aZ;if(K&&K.active)N.$D=K;else N.$D=null,N._twinBoss=null}else N.$D=null;else T(J.x,J.y,J.color,15,180),FJ(J.tier==="elite"?8:3),rJ(0.06,0.5)}function s1(){if(!L.alive)return;if(kJ.each((J)=>{if(!J.active)return;G.each((Z)=>{if(!Z.active)return;if(Z.$i&&Z.$h&&Z.$h.$p&&Z.$h.$p.some((Q)=>Q.hp>0))for(let Q of Z.$h.$p){if(Q.hp<=0)continue;let V=Z.x+I(Q.angle)*(Z.r+24),q=Z.y+R(Q.angle)*(Z.r+24);if(S(J.x,J.y,V,q)<J.r+10){Q.hp=W(0,Q.hp-W(1,J.damage*1.1)),Q.lastHit=N.time,T(V,q,"#f99",6,120),J.active=!1;return}}if(S(J.x,J.y,Z.x,Z.y)<J.r+Z.r){if(J.src==="rocket"){J.active=!1,D1(J.x,J.y);return}if(J.src==="rocket_mini"){J.active=!1,T(J.x,J.y,"#fa0",8,100),FJ(2),G.each((Q)=>{if(!Q.active)return;if(S(J.x,J.y,Q.x,Q.y)<40+Q.r){KJ(Q,1,"rocket");let V=B(Q.y-J.y,Q.x-J.x);Q.cc.$F+=I(V)*80,Q.cc.$G+=R(V)*80}});return}if(KJ(Z,J.damage,J.src||"bullet"),J.$5>0)J.$5--;else if(!N.$5)J.active=!1}})}),L.invuln<=0)zJ.each((J)=>{if(!J.active)return;if(S(J.x,J.y,L.x,L.y)<J.r+L.r){if(E.$af>0&&Math.random()<E.$af)return;J.active=!1,aJ()}}),G.each((J)=>{if(!J.active)return;if(S(J.x,J.y,L.x,L.y)<J.r+L.r)aJ()})}function aJ(){if(L.invuln>0||!L.alive)return;if(L.$aF){L.$aF=!1,L.shieldCD=E.$aS,L.invuln=0.3,T(L.x,L.y,"#4af",12,150),FJ(4);return}if(L.hp--,L.invuln=ZJ.invulnDur,L.$k=0.3,FJ(10),T(L.x,L.y,"#0ff",15,200),L.hp<=0)L.alive=!1,T(L.x,L.y,"#0ff",40,300),T(L.x,L.y,"#fff",20,250),FJ(15),OZ.clear(),sJ=!1,tJ=!1,i=null,N.$aA=0,o="gameover"}var XJ=[];function DZ(){let J=[];for(let V of N.weapons){let q=EJ[V.id];if(!q)continue;for(let K of q.$bI)if(V.lv[K.id]<K.maxLv)J.push({type:"weaponUpg",$bg:V.id,upgId:K.id,def:K,wdef:q,curLv:V.lv[K.id]})}if(N.weapons.filter((V)=>EJ[V.id].type==="cc").length<2){let V=N.weapons.map((q)=>q.id);for(let q of e0)if(!V.includes(q))J.push({type:"newWeapon",$bg:q,wdef:EJ[q]})}let Q=Object.keys(N.$Q).filter((V)=>N.$Q[V]>0).length;for(let V of T1){let q=N.$Q[V]||0,K=cZ[V];if(!K)continue;if(q>0&&q<K.maxLv)J.push({type:"passiveUpg",$a9:V,def:K,curLv:q});else if(q===0&&Q<3)J.push({type:"newPassive",$a9:V,def:K})}for(let V=J.length-1;V>0;V--){let q=HJ(0,V);[J[V],J[q]]=[J[q],J[V]]}if(XJ=J.slice(0,5),XJ.length<5){let V=[{stat:"$ay",name:"+2% Damage",amt:0.02,color:"#f44"},{stat:"$P",name:"+2% Speed",amt:0.02,color:"#4f4"},{stat:"$aW",name:"+5% XP Gain",amt:0.05,color:"#ff0"},{stat:"$af",name:"+1% Dodge",amt:0.01,color:"#4af"},{stat:"$E",name:"+3% Cooldown",amt:0.03,color:"#48f"}];for(let K=V.length-1;K>0;K--){let z=HJ(0,K);[V[K],V[z]]=[V[z],V[K]]}let q=0;while(XJ.length<5){let K=V[q%V.length];q++,XJ.push({type:"microBuff",stat:K.stat,name:K.name,amt:K.amt,color:K.color})}}}function CJ(J){let Z=XJ[J];if(!Z)return;if(Z.type==="weaponUpg"){let Q=N.weapons.find((V)=>V.id===Z.$bg);if(Q)Q.lv[Z.upgId]++}else if(Z.type==="newWeapon")N.weapons.push(dZ(Z.$bg));else if(Z.type==="newPassive")N.$Q[Z.$a9]=1;else if(Z.type==="passiveUpg")N.$Q[Z.$a9]++;else if(Z.type==="microBuff"){if(!N._microBuffs)N._microBuffs={};N._microBuffs[Z.stat]=(N._microBuffs[Z.stat]||0)+Z.amt}if(oZ(),N.$aB--,N.$aB>0)DZ(),o="levelUp",N.$6=1;else o="playing"}function t1(J){J=J||1,$.save(),$.$a=J,P("LEVEL UP",k,h-140,22,"#ff0","center","middle"),$.restore();let Z=a(5,XJ.length),Q=150,V=140,q=12,K=Q*Z+q*(Z-1),z=k-K/2,j=h-60;for(let H=0;H<Z;H++){let F=XJ[H],M=z+H*(Q+q),_=j,X=AJ>=M&&AJ<=M+Q&&hJ>=_&&hJ<=_+V,Y="#0ff",D="",U="";if(F.type==="weaponUpg")Y=F.wdef.color,D=F.wdef.name+": "+F.def.name,U=F.def.desc[F.curLv]||"";else if(F.type==="newWeapon")Y=F.wdef.color,D="NEW "+F.wdef.name,U=F.wdef.cc?"CC: "+F.wdef.cc:F.wdef.desc;else if(F.type==="newPassive")Y=F.def.color,D="NEW "+F.def.name,U=F.def.desc[0];else if(F.type==="passiveUpg")Y=F.def.color,D=F.def.name,U=F.def.desc[F.curLv]||"";else if(F.type==="microBuff")Y=F.color,D="MINOR BOOST",U=F.name;$.save(),$.$a=X?1:0.78,$.$b="rgba(8,16,24,.9)",$.fillRect(M,_,Q,V),$.$c=X?"#fff":Y,$.$d=X?2:1.2,$.strokeRect(M,_,Q,V),$.restore(),P(D,M+Q/2,_+24,10,X?"#fff":Y,"center","middle"),P(U,M+Q/2,_+70,9,"#9aa","center","middle"),P("["+(H+1)+"]",M+Q/2,_+V-14,12,"#666","center","middle")}P(N.$6>0?"[R] Reroll ("+N.$6+")":"[R] No rerolls",k,j+V+20,13,N.$6>0?"#4f4":"#666","center","middle")}function gJ(){$.save(),$.$b="#000",$.$a=0.04;for(let J=0;J<b;J+=4)$.fillRect(0,J,w,1);$.restore()}function e1(){let J=$.createRadialGradient(k,h,a(w,b)*0.3,k,h,a(w,b)*0.7);J.addColorStop(0,"rgba(0,0,0,0)");let Z=L.hp<=1&&L.alive;J.addColorStop(1,Z?"rgba(80,0,0,0.5)":"rgba(0,0,0,0.35)"),$.save(),$.$b=J,$.fillRect(0,0,w,b),$.restore()}function J5(){let J=a(w-16,560),Q=k-J/2,q=v(L.hp/W(1,L.$o),0,1),K=v(N.xp/N.$ap,0,1),z=q>0.5?"#0ef":q>0.25?"#fd4":"#f55";$.save(),$.$b="rgba(0,0,0,.55)",$.fillRect(Q,10,J,54),$.$c="rgba(255,255,255,.15)",$.strokeRect(Q,10,J,54),$.restore();let j=Q+42,H=19,F=J-54,M=12,_=10,X=2,Y=(F-X*(_-1))/_;for(let C=0;C<_;C++){let u=j+C*(Y+X),d=v(q*_-C,0,1);if($.$b="rgba(18,18,18,.95)",$.fillRect(u,H,Y,M),d>0)$.$b=z,$.fillRect(u,H,Y*d,M);$.$c="rgba(255,255,255,.24)",$.strokeRect(u,H,Y,M)}let D=H+M+6;$.$b="rgba(18,18,18,.95)",$.fillRect(j,D,F,9),$.$b="#fd4",$.fillRect(j,D,F*K,9),$.$c="rgba(255,223,74,.3)",$.strokeRect(j,D,F,9),P("HP",Q+12,H,10,"#dff"),P("XP",Q+12,D-1,10,"#fd4");let U=N.time%60|0,m=N.time/60|0;if(P("TIME "+m+":"+(U<10?"0":"")+U,Q+12,51,9,"#8ea"),n)P(n.name,Q+J-12,51,9,n.color,"right");let A=72,t=a(w-80,460),s=k-t/2;if(N.$D&&N.$D.active){let C=N.$D,d=C.hp/C.$o;P(C.$bz||"BOSS",k,A+16,11,C.color,"center","top"),$.$b="#222",$.fillRect(s,A,t,12),$.$b="#c33",$.fillRect(s,A,t*d,12),$.$c="rgba(255,80,80,.6)",$.strokeRect(s,A,t,12)}else if(N.$aa==="spawning"){let C=v(N.$aH/N.$aV,0,1);$.$b="rgba(20,20,20,.92)",$.fillRect(s,A,t,7),$.$b="#0ff",$.fillRect(s,A,t*C,7),$.$c="rgba(0,255,255,.32)",$.strokeRect(s,A,t,7)}let VJ={chain:0.8,rocket:2.2,drone:1.5,shuriken:1.2},e=52,g=k-W(1,N.weapons.length)*e/2+e/2;for(let C=0;C<N.weapons.length;C++){let u=N.weapons[C],d=EJ[u.id],r=g+C*e,p=b-46;$.$b="rgba(0,0,0,.5)",$.fillRect(r-18,p-12,36,24),$.$c=d.color,$.strokeRect(r-18,p-12,36,24),P(d.name.charAt(0),r,p-1,12,d.color,"center","middle");let jJ=VJ[u.id];if(jJ&&u.timer!==void 0){let fJ=v(1-u.timer/jJ,0,1);$.$b="rgba(0,0,0,.55)",$.fillRect(r-18,p+14,36,3),$.$b=d.color,$.fillRect(r-18,p+14,36*fJ,3)}}if(N.$C>0)N.$C-=0.016666666666666666,$.save(),$.$a=a(1,N.$C*2),P(N.$ad,k,h-60,24,N.$ac,"center","middle"),$.restore();if(N.$aG>0){N.$aG-=0.016666666666666666;let C=a(1,N.$aG);$.save(),$.$a=C;let u=30+20*(1-C);if(P(N.$bw,k,h-30,u,"#fff","center","middle"),N.$bf)P(N.$bf,k,h+10,16,n?n.color:"#888","center","middle");$.restore()}if(N.$ao>0&&N.$aI){N.$ao-=0.016666666666666666;let C=v(N.$ao/3,0,1),u=a(w-40,720),d=50,r=k-u/2,p=b-136;$.save(),$.$a=0.24*C,$.$b="#000",$.fillRect(r,p,u,d),$.$a=0.4*C,$.$c=n?n.color:"#aaa",$.$d=1.4,$.strokeRect(r,p,u,d),$.restore(),P("MODIFIER: "+N.$aI,k,p+16,16,n?n.color:"#9ab","center","top")}}var jZ=0;function Z5(J){if(jZ+=J,$.$b="#000",$.fillRect(0,0,w,b),$.save(),$.$a=0.7+R(jZ*3)*0.3,P("NEON PHASES",k,h-80,42,"#0ff","center","middle"),$.restore(),P("v2  Waves + Weapons",k,h-40,13,"#888","center","middle"),(jZ*2|0)%2)P("Press ENTER to Start",k,h+10,16,"#fff","center","middle");P("WASD=Move  Mouse=Aim",k,h+50,10,"#888","center","middle"),gJ()}function $5(){$.$b="rgba(0,0,0,0.85)",$.fillRect(0,0,w,b),P("CHOOSE YOUR WEAPON",k,60,24,"#0ff","center","middle");let J=yJ.length,Z=180,Q=200,V=20,q=Z*J+V*(J-1),K=k-q/2,z=h-70;for(let j=0;j<J;j++){let H=yJ[j],F=EJ[H],M=K+j*(Z+V),_=z,X=AJ>=M&&AJ<=M+Z&&hJ>=_&&hJ<=_+Q,Y=X?"#fff":F.color;$.save(),$.$a=X?1:0.75,$.$b="rgba(8,16,24,0.9)",$.fillRect(M,_,Z,Q),$.$c=Y,$.$d=X?2:1.2,$.strokeRect(M,_,Z,Q),$.restore(),P(F.name,M+Z/2,_+25,13,Y,"center","middle"),P(F.type==="starter"?"PRIMARY":"CC",M+Z/2,_+62,10,F.color,"center","middle"),P(F.desc,M+Z/2,_+96,9,"#9aa","center","middle"),P("["+(j+1)+"]",M+Z/2,_+Q-20,14,"#555","center","middle")}gJ()}function pJ(J){if(J<0||J>=yJ.length)return;N.weapons=[dZ(yJ[J])],o="playing",sZ()}function Q5(){$.save(),$.$b="rgba(0,0,0,.5)",$.fillRect(0,0,w,b),$.restore(),P("PAUSED",k,h-20,36,"#0ff","center","middle"),P("Press ESC to Resume",k,h+30,16,"#888","center","middle")}function V5(){$.save(),$.$b="rgba(0,0,0,.6)",$.fillRect(0,0,w,b),$.restore(),P("GAME OVER",k,h-110,36,"#f44","center","middle");let J=W(0,N.wave-1);P("Waves Survived: "+J,k,h-66,17,"#fff","center","middle"),P("Enemies Killed: "+N.$bd,k,h-44,14,"#9cf","center","middle"),P("[R] Restart",k,h+30,12,"#888","center","middle")}function GZ(){IZ(),m0(),oZ(),zJ.clear(),kJ.clear(),JZ.clear(),G.clear(),bJ.clear(),UJ.length=0,SJ.length=0,c.x=0,c.y=0,N.time=0,N.$w=0.8,N.wave=0,N.$aH=0,N.$aV=0,N.$aa="clear",N.xp=0,N.level=1,N.$ap=JJ(200*wZ),N.$aB=0,N.$bd=0,N.$aj=!1,N.$a6=0,N.$N=0,N.$C=0,N.$aG=0,N.$ao=0,N.$aI="",N.$aE=!1,N.$s=0,N.$U=0,N.$V=0,N.$al=0,N.$H=0,N.decay=!1,N.$bt=!1,N.$bF=0,N.$bE=0,N.$5=!1,N.echo=!1,N.weapons=[],N.$Q={},N._microBuffs={},N.$D=null,N._twinBoss=null,N.$Y=[],N.$0=1,N.$6=0,N.$ar=0,N.$as=[],N.$aJ=!1,N.$aA=0,DJ.length=0,window.$Z=[],_J.length=0,vJ.length=0,MJ.length=0,n=null,HZ=-1,iJ=1,dJ=0,o="weaponSelect"}addEventListener("keydown",(J)=>{if(MZ.add(J.code),["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(J.code))J.preventDefault();let Z=J.code;if(Z==="Escape"){if(o==="playing")o="paused";else if(o==="paused")o="playing"}if(Z==="Enter"&&o==="title")GZ();if(Z==="KeyR"&&o==="gameover")GZ();if(o==="weaponSelect"){if(Z==="Digit1")pJ(0);if(Z==="Digit2")pJ(1);if(Z==="Digit3")pJ(2)}if(o==="levelUp"&&(N.$0||0)>=0.9){if(Z==="Digit1")CJ(0);if(Z==="Digit2")CJ(1);if(Z==="Digit3")CJ(2);if(Z==="Digit4")CJ(3);if(Z==="Digit5")CJ(4);if(Z==="KeyR"&&N.$6>0)N.$6--,DZ()}if(Z==="KeyR"&&o==="playing"){let Q=N.weapons.find((V)=>V.id==="dagger");if(Q&&Q.state!=="idle")Q.state="returning"}});function q5(J,Z,Q){let V=rZ(J);if(!V)return;if(V.id==="dagger")q1(V,Z,Q);else if(V.id==="sword")K1(V,Z,Q);else if(V.id==="bow")F1(V)}function gZ(J){let Z=rZ(J);if(!Z)return;if(Z.id==="bow")L1(Z)}var mZ=performance.now();function eZ(J){requestAnimationFrame(eZ);let Z=v((J-mZ)/1000,0,0.05);if(mZ=J,o==="title"){Z5(Z);return}if(o==="paused"){Q5();return}if(o==="weaponSelect"){if(i){let Q=yJ.length,V=180,q=200,K=20,z=180*Q+20*(Q-1),j=k-z/2,H=h-70;for(let F=0;F<Q;F++){let M=j+F*200;if(i.x>=M&&i.x<=M+180&&i.y>=H&&i.y<=H+200){pJ(F);break}}i=null}$5();return}if(o==="gameover"){N.$aA=a(1,(N.$aA||0)+Z*2.8),$.$b="rgba(0,0,0,"+(0.25+0.75*N.$aA)+")",$.fillRect(0,0,w,b),EZ(Z),kZ(),gJ(),V5();return}if(o==="levelUp"){if(N.$0===void 0)N.$0=1;N.$0=a(1,N.$0+Z*4);let Q=N.$0,V=Q<1?1-Math.pow(1-Q,3):1;if($.$b="rgba(0,0,0,"+0.5*V+")",$.fillRect(0,0,w,b),i&&Q>=0.9){let q=a(5,XJ.length),K=150,z=140,j=12,H=150*q+12*(q-1),F=k-H/2,M=h-60;for(let _=0;_<q;_++){let X=F+_*162;if(i.x>=X&&i.x<=X+150&&i.y>=M&&i.y<=M+140){CJ(_);break}}i=null}else if(i)i=null;t1(V),gJ();return}if(i&&o==="playing"){let Q=NZ();q5(i.btn,Q.x,Q.y),i=null}if(!sJ)gZ(0);if(!tJ)gZ(2);if(dJ>0)dJ-=Z,Z*=nZ;if(N.time+=Z,N.$N=W(0,N.$N-Z),N.$aB>0&&o==="playing"){DZ(),o="levelUp",N.$0=0,N.$6=1;return}if(c.x=l(c.x,L.x,8*Z),c.y=l(c.y,L.y,8*Z),$.$b="rgba(0,0,0,"+ZJ.trailAlpha+")",$.fillRect(0,0,w,b),V0(),$.save(),$.translate(-c.x+k+FZ,-c.y+h+LZ),G0(),g0(),y0(Z),J1(Z),r0(Z),k0(Z),CZ(zJ,Z,!1),CZ(kJ,Z,!0),EZ(Z),N0(Z),L0(Z),M0(Z),W0(Z),v0(Z),s1(),a1(Z),H0(),_0(),D0(),T0(),SZ(zJ),SZ(kJ),a0(),w0(),Z1(),B0(),_1(),kZ(),F0(),N._twinBoss){let Q=N._twinBoss;if(Q[0]&&Q[0].active&&Q[1]&&Q[1].active&&Q[0].$h.$bn){$.save();let V=v(0.4+R(N.time*5)*0.2,0,1);$.beginPath(),$.moveTo(Q[0].x,Q[0].y),$.lineTo(Q[1].x,Q[1].y),$.$c="#f4a",$.$d=6,$.$a=V*0.3,$.$j="#f4a",$.$f=15,$.stroke(),$.beginPath(),$.moveTo(Q[0].x,Q[0].y),$.lineTo(Q[1].x,Q[1].y),$.$c="#fff",$.$d=2,$.$a=V*0.5,$.$f=8,$.stroke();let q=Q[1].x-Q[0].x,K=Q[1].y-Q[0].y,z=y(q*q+K*K);if(z>0){let j=-K/z,H=q/z,F=L.x-Q[0].x,M=L.y-Q[0].y,_=F*q/z+M*K/z,X=PJ(F*j+M*H);if(_>0&&_<z&&X<20)aJ()}$.restore()}else if(Q[0]&&!Q[0].active&&Q[1]&&Q[1].active)N.$D=Q[1]}if(G.each((Q)=>{if(!Q.active||!Q.$i||!Q.$h||!Q.$h.$B)return;for(let V of Q.$h.$B){let q=v(V.life/0.25,0,1);nJ(V.x1,V.y1,q,0),nJ(V.x2,V.y2,q,1.1)}}),G.each((Q)=>{if(!Q.active||!Q.$i||!Q.$h||!Q.$h.$K)return;let V=Q.$h.$K,q=1-v(V.t/W(0.0001,V.maxT),0,1);nJ(V.toX,V.toY,0.35+0.65*q,1.6),nJ(Q.x,Q.y,0.25+0.45*q,0.35)}),N.$Y)for(let Q=N.$Y.length-1;Q>=0;Q--){let V=N.$Y[Q];if(V.life-=Z,V.life<=0){N.$Y.splice(Q,1);continue}let q=1-V.life/V.$g;$.save(),$.beginPath(),$.arc(V.x,V.y,V.r*q,0,O),$.$c="#f80",$.$d=3*(1-q),$.$a=(1-q)*0.6,$.$j="#f80",$.$f=10,$.stroke(),$.beginPath(),$.arc(V.x,V.y,V.r*q*0.6,0,O),$.$c="#ff4",$.$d=2*(1-q),$.$a=(1-q)*0.4,$.stroke(),$.restore()}if($.restore(),N.$N>0)$.save(),$.$b="#fff",$.$a=N.$N*3,$.fillRect(0,0,w,b),$.restore();if(N.$aj)$.save(),$.$b="rgba(50,100,200,0.08)",$.fillRect(0,0,w,b),$.restore();e1(),J5(),gJ(),i=null}requestAnimationFrame(eZ);})();</script></body></html>