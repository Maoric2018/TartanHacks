<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>NEON PHASES</title><style>*{margin:0;padding:0}body{background:#000;overflow:hidden}canvas{display:block;cursor:crosshair}</style></head><body><canvas id="c"></canvas><script>"use strict";var e,l;e="center",l="middle",(()=>{function t(e,l){return e+Math.random()*(l-e)}function a(e,l){return e+Math.random()*(l-e+1)|0}function r(){return Math.random()*Math.PI*2}function i(e){return e[Math.random()*e.length|0]}var o=Math.PI,n=2*o,{cos:s,sin:f,sqrt:d,abs:c,min:y,max:g,atan2:v,floor:h}=Math;function p(e,l,t){return e<l?l:e>t?t:e}function m(e,l,t){return e+(l-e)*t}function x(e,l,t,a){return d((e-t)**2+(l-a)**2)}function u(e,l,t,a,r,i){let o=r-t,n=i-a,s=o*o+n*n;if(s<=1e-6)return x(e,l,t,a);let f=p(((e-t)*o+(l-a)*n)/s,0,1);return x(e,l,t+o*f,a+n*f)}function T(e){return"string"==typeof e&&"#0ff"===e.toLowerCase()?"#0cf":e||"#f44"}var b,w,S,A,k,P=document.getElementById("c"),_=P.getContext("2d"),R={x:0,y:0};function C(){k=devicePixelRatio||1,b=innerWidth,w=innerHeight,P.width=b*k,P.height=w*k,P.style.width=b+"px",P.style.height=w+"px",_.setTransform(k,0,0,k,0,0),S=b/2,A=w/2}addEventListener("resize",C),C();var D=new Set,F=S,L=A,I=null,E=0,M=0;function W(e){return D.has(e)}function B(){return{x:F-S+R.x,y:L-A+R.y}}addEventListener("keyup",e=>D.delete(e.code)),addEventListener("mousemove",e=>{F=e.clientX,L=e.clientY}),addEventListener("mousedown",e=>{0===e.button&&(E=1),2===e.button&&(M=1),I={x:e.clientX,y:e.clientY,btn:e.button}}),addEventListener("mouseup",e=>{0===e.button&&(E=0),2===e.button&&(M=0)}),addEventListener("contextmenu",e=>e.preventDefault());var H="title",U={time:0,difficulty:.8,wave:0,waveKills:0,waveQuota:0,waveState:"spawning",xp:0,level:1,xpToNext:160,levelUpQueue:0,totalKills:0,frozen:0,freezeTimer:0,bannerTimer:0,bannerText:"",bannerColor:"#fff",weapons:[],passives:{},killFlash:0,waveBannerTimer:0,waveBannerText:"",gameOverFade:0},O={speed:[["moveSpeed","mul",[1,1.15,1.3,1.4]],["dodgeChance","set",[0,0,0,.08]]],regen:[["regenInterval","set",[999,14,8,8]]],cooldown:[["cdReduction","set",[0,.12,.2,.25]]],damage:[["dmgMult","mul",[1,1.3,1.5]]]};function N(e,l,t){void 0!==t&&("mul"===l?z[e]*=t:"mul1"===l?z[e]*=1+t:"add"===l?z[e]+=t:z[e]="add_cap"===l?y(.5,z[e]+t):t)}var z={moveSpeed:240,critChance:0,critMult:2,xpMult:1,cdReduction:0,regenTimer:0,regenInterval:999,dodgeChance:0,dmgMult:1};function V(){z.moveSpeed=240,z.critChance=0,z.critMult=2,z.xpMult=1,z.cdReduction=0,z.regenInterval=999,z.dodgeChance=0,z.dmgMult=1;let e=U.passives;for(let l in O){let t=0|e[l];if(!t)continue;let a=O[l];for(let e=0;e<a.length;e++){let l=a[e],r=l[2];N(l[0],l[1],r[y(t,r.length-1)])}}let l=0|e._speedLoop,t=0|e._damageLoop;l&&(z.moveSpeed*=1+.15*l),t&&(z.dmgMult*=1+.3*t)}var K=0,q=0,G=0,Q=0,X=1;function Y(e){G=g(G,e)}function $(e,l){Q=e,X=l}function j(e,l,t,a,r){r=r||3,_.save();for(let i=r;i>0;i--)_.beginPath(),_.arc(e,l,t+2.5*i,0,n),_.strokeStyle=a,_.lineWidth=2*i,_.globalAlpha=.07,_.stroke();_.beginPath(),_.arc(e,l,t,0,n),_.strokeStyle=a,_.lineWidth=1.5,_.globalAlpha=1,_.stroke(),_.restore()}function J(e,l,t,a){_.save(),_.beginPath(),_.arc(e,l,t+4,0,n),_.fillStyle=a,_.globalAlpha=.12,_.fill(),_.beginPath(),_.arc(e,l,t,0,n),_.fillStyle=a,_.globalAlpha=.9,_.fill(),_.restore()}function Z(e,l,t,a){function r(){_.beginPath(),_.moveTo(e[0].x,e[0].y);for(let l=1;l<e.length;l++)_.lineTo(e[l].x,e[l].y);t&&_.closePath()}t=0!=t,a=a||3,_.save();for(let e=a;e>0;e--)r(),_.strokeStyle=l,_.lineWidth=2.5*e,_.globalAlpha=.07,_.stroke();r(),_.strokeStyle=l,_.lineWidth=1.5,_.globalAlpha=1,_.stroke(),_.restore()}function ee(e,l,t,a){let r=[];for(let i=0;i<3;i++){let d=a+n/3*i-o/2;r.push({x:e+s(d)*t,y:l+f(d)*t})}return r}function le(e,l,t,a,r,i,o){_.save(),_.font="bold "+a+"px monospace",_.textAlign=i||"left",_.textBaseline=o||"top",_.shadowColor=r,_.shadowBlur=10,_.fillStyle=r,_.globalAlpha=.5,_.fillText(e,l,t),_.shadowBlur=0,_.globalAlpha=1,_.fillText(e,l,t),_.restore()}function te(e,l,t,a,r,i){_.beginPath(),_.arc(e,l,t,0,n),_.strokeStyle=a,_.lineWidth=r||1,void 0!==i&&(_.globalAlpha=i),_.stroke()}function ae(e,l,t,a,r,i,o,n){_.save(),void 0!==n&&(_.globalAlpha=n),r&&(_.fillStyle=r,_.fillRect(e,l,t,a)),i&&(_.strokeStyle=i,_.lineWidth=o||1,_.strokeRect(e,l,t,a)),_.restore()}function re(e,l){let t=[];for(let a=0;a<e;a++){let e=l();e.active=0,t.push(e)}return t.spawn=e=>{for(let l=0;l<t.length;l++)if(!t[l].active)return t[l].active=1,e(t[l]),t[l];let l=0,a=1/0;for(let e=0;e<t.length;e++)t[e].spawnTime<a&&(a=t[e].spawnTime,l=e);return t[l].active=1,e(t[l]),t[l]},t.each=e=>{for(let l=0;l<t.length;l++)t[l].active&&e(t[l])},t.count=()=>{let e=0;for(let l=0;l<t.length;l++)t[l].active&&e++;return e},t.clear=()=>{for(let e=0;e<t.length;e++)t[e].active=0},t}function ie(){return{active:0,x:0,y:0,vx:0,vy:0,r:4,life:0,maxLife:3,type:"normal",color:"#f44",spawnTime:0,damage:1,curve:0,pulseAmp:0,pulseFreq:0,split:0,baseSpeed:0,src:null,loopAmp:0,loopFreq:0,loopBaseAng:0}}var oe=re(900,ie),ne=re(150,ie),se=re(500,()=>({active:0,x:0,y:0,vx:0,vy:0,life:0,maxLife:.4,color:"#fff",r:2,spawnTime:0})),fe=re(50,()=>({active:0,x:0,y:0,vx:0,vy:0,r:14,hp:2,maxHp:2,shape:"circle",color:"#f44",moveType:"drifter",firePattern:"single",fireTimer:0,fireCD:2,tier:"small",angle:0,hitFlash:0,spiralAngle:0,moveParams:{},fireParams:{},spawnTime:0,cc:{stunT:0,silenceT:0,rootT:0,slowAmt:0,slowT:0,fearT:0,markT:0,markAmp:0,kbVx:0,kbVy:0,disorientT:0,bleedDmg:0,bleedT:0}})),de=[];function ce(e,l,t,a,r,i,o){se.spawn(n=>{n.x=e,n.y=l,n.vx=t,n.vy=a,n.color=r,n.life=i||.4,n.maxLife=i||.4,n.r=o||2,n.spawnTime=U.time})}function ye(e,l,t,a,r){for(let i=0;i<a;i++){let a=Math.random()*n,i=r*(.3+.7*Math.random());ce(e,l,s(a)*i,f(a)*i,t,.2+.3*Math.random(),1+2*Math.random())}}function ge(e){se.each(l=>{l.x+=l.vx*e,l.y+=l.vy*e,l.vx*=.97,l.vy*=.97,l.life-=e,l.life<=0&&(l.active=0)})}function ve(){se.each(e=>{let l=p(e.life/e.maxLife,0,1);_.save(),_.globalAlpha=.8*l,_.beginPath(),_.arc(e.x,e.y,e.r*l,0,n),_.fillStyle=e.color,_.fill(),_.restore()})}var he=[];function pe(e,l,t,a,r,i,o,n){let s=r*(n?1+.35*i:.8+.4*i),f=g(n?4:3,r*(n?.45:.3)*(n?.85+.25*i:.8+.3*i)),d=g(n?2.5:2,r*(n?.2:.12));_.save(),_.lineCap="round";let c=_.createLinearGradient(e,l,t,a);c.addColorStop(0,"rgba(255,255,255,0)"),c.addColorStop(.08,"rgba(255,216,74,"+(.12+.14*i)+")"),c.addColorStop(1,n?"rgba(255,120,120,"+(.1+.22*i)+")":"rgba(255,216,74,"+(.08+.2*i)+")"),_.beginPath(),_.moveTo(e,l),_.lineTo(t,a),_.strokeStyle=c,_.lineWidth=s,_.globalAlpha=1,_.shadowColor=o,_.shadowBlur=n?18:20,_.stroke();let y=_.createLinearGradient(e,l,t,a);y.addColorStop(0,"rgba(255,255,255,0)"),y.addColorStop(n?.1:.08,"rgba(255,255,255,"+(n?.15+.2*i:.16+.2*i)+")"),y.addColorStop(1,n?"rgba(255,180,180,"+(.2+.38*i)+")":"rgba(255,216,74,"+(.2+.4*i)+")"),_.beginPath(),_.moveTo(e,l),_.lineTo(t,a),_.strokeStyle=y,_.lineWidth=f,_.shadowBlur=n?10:12,_.stroke();let v=_.createLinearGradient(e,l,t,a);v.addColorStop(0,"rgba(255,255,255,0)"),v.addColorStop(n?.12:.1,"rgba(255,255,255,"+(.25+.25*i)+")"),v.addColorStop(1,"rgba(255,255,255,"+(n?.3+.4*i:.35+.45*i)+")"),_.beginPath(),_.moveTo(e,l),_.lineTo(t,a),_.strokeStyle=v,_.lineWidth=d,_.shadowBlur=n?6:8,_.stroke(),_.restore()}function me(e,l,t,a,i,o,n,d){if(he.length>=18)return;let c=a||0,y=i||1,v=o||1,h=n||1,x=-f(t),T=s(t),S=we.x+16*s(t)+x*c,A=we.y+16*f(t)+T*c,k=1.9*g(b,w)*h,P=m(4,26,l)*v,_=m(1.2,11,l)*y,R=p(0|e.lv.a,0,2);k*=1+.08*R,P*=1+.08*R,_*=1+.07*R;let C=S+s(t)*k,D=A+f(t)*k;fe.each(l=>{if(l.active&&u(l.x,l.y,S,A,C,D)<=.5*P+l.r&&(ol(l,_),"bow"===e.id)){let t=p(0|e.lv.c,0,2);t>0&&(l.cc.bleedDmg=g(l.cc.bleedDmg,[0,1.2,2.2][t]),l.cc.bleedT=g(l.cc.bleedT,[0,1.5,2.5][t]))}}),oe.each(e=>{e.active&&u(e.x,e.y,S,A,C,D)<=.55*P+e.r&&(e.active=0,ye(e.x,e.y,"#ff0",2,70))});for(let e=0;e<6;e++){let l=.15+.15*e;ye(m(S,C,l),m(A,D,l),"#ff0",2,60)}he.push({x1:S,y1:A,x2:C,y2:D,width:P,length:k,life:.12+.1*l,maxLife:.12+.1*l,color:d||"#ff0",phase:r(),hot:0})}var xe=["#f44","#f84","#fd4","#f6f","#9f6","#f95"],ue={t:0,enemies:[],bullets:[]};function Te(e){(e=e||{}).x=t(0,b),e.y=t(0,w);let l=r(),a=t(35,95);return e.vx=s(l)*a,e.vy=f(l)*a,e.r=t(8,16),e.shape=i(["circle","triangle"]),e.color=i(xe),e.fire=t(.2,1.1),e}function be(e){let l=v(A-e.y,S-e.x)+t(-.9,.9),a=t(120,220);ue.bullets.push({x:e.x,y:e.y,vx:s(l)*a,vy:f(l)*a,life:t(1.2,2.6),r:2.4,color:e.color})}var we={x:0,y:0,r:12,hp:10,maxHp:10,invuln:0,angle:0,hitFlash:0,alive:1,swordIFrame:0},Se={drifter(e,l){if(e.x+=e.vx*l,e.y+=e.vy*l,x(e.x,e.y,we.x,we.y)>500){let t=v(we.y-e.y,we.x-e.x);e.vx+=40*s(t)*l,e.vy+=40*f(t)*l}let t=d(e.vx**2+e.vy**2);t>100&&(e.vx*=100/t,e.vy*=100/t)},chaser(e,l){let t=v(we.y-e.y,we.x-e.x),a=e.moveParams.speed||120;e.vx=m(e.vx,s(t)*a,2*l),e.vy=m(e.vy,f(t)*a,2*l),e.x+=e.vx*l,e.y+=e.vy*l},orbiter(e,l){let t=e.moveParams.radius||150;e.moveParams.angle=(e.moveParams.angle||0)+(e.moveParams.speed||1.5)*l,e.x=m(e.x,we.x+s(e.moveParams.angle)*t,3*l),e.y=m(e.y,we.y+f(e.moveParams.angle)*t,3*l)},dasher(e,l){let t=e.moveParams;if(t.state||(t.state="wait"),"wait"===t.state){t.waitTime=(t.waitTime||0)+l;let a=v(we.y-e.y,we.x-e.x);if(e.x+=20*s(a)*l,e.y+=20*f(a)*l,t.waitTime>1.5){let l=v(we.y-e.y,we.x-e.x),a=p(x(e.x,e.y,we.x,we.y)+36,120,260);t.state="telegraph",t.dashTx=e.x+s(l)*a,t.dashTy=e.y+f(l)*a,t.teleT=1,t.teleMax=1,e._dashTele={t:1,maxT:1,tx:t.dashTx,ty:t.dashTy}}}else if("telegraph"===t.state)t.teleT-=l,e._dashInvuln=g(e._dashInvuln,.1),e._dashTele&&(e._dashTele.t=t.teleT),t.teleT<=0&&(t.state="dashing",t.dashT=.32,t.dashMax=.32,t.sx=e.x,t.sy=e.y,t.ex=t.dashTx,t.ey=t.dashTy,e._dashTele=null);else{t.dashT-=l;let a=p(1-t.dashT/t.dashMax,0,1),r=1-(1-a)*(1-a);e.x=m(t.sx,t.ex,r),e.y=m(t.sy,t.ey,r),e._dashInvuln=g(e._dashInvuln,.3),t.dashT<=0&&(e.x=t.ex,e.y=t.ey,t.state="wait",t.waitTime=0)}},sentry(e,l){let t=v(we.y-e.y,we.x-e.x);e.x+=15*s(t)*l,e.y+=15*f(t)*l,e.angle+=1.5*l},weaver(e,l){let t=e.moveParams;t.t=(t.t||0)+l;let a=v(we.y-e.y,we.x-e.x),r=t.speed||100,i=t.freq||2,n=a+o/2,d=80*f(t.t*i);e.x+=(s(a)*r+s(n)*d*i)*l,e.y+=(f(a)*r+f(n)*d*i)*l},stationary(e,l){},converge(e,l){let t=v(we.y-e.y,we.x-e.x),a=e.moveParams.speed||150;e.x+=s(t)*a*l,e.y+=f(t)*a*l}},Ae={single(e){let l=v(we.y-e.y,we.x-e.x),t=180+10*U.difficulty;ke(e.x,e.y,s(l)*t,f(l)*t,4,e.color,"normal",3)},triple(e){let l=v(we.y-e.y,we.x-e.x),t=170+8*U.difficulty;for(let a=-1;a<=1;a++)ke(e.x,e.y,s(l+.2*a)*t,f(l+.2*a)*t,3.5,e.color,"normal",2.5)},radial(e){let l=e.fireParams.count||8,t=140+5*U.difficulty,a=e.fireParams.offset||0;for(let r=0;r<l;r++){let i=n/l*r+a;ke(e.x,e.y,s(i)*t,f(i)*t,3.5,e.color,"normal",3)}e.fireParams.offset=(a+.15)%n},spiral(e){let l=160+6*U.difficulty;e.spiralAngle=(e.spiralAngle||0)+.4,ke(e.x,e.y,s(e.spiralAngle)*l,f(e.spiralAngle)*l,4,e.color,"curve",3.5,{curve:.4})},ringpop(e){for(let l=0;l<10;l++){let t=n/10*l;ke(e.x,e.y,200*s(t),200*f(t),3,e.color,"pulse",3,{pulseAmp:.7,pulseFreq:3})}},wave(e){let l=v(we.y-e.y,we.x-e.x),t=160+5*U.difficulty,a=l+o/2;for(let r=0;r<5;r++){let i=15*(r-2);ke(e.x+s(a)*i,e.y+f(a)*i,s(l)*t,f(l)*t,3,e.color,"normal",3)}}};function ke(e,l,t,a,r,i,o,n,s){oe.spawn(f=>{f.x=e,f.y=l,f.vx=t,f.vy=a,f.r=r||4,f.color=T(i||"#f44"),f.type=o||"normal",f.life=n||3,f.maxLife=n||3,f.spawnTime=U.time,f.damage=1,f.curve=s&&s.curve||0,f.pulseAmp=s&&s.pulseAmp||0,f.pulseFreq=s&&s.pulseFreq||0,f.split=s&&s.split||0,f.baseSpeed=d(t*t+a*a),f.loopAmp=s&&s.loopAmp||0,f.loopFreq=s&&s.loopFreq||0,f.loopBaseAng=s&&void 0!==s.loopBaseAng?s.loopBaseAng:v(a,t)})}var Pe=["#f44","#f84","#ff4","#4f4","#4ff","#f4f","#84f"],_e=["circle","square","triangle"],Re=["drifter","chaser","orbiter","dasher","sentry","weaver"],Ce=["single","triple","radial","spiral","ringpop","wave"];function De(e,l,t){U.frozen&&!t||e.each(e=>{if("curve"===e.type&&e.curve){let t=d(e.vx**2+e.vy**2),a=v(e.vy,e.vx)+e.curve*l;e.vx=s(a)*t,e.vy=f(a)*t}if("loop"===e.type&&e.loopAmp){let l=(U.time-e.spawnTime)*(e.loopFreq||2.6),t=e.loopBaseAng,a=g(80,e.baseSpeed),r=f(l*n)*(e.loopAmp||120),i=s(t),o=f(t),d=-o,c=i;e.vx=i*a+d*r,e.vy=o*a+c*r}if("pulse"===e.type&&e.pulseAmp){let l=1-e.life/e.maxLife,t=e.baseSpeed*(1+f(l*e.pulseFreq*n)*e.pulseAmp),a=v(e.vy,e.vx);e.vx=s(a)*t,e.vy=f(a)*t}if(e.x+=e.vx*l,e.y+=e.vy*l,e.life-=l,x(e.x,e.y,we.x,we.y)>1400&&(e.active=0),e.life<=0&&(e.active=0,e.split&&!t))for(let l=0;l<3;l++){let l=Math.random()*n;ke(e.x,e.y,100*s(l),100*f(l),2.5,e.color,"normal",1.5)}})}function Fe(e){e.each(e=>{let l=p(e.life/e.maxLife,0,1);_.save(),_.globalAlpha=l;let t="rocket"===e.src||"rocket_mini"===e.src?"rocket_mini"===e.src?"#fa0":"#f80":e.color;J(e.x,e.y,e.r,t),_.restore()})}var Le=(e,l)=>{for(let t in l)e[t]=l[t]},Ie={dagger:e=>Le(e,{state:"idle",dx:0,dy:0,tx:0,ty:0,speed:800,dmg:4,idleTimer:0,spinTimer:0,spinR:25}),sword:e=>Le(e,{swingCD:0,lungeTimer:0,lungeDir:0,lungeDist:120,lungeStartX:0,lungeStartY:0,lungeProg:0}),bow:e=>Le(e,{charging:0,chargeTime:0,maxCharge:1.5,shotCD:0}),chain:e=>Le(e,{timer:.1,range:200,chains:4,stunDur:.3,dmg:5,_arcTimer:0,_targets:null}),rocket:e=>Le(e,{timer:.1,blastR:90,kbForce:250,lastFired:0})};function Ee(e){let l={id:e,lv:{a:0,b:0,c:0,d:0}},t=Ie[e];return t&&t(l),l}var Me={};for(let e of[["dagger","MAGIC DAGGER","#0ff","starter","Click to throw. Click again to redirect.","",[["a","PIERCING THROW",3,["+50% speed","90% + homing","120% + homing"]],["b","SPECTRAL COPY",3,["1 ghost 50% dmg","2 ghosts 60%","3 ghosts 75%"]],["d","DAGGER STORM",2,["0.8s +75% radius","1.2s +150% radius"]]]],["sword","PLASMA SWORD","#f0f","starter","Click to lunge-slash forward, cleaving enemies and bullets. i-frames during dash.","",[["a","LUNGE REACH",3,["+33% range","+67%","+108%"]],["b","WIDE CLEAVE",3,["+25% size","+50%","+88%"]],["c","EDGE CHARGE",2,["+15% length +2 dmg","+30% length +4 dmg"]]]],["bow","VOLT BOW","#ff0","starter","Hold to charge, release a piercing beam.","",[["a","PRISM SPLIT",2,["1 side pair","2 side pairs"]],["b","QUICK DRAW",3,["1.0s charge","0.8s","0.6s"]],["c","PLASMA BURN",2,["Applies burn","Stronger burn"]]]],["chain","CHAIN LIGHTNING","#a0f","cc","Auto-zaps bullets, chains targets, leaves stun fields.","BULLET CLEAR",[["a","EXTRA CHAINS",2,["+3 chains","+6 chains"]],["b","MULTI STRIKE",2,["2 bolts at once","3 bolts"]],["c","STATIC FIELD",2,["3s stun zone","5s wider zone"]]]],["rocket","ROCKET LAUNCHER","#f80","cc","Homing rockets explode for knockback and bullet clearing.","KNOCKBACK",[["a","CONCUSSIVE BLAST",3,["+60 kb","+120 kb","+200 kb"]],["b","CLUSTER BOMB",2,["5 homing minis","7"]],["c","BLAST RADIUS",2,["+44%","+78%"]]]]]){let l=[];for(let t=0;t<e[6].length;t++){let a=e[6][t];l.push({id:a[0],name:a[1],maxLv:a[2],desc:a[3]})}let t={name:e[1],color:e[2],type:e[3],desc:e[4],upgrades:l};e[5]&&(t.cc=e[5]),Me[e[0]]=t}var We=["dagger","sword","bow"],Be=["chain","rocket"];function He(e){let l=null,t=null;for(let e=0;e<U.weapons.length;e++){let a=U.weapons[e];if("starter"===Me[a.id].type){if(l){t=a;break}l=a}}return 0===e?l:2===e?t:null}function Ue(e,l){if("flying"===e.state){let t=[1,1.5,1.9,2.2][e.lv.a],a=v(e.ty-e.dy,e.tx-e.dx),r=e.speed*t*l;x(e.dx,e.dy,e.tx,e.ty)<r+5?(e.dx=e.tx,e.dy=e.ty,e.lv.d>0?(e.state="spinning",e.spinTimer=[0,.8,1.2][e.lv.d],e.spinR=[0,35,50][e.lv.d]):(e.state="waiting",e.idleTimer=0)):(e.dx+=s(a)*r,e.dy+=f(a)*r),Oe(e,e.dmg)}else if("spinning"===e.state)e.spinTimer-=l,e.angle=(e.angle||0)+15*l,((e,l)=>{fe.each(t=>{t.active&&x(e.dx,e.dy,t.x,t.y)<e.spinR+t.r&&ol(t,[0,3,4][e.lv.d]*l*10)})})(e,l),e.spinTimer<=0&&(e.state="waiting",e.idleTimer=0);else if("waiting"===e.state)e.idleTimer+=l,e.idleTimer>2&&(e.state="returning");else if("returning"===e.state){let t=v(we.y-e.dy,we.x-e.dx),a=1.2*e.speed*l;e.dx+=s(t)*a,e.dy+=f(t)*a,Oe(e,e.dmg),x(e.dx,e.dy,we.x,we.y)<20&&(e.state="idle")}else e.dx=we.x,e.dy=we.y;if(e.lv.b>0){let l=[0,1,2,3][e.lv.b];e._ghosts||(e._ghosts=[]),e._posHistory||(e._posHistory=[]),e._posHistory.push({x:e.dx,y:e.dy}),e._posHistory.length>30&&e._posHistory.shift(),e._ghosts=[];for(let t=0;t<l;t++){let l=g(0,e._posHistory.length-1-6*(t+1));e._ghosts.push({x:e._posHistory[l].x,y:e._posHistory[l].y})}}}function Oe(e,l){if(fe.each(t=>{t.active&&x(e.dx,e.dy,t.x,t.y)<t.r+8&&ol(t,l)}),e.lv.b>0&&e._ghosts){let t=l*[0,.5,.6,.75][e.lv.b];for(let l of e._ghosts)fe.each(e=>{e.active&&x(l.x,l.y,e.x,e.y)<e.r+8&&ol(e,t)})}}function Ne(e){let l=e.dx||we.x,t=e.dy||we.y;if("idle"===e.state){let e=we.angle,l=we.x+18*s(e),t=we.y+18*f(e);Z([{x:l+8*s(e),y:t+8*f(e)},{x:l+5*s(e+2.3),y:t+5*f(e+2.3)},{x:l+5*s(e-2.3),y:t+5*f(e-2.3)}],"#0ff",1,3)}else{let a="spinning"===e.state?e.angle||0:v(e.dy-("returning"===e.state?we.y:e.ty),e.dx-("returning"===e.state?we.x:e.tx))+o;if(Z([{x:l+10*s(a),y:t+10*f(a)},{x:l+6*s(a+2.3),y:t+6*f(a+2.3)},{x:l+6*s(a-2.3),y:t+6*f(a-2.3)}],"#0ff",1,4),"spinning"===e.state&&((e,l,t,a,r,i)=>{_.save();for(let a=3;a>0;a--)_.beginPath(),_.arc(e,l,t,0,r),_.strokeStyle=i,_.lineWidth=1+2*a,_.globalAlpha=.06,_.stroke();_.beginPath(),_.arc(e,l,t,0,r),_.strokeStyle=i,_.lineWidth=1,_.globalAlpha=1,_.stroke(),_.restore()})(l,t,e.spinR,0,n,"#0ff"),e.lv.b>0&&e._ghosts&&"idle"!==e.state)for(let l=0;l<e._ghosts.length;l++){let t=e._ghosts[l],a="spinning"===e.state?e.angle||0:v(e.dy-t.y,e.dx-t.x);_.save(),_.globalAlpha=.35-.08*l,Z([{x:t.x+10*s(a),y:t.y+10*f(a)},{x:t.x+6*s(a+2.3),y:t.y+6*f(a+2.3)},{x:t.x+6*s(a-2.3),y:t.y+6*f(a-2.3)}],"#0ff",1,3),_.restore()}}}function ze(e,l){if(e.swingCD=g(0,e.swingCD-l),e.lungeTimer>0){e.lungeTimer-=l;let t=.18;e.lungeProg=p(1-e.lungeTimer/t,0,1);let a=e.lungeDist,r=[35,50,60,75][e.lv.b],i=e.lungeStartX+s(e.lungeDir)*a*e.lungeProg,o=e.lungeStartY+f(e.lungeDir)*a*e.lungeProg;we.x=i,we.y=o,we.invuln=g(we.invuln,.25),we.swordIFrame=g(we.swordIFrame,.25);let n=8+[0,2,4][e.lv.c],d=70*(1+[0,.15,.3][e.lv.c]);fe.each(l=>{if(!l.active)return;let t=l.x-i,a=l.y-o,y=s(e.lungeDir),g=f(e.lungeDir),v=t*y+a*g;v<-15-l.r||v>d+l.r||c(t*-g+a*y)<r+l.r&&(!l._swordHitT||U.time-l._swordHitT>.15)&&(l._swordHitT=U.time,ol(l,n,0,0),Y(2))}),oe.each(l=>{if(!l.active)return;let t=l.x-i,a=l.y-o,n=s(e.lungeDir),y=f(e.lungeDir),g=t*n+a*y;g<-15-l.r||g>d+l.r||c(t*-y+a*n)<r+l.r&&(l.active=0,ye(l.x,l.y,"#f0f",3,80))}),e.lungeTimer<=0&&(e.lungeTimer=0,e.lungeProg=0,ye(we.x,we.y,"#f0f",8,120),Y(4))}}function Ve(e){let l=60*(1+[0,.15,.3][e.lv.c]),t=e.lungeTimer>0?e.lungeDir:we.angle,a=t+o/2;if(e.lungeTimer>0){let{lungeProg:a,lungeDist:r}=e,i=[35,50,60,75][e.lv.b],n=e.lungeStartX,d=e.lungeStartY,c=.5*(n+(n+s(t)*r*a)),y=.5*(d+(d+f(t)*r*a)),v=g(10,r*a);_.save(),_.translate(c,y),_.rotate(t),_.fillStyle="rgba(255,120,255,.14)",_.fillRect(.5*-v,.45*-i,v,.9*i),_.strokeStyle="rgba(255,170,255,.22)",_.lineWidth=1,_.strokeRect(.5*-v,.45*-i,v,.9*i),_.restore();let h=t+(-o/2+o*a),p=h+o/2,m=we.x+10*s(h),x=we.y+10*f(h),u=we.x+s(h)*(10+l),T=we.y+f(h)*(10+l);Z([{x:m+4*s(p),y:x+4*f(p)},{x:m-4*s(p),y:x-4*f(p)},{x:u-1.5*s(p),y:T-1.5*f(p)},{x:u+6*s(h),y:T+6*f(h)},{x:u+1.5*s(p),y:T+1.5*f(p)}],"#f0f",1,5)}else{let e=we.x+14*s(t),r=we.y+14*f(t),i=we.x+s(t)*(14+.7*l),o=we.y+f(t)*(14+.7*l);Z([{x:e+2.5*s(a),y:r+2.5*f(a)},{x:e-2.5*s(a),y:r-2.5*f(a)},{x:i-1*s(a),y:o-1*f(a)},{x:i+4*s(t),y:o+4*f(t)},{x:i+1*s(a),y:o+1*f(a)}],"#f0f",1,2)}}function Ke(e,l){e.shotCD=g(0,e.shotCD-l);let t=[1.5,1,.8,.6][e.lv.b];e.maxCharge=t,e.charging&&(e.chargeTime=y(e.chargeTime+l,t))}function qe(e){if(e.charging){let l=p(e.chargeTime/e.maxCharge,0,1),t=18+10*l,a=we.angle,r=we.x+s(a)*(t+2),i=we.y+f(a)*(t+2),n=a+o/2;_.save();let d=r+s(a)*(5+3*l),c=i+f(a)*(5+3*l),y=r+s(n)*(2+1.5*l),g=i+f(n)*(2+1.5*l),v=r-s(n)*(2+1.5*l),h=i-f(n)*(2+1.5*l);_.beginPath(),_.moveTo(d,c),_.lineTo(y,g),_.lineTo(v,h),_.closePath(),_.fillStyle="#ff0",_.globalAlpha=.35+.4*l,_.shadowColor="#ff0",_.shadowBlur=8+10*l,_.fill(),te(we.x,we.y,t,"#ffd84a",1.2+1.2*l,.3+.5*l),te(we.x,we.y,.55*t,"#fff",.9+.9*l,.25+.45*l),_.restore()}}function Ge(e,l,t,a){let r=null,i=void 0===t?1/0:t;return fe.each(t=>{if(!t.active)return;if(a&&(a.has?a.has(t):a(t)))return;let o=x(e,l,t.x,t.y);o<i&&(i=o,r=t)}),r}function Qe(e,l,t,a,r){let i=null,o=void 0===t?1/0:t;return oe.each(t=>{if(!t.active)return;if(a&&(a.has?a.has(t):a(t)))return;if(r&&(r.has?r.has(t):r(t)))return;let n=x(e,l,t.x,t.y);n<o&&(o=n,i=t)}),i}function Xe(e,l){if((e=>{let l=window._staticFields;for(let t=l.length-1;t>=0;t--){let a=l[t];a.life-=e,a.x+=a.vx*e,a.y+=a.vy*e,a.vx*=.95,a.vy*=.95,a.vx+=40*(Math.random()-.5)*e,a.vy+=40*(Math.random()-.5)*e,a.life<=0?l.splice(t,1):(a._checkT=(a._checkT||0)-e,a._checkT>0||(a._checkT=.2,fe.each(e=>{if(e.active&&x(a.x,a.y,e.x,e.y)<e.r+8){if(U.time-(e._lastStaticStun||0)<3)return;e.cc.stunT=g(e.cc.stunT,a.stunDur),e._lastStaticStun=U.time}})))}})(l),e.timer-=l*(1-z.cdReduction),e.timer<=0){let l=e.range,t=e.chains+[0,3,3][e.lv.a],a=[1,2,3][e.lv.b]||1,r=e.lv.c;if(!Qe(we.x,we.y,l))return;e.timer=.8,e._zigzags=[],e._targets=[];let i=new Set;for(let o=0;o<a;o++){let d=new Set,c=[],y=we.x,g=we.y;if(o>0){let e=n/a*o;y=we.x+15*s(e),g=we.y+15*f(e)}for(let e=0;e<t;e++){let t=Qe(y,g,l+(e>0?100:0),d,i);if(!t)break;if(d.add(t),i.add(t),c.push({x:t.x,y:t.y}),ye(t.x,t.y,"#a0f",3,80),t.active=0,r>0){let e=[0,3,5][r],l=[0,25,40][r];$e(t.x,t.y,e,l)}y=t.x,g=t.y}let v=o>0?we.x+15*s(n/a*o):we.x,h=o>0?we.y+15*f(n/a*o):we.y;for(let l of c){let t=je(v,h,l.x,l.y,8);e._zigzags.push(t),e._targets.push(l),v=l.x,h=l.y}}e._arcTimer=.45}e._arcTimer>0&&(e._arcTimer-=l)}window._staticFields||(window._staticFields=[]);var Ye=200;function $e(e,l,t,a){if(window._staticFields.length>=Ye)return;let r=3+Math.floor(3*Math.random());for(let i=0;i<r&&!(window._staticFields.length>=Ye);i++){let r=Math.random()*n,i=Math.random()*a;window._staticFields.push({x:e+s(r)*i,y:l+f(r)*i,life:t,maxLife:t,r:a,stunDur:.15,vx:20*(Math.random()-.5),vy:20*(Math.random()-.5),size:2+3*Math.random()})}}function je(e,l,t,a,r){let i=[{x:e,y:l}],o=t-e,n=a-l,s=d(o*o+n*n),f=-n/s,c=o/s;for(let t=1;t<r;t++){let a=t/r,d=e+o*a,y=l+n*a,g=(Math.random()-.5)*s*.18;i.push({x:d+f*g,y:y+c*g})}return i.push({x:t,y:a}),i}function Je(e){if(e._arcTimer>0&&e._zigzags){let l=p(e._arcTimer/.45,0,1),t=(e,l,t,a,r)=>{_.beginPath(),_.moveTo(e[0].x,e[0].y);for(let l=1;l<e.length;l++)_.lineTo(e[l].x,e[l].y);_.strokeStyle=l,_.lineWidth=t,_.globalAlpha=a,_.shadowColor=l,_.shadowBlur=r,_.stroke()};_.save();for(let a of e._zigzags){t(a,"#a0f",6,.25*l,15),t(a,"#c6f",3,.6*l,8),t(a,"#eaf",1.5,l,4);let e=a[a.length-1];_.beginPath(),_.arc(e.x,e.y,4*l,0,n),_.fillStyle="#fff",_.globalAlpha=.8*l,_.shadowBlur=10,_.fill()}_.restore()}}function Ze(e,l){if(e.timer-=l*(1-z.cdReduction),e.timer<=0){e.timer=2.2;let l=Ge(we.x,we.y,9999),t=l?v(l.y-we.y,l.x-we.x):we.angle,a=350;ne.spawn(e=>{e.x=we.x+16*s(t),e.y=we.y+16*f(t),e.vx=s(t)*a,e.vy=f(t)*a,e.r=6,e.life=5,e.maxLife=5,e.type="normal",e.color="#f80",e.spawnTime=U.time,e.damage=0,e.split=0,e.baseSpeed=a,e.curve=0,e.pulseAmp=0,e.src="rocket",e._homing=1,e._homingDelay=0}),e.lastFired=U.time}ne.each(e=>{if(!e.active||"rocket"!==e.src&&"rocket_mini"!==e.src||!e._homing)return;if(e._homingDelay>0)return void(e._homingDelay-=l);let t=Ge(e.x,e.y,800);if(t){let a="rocket_mini"===e.src?4:3.5,r=((e,l,t,a,r,i,c,y)=>{let g=v(a-i,t-r),h=v(l,e),m=p((e=>{for(;e>o;)e-=n;for(;e<-o;)e+=n;return e})(g-h),-c*y,c*y),x=h+m,u=d(e*e+l*l);return{vx:s(x)*u,vy:f(x)*u}})(e.vx,e.vy,t.x,t.y,e.x,e.y,a,l);e.vx=r.vx,e.vy=r.vy}})}function el(e){}var ll=[["regen","REGENERATION","#4f4",3,["Heal 1HP/14s","1HP/8s","1HP/8s + emergency heal"]],["speed","SPEED BOOST","#4f4",3,["+15% speed","+30%","+40% + 8% dodge"]],["cooldown","COOLDOWN REDUCTION","#48f",3,["-12% all CDs","-20%","-25% + faster weapons"]],["damage","POWER SURGE","#f44",2,["+30% damage","+50% damage"]]],tl={};for(let e=0;e<ll.length;e++){let l=ll[e];tl[l[0]]={name:l[1],color:l[2],maxLv:l[3],desc:l[4]}}var al=ll.map(e=>e[0]),rl=0;function il(){U.wave++,U.waveKills=0,U.waveQuota=y(16,4+2*U.wave),U.difficulty=.8+.5*U.wave+U.wave*U.wave*.02,U.waveState="spawning",U.waveBannerTimer=2,U.waveBannerText="WAVE "+U.wave}function ol(e,l,t,a){if(!e.active)return;if(e._dashInvuln>0)return;let r=l;e.cc.markAmp>0&&(r*=1+e.cc.markAmp);let i=a||0;!i&&z.critChance>0&&Math.random()<z.critChance&&(i=1,r*=z.critMult),r*=z.dmgMult,e.cc.markT>0&&(r*=1+e.cc.markAmp),e.hp-=r,e.hitFlash=1,((e,l,t,a)=>{de.length>200||de.push({x:e+20*(Math.random()-.5),y:l,vy:-60-30*Math.random(),text:a?t+"!":""+t,color:a?"#ff0":"#fff",life:.6,maxLife:.6,scale:a?1.4:1})})(e.x,e.y,0|r,i),ye(e.x,e.y,e.color,3,80),e.hp<=0&&nl(e)}function nl(e){if(!e.active)return;e.active=0;let l=("elite"===e.tier?55:15)*z.xpMult;for(U.xp+=l;U.xp>=U.xpToNext&&U.xpToNext>0;)U.xp-=U.xpToNext,U.level++,U.xpToNext=h(.64*(100+100*U.level)),U.levelUpQueue++;if(U.totalKills++,U.waveKills++,"elite"===e.tier&&(U.killFlash=.05),"circle"===e.shape)for(let l=0;l<12;l++){let t=n/12*l;ce(e.x,e.y,200*s(t),200*f(t),e.color,.3,2)}else if("square"===e.shape)for(let l=0;l<8;l++){let t=o/4+n/8*l;ce(e.x+s(t)*e.r,e.y+f(t)*e.r,150*s(t),150*f(t),e.color,.3,3)}else for(let l=0;l<3;l++){let a=n/3*l;for(let l=0;l<4;l++)ce(e.x,e.y,s(a+t(-.3,.3))*(100+50*l),f(a+t(-.3,.3))*(100+50*l),e.color,.3,2)}ye(e.x,e.y,e.color,15,180),Y("elite"===e.tier?8:3),$(.06,.5)}function sl(){we.invuln>0||!we.alive||(we.hp--,we.invuln=.8,we.hitFlash=.3,Y(10),ye(we.x,we.y,"#0ff",15,200),we.hp<=0&&(we.alive=0,ye(we.x,we.y,"#0ff",40,300),ye(we.x,we.y,"#fff",20,250),Y(15),D.clear(),E=0,M=0,I=null,U.gameOverFade=0,H="dying"))}var fl=[];function dl(){let e=[];for(let l of U.weapons){let t=Me[l.id];if(t)for(let a of t.upgrades)l.lv[a.id]<a.maxLv&&e.push({type:"weaponUpg",weaponId:l.id,upgId:a.id,def:a,wdef:t,curLv:l.lv[a.id]})}if(U.weapons.filter(e=>"cc"===Me[e.id].type).length<2){let l=U.weapons.map(e=>e.id);for(let t of Be)l.includes(t)||e.push({type:"newWeapon",weaponId:t,wdef:Me[t]})}let l=0;for(let e=0;e<al.length;e++)(0|U.passives[al[e]])>0&&l++;for(let t of al){let a=U.passives[t]||0,r=tl[t];r&&(a>0&&a<r.maxLv?e.push({type:"passiveUpg",passiveId:t,def:r,curLv:a}):0===a&&l<3&&e.push({type:"newPassive",passiveId:t,def:r}))}for(let l=e.length-1;l>0;l--){let t=a(0,l);[e[l],e[t]]=[e[t],e[l]]}if((fl=e.slice(0,5)).length<5)for(;fl.length<5;){let e=1&fl.length?"speed":"damage";fl.push({type:"loopPassive",passiveId:e,def:tl[e]})}}function cl(e){let l=fl[e];if(l){if("weaponUpg"===l.type){let e=U.weapons.find(e=>e.id===l.weaponId);e&&e.lv[l.upgId]++}else if("newWeapon"===l.type)U.weapons.push(Ee(l.weaponId));else if("newPassive"===l.type)U.passives[l.passiveId]=1;else if("passiveUpg"===l.type)U.passives[l.passiveId]++;else if("loopPassive"===l.type){let e="speed"===l.passiveId?"_speedLoop":"_damageLoop";U.passives[e]=1+(0|U.passives[e])}V(),U.levelUpQueue--,U.levelUpQueue>0?(dl(),H="levelUp",U.refreshAvailable=1):H="playing"}}function yl(){_.save(),_.fillStyle="#000",_.globalAlpha=.04;for(let e=0;e<w;e+=4)_.fillRect(0,e,b,1);_.restore()}var gl=0;function vl(e){e<0||e>=We.length||(U.weapons=[Ee(We[e])],H="playing",il())}function hl(e,l){U.gameOverFade=y(1,(U.gameOverFade||0)+2.8*e),l&&(ge(e),ve()),_.fillStyle="rgba(0,0,0,"+U.gameOverFade+")",_.fillRect(0,0,b,w),yl(),U.gameOverFade>=1&&(H="gameover")}function pl(){C(),we.x=0,we.y=0,we.hp=10,we.maxHp=10,we.invuln=0,we.hitFlash=0,we.alive=1,we.angle=0,we.swordIFrame=0,V(),oe.clear(),ne.clear(),se.clear(),fe.clear(),de.length=0,R.x=0,R.y=0,U.time=0,U.difficulty=.8,U.wave=0,U.waveKills=0,U.waveQuota=0,U.waveState="clear",U.xp=0,U.level=1,U.xpToNext=h(128),U.levelUpQueue=0,U.totalKills=0,U.frozen=0,U.freezeTimer=0,U.killFlash=0,U.bannerTimer=0,U.waveBannerTimer=0,U.weapons=[],U.passives={},U._rocketRings=[],U._upgradeTransition=1,U.refreshAvailable=0,U.gameOverFade=0,window._staticFields=[],he.length=0,rl=1,Q=0,H="weaponSelect"}function ml(e){let l=He(e);l&&"bow"===l.id&&(e=>{if(!e.charging)return;if(e.charging=0,e.shotCD>0)return void(e.chargeTime=0);let{chargeTime:l,maxCharge:t}=e,a=p(l/t,0,1),r=we.angle,i=10+18*a;for(let l=0;l<1;l++){let t=(l-0)*i;me(e,a,r,t,1,1,1,"#ff0");let o=p(0|e.lv.a,0,2);for(let l=1;l<=o;l++){let i=.07*l;me(e,a,r+i,t,.5,.7,.85,"#ffd84a"),me(e,a,r-i,t,.5,.7,.85,"#ffd84a")}}e.chargeTime=0,e.shotCD=.22,Y(2+4*a),$(.04,.7+.3*a),ye(we.x+22*s(r),we.y+22*f(r),"#fff",8,140)})(l)}addEventListener("keydown",e=>{D.add(e.code),["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.code)&&e.preventDefault();let l=e.code;if("dying"!==H&&("Escape"===l&&("playing"===H?H="paused":"paused"===H&&(H="playing")),"Enter"===l&&"title"===H&&pl(),"KeyR"===l&&"gameover"===H&&pl(),"weaponSelect"===H&&("Digit1"===l&&vl(0),"Digit2"===l&&vl(1),"Digit3"===l&&vl(2)),"levelUp"===H&&(U._upgradeTransition||0)>=.9&&("Digit1"===l&&cl(0),"Digit2"===l&&cl(1),"Digit3"===l&&cl(2),"Digit4"===l&&cl(3),"Digit5"===l&&cl(4),"KeyR"===l&&U.refreshAvailable>0&&(U.refreshAvailable--,dl())),"KeyR"===l&&"playing"===H)){let e=U.weapons.find(e=>"dagger"===e.id);e&&"idle"!==e.state&&(e.state="returning")}});var xl=performance.now();requestAnimationFrame(function u(k){requestAnimationFrame(u);let P=p((k-xl)/1e3,0,.05);if(xl=k,"title"!==H){if("paused"===H)return _.save(),_.fillStyle="rgba(0,0,0,.5)",_.fillRect(0,0,b,w),_.restore(),le("PAUSED",S,A-20,36,"#0ff",e,l),void le("Press ESC to Resume",S,A+30,16,"#888",e,l);if("weaponSelect"!==H)if("dying"!==H){if("gameover"===H)return _.fillStyle="#000",_.fillRect(0,0,b,w),_.save(),_.fillStyle="rgba(0,0,0,.6)",_.fillRect(0,0,b,w),_.restore(),le("GAME OVER",S,A-110,36,"#f44",e,l),le("Waves: "+g(0,U.wave-1),S,A-66,17,"#fff",e,l),le("Kills: "+U.totalKills,S,A-44,14,"#9cf",e,l),le("[R] Restart",S,A+30,12,"#888",e,l),void yl();if("levelUp"===H){void 0===U._upgradeTransition&&(U._upgradeTransition=1),U._upgradeTransition=y(1,U._upgradeTransition+4*P);let t=U._upgradeTransition,a=t<1?1-Math.pow(1-t,3):1;if(_.fillStyle="rgba(0,0,0,"+.65*a+")",_.fillRect(0,0,b,w),I&&t>=.9){let e=y(5,fl.length),l=S-(150*e+12*(e-1))/2,t=A-60;for(let a=0;a<e;a++){let e=l+162*a;if(I.x>=e&&I.x<=e+150&&I.y>=t&&I.y<=t+140){cl(a);break}}I=null}else I&&(I=null);return(t=>{t=t||1,_.save(),_.globalAlpha=t,le("LEVEL UP",S,A-140,22,"#ff0",e,l),_.restore();let a=y(5,fl.length),r=140,i=S-(150*a+12*(a-1))/2,o=A-60;for(let t=0;t<a;t++){let a=fl[t],n=i+162*t,s=o,f=F>=n&&F<=n+150&&L>=s&&L<=s+r,d="#0ff",c="",y="";"weaponUpg"===a.type?(d=a.wdef.color,c=a.wdef.name+": "+a.def.name,y=a.def.desc[a.curLv]||""):"newWeapon"===a.type?(d=a.wdef.color,c="NEW "+a.wdef.name,y=a.wdef.cc?"CC: "+a.wdef.cc:a.wdef.desc):"newPassive"===a.type?(d=a.def.color,c="NEW "+a.def.name,y=a.def.desc[0]):"passiveUpg"===a.type?(d=a.def.color,c=a.def.name,y=a.def.desc[a.curLv]||""):"loopPassive"===a.type&&(d=a.def.color,c=a.def.name,y=a.def.desc[0]),ae(n,s,150,r,"rgba(8,16,24,.9)",f?"#fff":d,f?2:1.2,f?1:.78),le(c,n+75,s+24,10,f?"#fff":d,e,l),le(y,n+75,s+70,9,"#9aa",e,l),le("["+(t+1)+"]",n+75,s+r-14,12,"#666",e,l)}le(U.refreshAvailable>0?"[R] Reroll ("+U.refreshAvailable+")":"[R] No rerolls",S,o+r+20,13,U.refreshAvailable>0?"#4f4":"#666",e,l)})(a),void yl()}if(I&&"playing"===H){let e=B();((e,l,t)=>{let a=He(e);a&&("dagger"===a.id?((e,l,t)=>{"idle"===e.state||"waiting"===e.state||"spinning"===e.state?(e.state="flying",e.tx=l,e.ty=t,"idle"===e.state&&(e.dx=we.x,e.dy=we.y)):"flying"===e.state?(e.tx=l,e.ty=t):"returning"===e.state&&(e.state="flying",e.tx=l,e.ty=t)})(a,l,t):"sword"===a.id?(e=>{let l=.4*(1-z.cdReduction);e.swingCD>0||e.lungeTimer>0||(e.swingCD=l,e.lungeDir=we.angle,e.lungeDist=[120,160,200,250][e.lv.a]*(1+[0,.15,.3][e.lv.c]),e.lungeStartX=we.x,e.lungeStartY=we.y,e.lungeTimer=.18,e.lungeProg=0,ye(we.x+15*s(e.lungeDir),we.y+15*f(e.lungeDir),"#f0f",6,100))})(a):"bow"===a.id&&(e=>{e.shotCD<=0&&(e.charging=1)})(a))})(I.btn,e.x,e.y),I=null}if(E||ml(0),M||ml(2),Q>0&&(Q-=P,P*=X),U.time+=P,U.killFlash=g(0,U.killFlash-P),U.levelUpQueue>0&&"playing"===H)return dl(),H="levelUp",U._upgradeTransition=0,void(U.refreshAvailable=1);if(R.x=m(R.x,we.x,8*P),R.y=m(R.y,we.y,8*P),_.fillStyle="rgba(0,0,0,0.18)",_.fillRect(0,0,b,w),G>.2?(K=(Math.random()-.5)*G*2,q=(Math.random()-.5)*G*2,G*=.87):K=q=G=0,_.save(),_.translate(-R.x+S+K,-R.y+A+q),(()=>{let e=R.x-S-100,l=R.y-A-100,t=R.x+S+100,a=R.y+A+100,r=100*h(e/100),i=100*h(l/100),o=50*h(e/50),n=50*h(l/50);_.save(),_.strokeStyle="#2a5f82",_.lineWidth=.9,_.globalAlpha=.62,_.beginPath();for(let e=r;e<=t;e+=100)_.moveTo(e,l),_.lineTo(e,a);for(let l=i;l<=a;l+=100)_.moveTo(e,l),_.lineTo(t,l);_.stroke(),_.strokeStyle="#18344a",_.lineWidth=.6,_.globalAlpha=.38,_.beginPath();for(let e=o;e<=t;e+=50)_.moveTo(e,l),_.lineTo(e,a);for(let l=n;l<=a;l+=50)_.moveTo(e,l),_.lineTo(t,l);_.stroke(),_.fillStyle="#58b7ff",_.globalAlpha=.22;for(let e=o;e<=t;e+=50)for(let l=n;l<=a;l+=50)_.fillRect(e-1.5,l-1.5,3,3);_.restore()})(),(e=>{if(!we.alive)return;let l=U.weapons.find(e=>"sword"===e.id);if(l&&l.lungeTimer>0){we.invuln=g(0,we.invuln-e),we.hitFlash=g(0,we.hitFlash-5*e),we.swordIFrame=g(0,we.swordIFrame-e);let l=B(),t=l.x-we.x,a=l.y-we.y;return t*t+a*a>4&&(we.angle=v(a,t)),void(U.passives.regen&&(z.regenTimer-=e,z.regenTimer<=0&&(z.regenTimer=z.regenInterval,we.hp<we.maxHp&&we.hp++)))}let t=(()=>{let e=0,l=0;(W("KeyW")||W("ArrowUp"))&&(l=-1),(W("KeyS")||W("ArrowDown"))&&(l=1),(W("KeyA")||W("ArrowLeft"))&&(e=-1),(W("KeyD")||W("ArrowRight"))&&(e=1);let t=d(e*e+l*l);return t>0?{x:e/t,y:l/t}:{x:0,y:0}})(),a=t.x,r=t.y;we.x+=a*z.moveSpeed*1*e,we.y+=r*z.moveSpeed*1*e;let i=B(),o=i.x-we.x,n=i.y-we.y;o*o+n*n>4&&(we.angle=v(n,o)),we.invuln=g(0,we.invuln-e),we.hitFlash=g(0,we.hitFlash-5*e),we.swordIFrame=g(0,we.swordIFrame-e),z.regenTimer=(z.regenTimer||0)+e,z.regenTimer>=z.regenInterval&&we.hp<we.maxHp&&(z.regenTimer=0,we.hp=y(we.hp+1,we.maxHp))})(P),(e=>{for(let l of U.weapons)"dagger"===l.id?Ue(l,e):"sword"===l.id?ze(l,e):"bow"===l.id?Ke(l,e):"chain"===l.id?Xe(l,e):"rocket"===l.id&&Ze(l,e)})(P),(e=>{U.frozen||fe.each(l=>{let t=l.cc;if(t.bleedT>0&&(t.bleedT-=e,l.hp-=t.bleedDmg*e,l.hp<=0&&nl(l)),t.stunT>0)return t.stunT-=e,void(l.hitFlash=.2);if(t.silenceT>0&&(t.silenceT-=e),t.rootT>0&&(t.rootT-=e),t.slowT>0?t.slowT-=e:t.slowAmt=0,t.fearT>0){t.fearT-=e;let a=v(l.y-we.y,l.x-we.x),r=1.5*(l.moveParams.speed||100);l.x+=s(a)*r*e,l.y+=f(a)*r*e}else if(t.disorientT>0)t.disorientT-=e,l.x+=200*(Math.random()-.5)*e,l.y+=200*(Math.random()-.5)*e;else if(t.kbVx||t.kbVy)l.x+=t.kbVx*e,l.y+=t.kbVy*e,t.kbVx*=.9,t.kbVy*=.9,c(t.kbVx)<5&&(t.kbVx=0),c(t.kbVy)<5&&(t.kbVy=0);else if(t.rootT<=0){let a=t.slowT>0?1-t.slowAmt:1,r=l.moveParams.speed;r&&(l.moveParams.speed=r*a),Se[l.moveType]&&Se[l.moveType](l,e),r&&(l.moveParams.speed=r)}if(t.markT>0?t.markT-=e:t.markAmp=0,t.silenceT<=0){let a=t.slowT>0?1-.5*t.slowAmt:1;l.fireTimer-=e*a,l.fireTimer<=0&&we.alive&&(l.fireTimer+=l.fireCD,Ae[l.firePattern]&&Ae[l.firePattern](l))}l.angle+=e*("sentry"===l.moveType?1.5:.5),l.hitFlash=g(0,l.hitFlash-5*e),l._dashInvuln>0&&(l._dashInvuln=g(0,l._dashInvuln-e)),x(l.x,l.y,we.x,we.y)>1400&&(l.active=0)})})(P),De(oe,P,0),De(ne,P,1),ge(P),(e=>{for(let l=de.length-1;l>=0;l--){let t=de[l];t.y+=t.vy*e,t.vy+=100*e,t.life-=e,t.life<=0&&de.splice(l,1)}})(P),(e=>{for(let l=he.length-1;l>=0;l--)he[l].life-=e,he[l].life<=0&&he.splice(l,1)})(P),we.alive&&(ne.each(e=>{e.active&&fe.each(l=>{if(l.active&&x(e.x,e.y,l.x,l.y)<e.r+l.r){if("rocket"===e.src)return e.active=0,void((e,l)=>{let t=U.weapons.find(e=>"rocket"===e.id);if(!t)return;let a=t.blastR+[0,30,50][t.lv.c],r=t.kbForce+[0,40,80,120][t.lv.a],i=[.5,.8,1.2,1.5][t.lv.a]||.5;if(ye(e,l,"#f80",25,250),ye(e,l,"#ff4",15,180),Y(8),U._rocketRings||(U._rocketRings=[]),U._rocketRings.push({x:e,y:l,r:a,life:.3,maxLife:.3}),oe.each(t=>{t.active&&x(e,l,t.x,t.y)<a&&(t.active=0,ye(t.x,t.y,"#f80",2,60))}),fe.each(t=>{if(t.active&&x(e,l,t.x,t.y)<a+t.r){ol(t,1);let a=v(t.y-l,t.x-e);t.cc.kbVx=s(a)*r,t.cc.kbVy=f(a)*r,t.cc.disorientT=i}}),t.lv.b>0){let a=[0,5,7][t.lv.b];for(let t=0;t<a;t++){let r=n/a*t;ne.spawn(t=>{t.x=e+10*s(r),t.y=l+10*f(r),t.vx=220*s(r),t.vy=220*f(r),t.r=3,t.life=2,t.maxLife=2,t.type="normal",t.color="#fa0",t.spawnTime=U.time,t.damage=1,t.split=0,t.baseSpeed=220,t.curve=0,t.pulseAmp=0,t.src="rocket_mini",t._homing=1,t._homingDelay=.35})}}})(e.x,e.y);if("rocket_mini"===e.src)return e.active=0,ye(e.x,e.y,"#fa0",8,100),Y(2),void fe.each(l=>{if(l.active&&x(e.x,e.y,l.x,l.y)<40+l.r){ol(l,1);let t=v(l.y-e.y,l.x-e.x);l.cc.kbVx+=80*s(t),l.cc.kbVy+=80*f(t)}});ol(l,e.damage,e.src),e.active=0}})}),we.invuln<=0&&(oe.each(e=>{if(e.active&&x(e.x,e.y,we.x,we.y)<e.r+we.r){if(z.dodgeChance>0&&Math.random()<z.dodgeChance)return;e.active=0,sl()}}),fe.each(e=>{e.active&&x(e.x,e.y,we.x,we.y)<e.r+we.r&&sl()}))),"dying"===H)return _.restore(),hl(P,0),void(I=null);if((e=>{if("spawning"===U.waveState){if((rl-=e)<=0){let e=6+2.4*U.wave+1.2*U.difficulty;fe.count()<e&&(e=>{let l="elite"===(e=e||"small");fe.spawn(o=>{let n=r(),d=g(S,A)+50+t(0,100);o.x=we.x+s(n)*d,o.y=we.y+f(n)*d,o.shape=i(_e),o.color=T(i(Pe)),o.moveType=i(Re),o.firePattern=i(Ce),o.tier=e,o.r=l?22:14;let c=1+.11*U.wave+U.wave*U.wave*.003;if(o.hp=(l?10:3)*c|0,o.maxHp=o.hp,o.fireCD=(l?t(.8,1.5):t(1.5,3))/(1+.08*U.difficulty),o.fireTimer=t(.5,o.fireCD),o.hitFlash=0,o.angle=r(),o.spiralAngle=r(),o.spawnTime=U.time,o._dashTele=null,o._dashInvuln=0,o.moveParams={},o.fireParams={},o.cc={stunT:0,silenceT:0,rootT:0,slowAmt:0,slowT:0,fearT:0,markT:0,markAmp:0,kbVx:0,kbVy:0,disorientT:0,bleedDmg:0,bleedT:0},"drifter"===o.moveType){let e=t(40,80),l=r();o.vx=s(l)*e,o.vy=f(l)*e}else"orbiter"===o.moveType?(o.moveParams.radius=o.moveParams.radius||t(100,200),o.moveParams.speed=o.moveParams.speed||t(1,2.5)*(Math.random()<.5?1:-1),o.moveParams.angle=o.moveParams.angle||r()):"dasher"===o.moveType?(o.moveParams.state="wait",o.moveParams.waitTime=0,o.vx=0,o.vy=0):"weaver"===o.moveType?(o.moveParams.t=0,o.moveParams.speed=o.moveParams.speed||t(60,120),o.moveParams.freq=o.moveParams.freq||t(2,5)):"chaser"===o.moveType?(o.moveParams.speed=o.moveParams.speed||t(80,140),o.vx=0,o.vy=0):"sentry"===o.moveType?(o.vx=t(-20,20),o.vy=t(-20,20)):"converge"===o.moveType&&(o.moveParams.speed=o.moveParams.speed||150);return"radial"===o.firePattern&&(o.fireParams.count=l?a(10,16):a(6,10),o.fireParams.offset=r()),o})})(Math.random()<.1+.02*U.wave?"elite":"small"),rl=g(.16,1.65-.11*U.wave-.1*U.difficulty-U.wave*U.wave*.0015)}U.waveKills>=U.waveQuota&&(U.waveState="clear",oe.clear(),ye(we.x,we.y,"#fff",30,250),Y(10),$(2,.3),U.bannerTimer=2,U.bannerText="WAVE "+U.wave+" CLEAR!",U.bannerColor="#0ff",setTimeout(()=>il(),2e3))}U.frozen&&(U.freezeTimer-=e,U.freezeTimer<=0&&(U.frozen=0))})(P),Fe(oe),Fe(ne),fe.each(e=>{let l=e.hitFlash>0?"#fff":e.color,t=e.cc;t.fearT>0&&(l="#ddd");let a=e.r+(e.hitFlash>0?2:0),r="elite"===e.tier?4:3;if("circle"===e.shape?j(e.x,e.y,a,l,r):"square"===e.shape?Z(((e,l,t,a)=>{let r=[];for(let i=0;i<4;i++){let d=a+n/4*i+o/4;r.push({x:e+s(d)*t,y:l+f(d)*t})}return r})(e.x,e.y,a,e.angle),l,1,r):Z(ee(e.x,e.y,a,e.angle),l,1,r),e._dashTele&&"dasher"===e.moveType&&(e=>{if(!e._dashTele)return;let l=e._dashTele,t=1-p(l.t/g(1e-4,l.maxT),0,1),a=v(l.ty-e.y,l.tx-e.x),r=e.x+s(a)*(e.r+12),i=e.y+f(a)*(e.r+12);_.save(),te(e.x,e.y,e.r+8+2*f(18*U.time),"rgba(255,235,140,"+(.24+.42*t)+")",2.1),_.translate(r,i),_.rotate(a);let o=7+1.8*t;_.beginPath(),_.moveTo(o,0),_.lineTo(.55*-o,.55*-o),_.lineTo(.55*-o,.55*o),_.closePath(),_.fillStyle="rgba(255,245,180,"+(.35+.4*t)+")",_.fill(),_.restore()})(e),"elite"===e.tier&&e.hp<e.maxHp){let l=2*e.r;_.fillStyle="#333",_.fillRect(e.x-l/2,e.y-e.r-8,l,3),_.fillStyle=e.color,_.fillRect(e.x-l/2,e.y-e.r-8,l*(e.hp/e.maxHp),3)}if(t.markT>0&&(_.beginPath(),_.arc(e.x,e.y-e.r-10,3,0,n),_.fillStyle="#ccc",_.fill()),(t.stunT>0||t.rootT>0||t.slowT>0||t.bleedT>0)&&(_.beginPath(),_.arc(e.x,e.y,e.r+3,0,n),_.strokeStyle="rgba(255,255,255,.4)",_.lineWidth=1.2,_.stroke()),t.silenceT>0){let l=e.r+5;_.beginPath(),_.moveTo(e.x-l,e.y-l),_.lineTo(e.x+l,e.y+l),_.moveTo(e.x+l,e.y-l),_.lineTo(e.x-l,e.y+l),_.strokeStyle="#0aa",_.lineWidth=2.2,_.globalAlpha=.85,_.stroke()}}),(()=>{if(!we.alive)return;if(we.invuln>0&&we.swordIFrame<=0&&(20*U.time|0)%2==0)return;let e=we.hitFlash>0?"#fff":"#0ff";if(Z(ee(we.x,we.y,we.r,we.angle+o/2),e,1,4),_.save(),_.beginPath(),_.arc(we.x,we.y,.4*we.r,0,n),_.fillStyle=e,_.globalAlpha=.15,_.fill(),_.restore(),we.swordIFrame>0){let e=p(we.swordIFrame/.25,0,1),l=we.r+8+2*f(18*U.time);_.save(),_.beginPath(),_.arc(we.x,we.y,l,0,n),_.strokeStyle="#f6f",_.lineWidth=2.2,_.globalAlpha=.2+.35*e,_.shadowColor="#f6f",_.shadowBlur=10,_.stroke(),_.beginPath(),_.arc(we.x,we.y,l-4,0,n),_.strokeStyle="#8ff",_.lineWidth=1.2,_.globalAlpha=.15+.25*e,_.shadowColor="#8ff",_.shadowBlur=6,_.stroke();for(let l=0;l<2;l++){let t=14*U.time+l*o,a=ee(we.x-s(we.angle)*(8+5*l)+2*s(t),we.y-f(we.angle)*(8+5*l)+2*f(t),.65*we.r,we.angle+o/2);_.beginPath(),_.moveTo(a[0].x,a[0].y),_.lineTo(a[1].x,a[1].y),_.lineTo(a[2].x,a[2].y),_.closePath(),_.fillStyle="#f6f",_.globalAlpha=.08+.12*e,_.fill()}_.restore()}})(),(()=>{for(let e of U.weapons)"dagger"===e.id?Ne(e):"sword"===e.id?Ve(e):"bow"===e.id?qe(e):"chain"===e.id?Je(e):"rocket"===e.id&&el()})(),(()=>{for(let e of he){let l=p(e.life/e.maxLife,0,1),t=.9+.1*f(40*U.time+e.phase);pe(e.x1,e.y1,e.x2,e.y2,e.width*t,l,e.color,0),_.save();for(let t=0;t<5;t++){let a=(t+.5)/5+.015*f(10*U.time+t+e.phase),r=m(e.x1,e.x2,p(a,0,1)),i=m(e.y1,e.y2,p(a,0,1));_.beginPath(),_.arc(r,i,2+3*l,0,n),_.fillStyle="#fff",_.globalAlpha=.1+.25*l,_.fill()}_.restore()}})(),(()=>{for(let e of window._staticFields){let l=p(e.life/e.maxLife,0,1);_.save(),_.globalAlpha=.8*l,_.beginPath(),_.arc(e.x,e.y,e.size*l,0,n),_.fillStyle="#c6f",_.fill(),_.beginPath(),_.arc(e.x,e.y,e.size*l*2,0,n),_.fillStyle="#a0f",_.globalAlpha=.15*l,_.fill(),_.restore()}})(),ve(),(()=>{for(let t of de){let a=t.life/t.maxLife;_.save(),_.globalAlpha=a,_.font="bold "+12*t.scale+"px monospace",_.textAlign=e,_.textBaseline=l,_.fillStyle=t.color,_.shadowColor=t.color,_.shadowBlur=6,_.fillText(t.text,t.x,t.y),_.restore()}})(),U._rocketRings)for(let e=U._rocketRings.length-1;e>=0;e--){let l=U._rocketRings[e];if(l.life-=P,l.life<=0){U._rocketRings.splice(e,1);continue}let t=1-l.life/l.maxLife;_.save(),_.beginPath(),_.arc(l.x,l.y,l.r*t,0,n),_.strokeStyle="#f80",_.lineWidth=3*(1-t),_.globalAlpha=.6*(1-t),_.shadowColor="#f80",_.shadowBlur=10,_.stroke(),_.beginPath(),_.arc(l.x,l.y,l.r*t*.6,0,n),_.strokeStyle="#ff4",_.lineWidth=2*(1-t),_.globalAlpha=.4*(1-t),_.stroke(),_.restore()}_.restore(),U.killFlash>0&&(_.save(),_.fillStyle="#fff",_.globalAlpha=3*U.killFlash,_.fillRect(0,0,b,w),_.restore()),U.frozen&&(_.save(),_.fillStyle="rgba(50,100,200,0.08)",_.fillRect(0,0,b,w),_.restore()),(()=>{let e=_.createRadialGradient(S,A,.3*y(b,w),S,A,.7*y(b,w));e.addColorStop(0,"rgba(0,0,0,0)");let l=we.hp<=1&&we.alive;e.addColorStop(1,l?"rgba(80,0,0,0.5)":"rgba(0,0,0,0.35)"),_.save(),_.fillStyle=e,_.fillRect(0,0,b,w),_.restore()})(),(()=>{let t=y(b-16,560),a=S-t/2,r=p(we.hp/g(1,we.maxHp),0,1),i=p(U.xp/U.xpToNext,0,1),o=r>.5?"#0ef":r>.25?"#fd4":"#f55";ae(a,10,t,54,"rgba(0,0,0,.55)","rgba(255,255,255,.15)",1);let n=a+42,s=t-54,f=(s-18)/10;for(let e=0;e<10;e++){let l=n+e*(f+2),t=p(10*r-e,0,1);_.fillStyle="rgba(18,18,18,.95)",_.fillRect(l,19,f,12),t>0&&(_.fillStyle=o,_.fillRect(l,19,f*t,12)),_.strokeStyle="rgba(255,255,255,.24)",_.strokeRect(l,19,f,12)}_.fillStyle="rgba(18,18,18,.95)",_.fillRect(n,37,s,9),_.fillStyle="#fd4",_.fillRect(n,37,s*i,9),_.strokeStyle="rgba(255,223,74,.3)",_.strokeRect(n,37,s,9),le("HP",a+12,19,10,"#dff"),le("XP",a+12,36,10,"#fd4");let d=U.time%60|0;le("TIME "+(U.time/60|0)+":"+(d<10?"0":"")+d,a+12,51,9,"#8ea");let c=y(b-80,460),v=S-c/2;if("spawning"===U.waveState){let e=p(U.waveKills/U.waveQuota,0,1);ae(v,72,c,7,"rgba(20,20,20,.92)","rgba(0,255,255,.32)",1),_.fillStyle="#0ff",_.fillRect(v,72,c*e,7)}let h={chain:.8,rocket:2.2},m=S-52*g(1,U.weapons.length)/2+26;for(let t=0;t<U.weapons.length;t++){let a=U.weapons[t],r=Me[a.id],i=m+52*t,o=w-46;ae(i-18,o-12,36,24,"rgba(0,0,0,.5)",r.color,1),le(r.name.charAt(0),i,o-1,12,r.color,e,l);let n=h[a.id];if(n&&void 0!==a.timer){let e=p(1-a.timer/n,0,1);_.fillStyle="rgba(0,0,0,.55)",_.fillRect(i-18,o+14,36,3),_.fillStyle=r.color,_.fillRect(i-18,o+14,36*e,3)}}if(U.bannerTimer>0&&(U.bannerTimer-=.016666666666666666,_.save(),_.globalAlpha=y(1,2*U.bannerTimer),le(U.bannerText,S,A-60,24,U.bannerColor,e,l),_.restore()),U.waveBannerTimer>0){U.waveBannerTimer-=.016666666666666666;let t=y(1,U.waveBannerTimer);_.save(),_.globalAlpha=t;let a=30+20*(1-t);le(U.waveBannerText,S,A-30,a,"#fff",e,l),_.restore()}})(),yl(),I=null}else hl(P,1);else{if(I){let e=We.length,l=S-(180*e+20*(e-1))/2,t=A-70;for(let a=0;a<e;a++){let e=l+200*a;if(I.x>=e&&I.x<=e+180&&I.y>=t&&I.y<=t+200){vl(a);break}}I=null}(()=>{_.fillStyle="rgba(0,0,0,.75)",_.fillRect(0,0,b,w),le("CHOOSE WEAPON",S,60,24,"#0ff",e,l);let t=We.length,a=S-(180*t+20*(t-1))/2,r=A-70;function i(l,t,a,r,i){_.save(),_.font="bold 9px monospace";let o=(l||"").split(/\s+/).filter(Boolean),n=[],s="";for(let e=0;e<o.length;e++){let l=s?s+" "+o[e]:o[e];_.measureText(l).width>r&&s?(n.push(s),s=o[e]):s=l}s&&n.push(s);let f=n.slice(0,i);n.length>i&&f.length&&(f[f.length-1]=f[f.length-1].replace(/\.*$/,"")+"..."),_.textAlign=e,_.textBaseline="top",_.fillStyle="#9aa";for(let e=0;e<f.length;e++)_.fillText(f[e],t,a+12*e);_.restore()}for(let o=0;o<t;o++){let t=Me[We[o]],n=a+200*o,s=r,f=F>=n&&F<=n+180&&L>=s&&L<=s+200,d=f?"#fff":t.color;ae(n,s,180,200,"rgba(8,16,24,0.9)",d,f?2:1.2,f?1:.75),le(t.name,n+90,s+25,13,d,e,l),le("starter"===t.type?"PRIMARY":"CC",n+90,s+62,10,t.color,e,l),i(t.desc,n+90,s+84,158,4),le("["+(o+1)+"]",n+90,s+200-20,14,"#555",e,l)}yl()})()}}else(a=>{gl+=a,(e=>{(e=>{if(!ue.enemies.length)for(let e=0;e<10;e++)ue.enemies.push(Te({}));ue.t+=e;for(let l of ue.enemies)l.fire-=e,l.x+=l.vx*e,l.y+=l.vy*e,(l.x<-20||l.x>b+20||l.y<-20||l.y>w+20)&&Te(l),l.fire<=0&&(be(l),l.fire=t(.25,1.2));for(let l=ue.bullets.length-1;l>=0;l--){let t=ue.bullets[l];t.x+=t.vx*e,t.y+=t.vy*e,t.life-=e,(t.life<=0||t.x<-30||t.y<-30||t.x>b+30||t.y>w+30)&&ue.bullets.splice(l,1)}})(e||0),_.fillStyle="#02060b",_.fillRect(0,0,b,w);let l=100,a=50,r=30*ue.t%l,i=16*ue.t%l,o=46*ue.t%a,n=26*ue.t%a;_.save(),_.strokeStyle="#2a5f82",_.lineWidth=.9,_.globalAlpha=.5,_.beginPath();for(let e=-r;e<=b+l;e+=l)_.moveTo(e,0),_.lineTo(e,w);for(let e=-i;e<=w+l;e+=l)_.moveTo(0,e),_.lineTo(b,e);_.stroke(),_.strokeStyle="#18344a",_.lineWidth=.6,_.globalAlpha=.35,_.beginPath();for(let e=-o;e<=b+a;e+=a)_.moveTo(e,0),_.lineTo(e,w);for(let e=-n;e<=w+a;e+=a)_.moveTo(0,e),_.lineTo(b,e);_.stroke(),_.fillStyle="#58b7ff",_.globalAlpha=.14;for(let e=-o;e<=b+a;e+=a)for(let l=-n;l<=w+a;l+=a)_.fillRect(e-1,l-1,2,2);_.restore();for(let e of ue.bullets)_.save(),_.globalAlpha=.45*p(e.life/2,0,1),J(e.x,e.y,e.r,e.color),_.restore();for(let e of ue.enemies)_.save(),_.globalAlpha=.55,"circle"===e.shape?j(e.x,e.y,e.r,e.color,3):Z(ee(e.x,e.y,e.r,1.2*ue.t),e.color,1,3),_.restore();_.fillStyle="rgba(0,0,0,0.28)",_.fillRect(0,0,b,w)})(a),_.save(),_.globalAlpha=.7+.3*f(3*gl),le("NEON PHASES",S,A-80,42,"#0ff",e,l),_.restore(),(2*gl|0)%2&&le("Press ENTER",S,A+12,16,"#fff",e,l),yl()})(P)})})();</script></body></html>